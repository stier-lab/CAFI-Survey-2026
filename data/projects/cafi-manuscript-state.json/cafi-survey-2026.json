{
  "project_id": "cafi-survey-2026",
  "project_title": "CAFI Survey Analysis - Coral-Associated Fauna in Mo'orea",
  "created_at": "2025-11-21T11:56:08.495472",
  "updated_at": "2025-11-21T12:07:59.577511",
  "current_stage": "initialization",
  "project_brief": null,
  "artifacts": {},
  "tasks": [],
  "agent_outputs": {
    "research_prd": [
      {
        "timestamp": "2025-11-21T11:57:01.059073",
        "output": {
          "research_prd": "# Research Product Requirements Document (Research PRD)\n## CAFI Survey Analysis - Mo'orea Coral-Associated Fauna Communities\n\n---\n\n## 1. Umbrella Question and Nested Questions\n\n### Umbrella Question\n**What ecological and physical factors determine the structure, diversity, and spatial organization of coral-associated fauna (CAFI) communities in Pocillopora coral colonies across reef environments in Mo'orea, French Polynesia?**\n\n### Nested Questions\n- **Q1**: What factors determine CAFI community composition and diversity patterns?\n- **Q2**: How do coral physical characteristics (size, morphology, condition) affect associated fauna communities?\n- **Q3**: What is the spatial structure and autocorrelation of CAFI distributions across reef sites?\n- **Q4**: What is the network structure of CAFI co-occurrence patterns and does it reflect functional ecological groupings?\n\n---\n\n## 2. Hypothesis Tree\n\n### Q1: Community Composition and Diversity Determinants\n- **H1a**: Reef site significantly affects CAFI community composition due to environmental gradients\n  - *Direction*: HAU (fringing) \u2260 MAT (lagoon) \u2260 MRB (barrier) communities\n  - *Mechanism*: Different hydrodynamic, nutrient, and habitat conditions\n- **H1b**: Coral morphotype influences CAFI community structure\n  - *Direction*: verrucosa \u2260 meandrina \u2260 eydouxi communities\n  - *Mechanism*: Morphological differences create distinct microhabitat niches\n- **H1c**: Depth affects CAFI diversity and composition\n  - *Direction*: Negative relationship with depth (2-15m range)\n  - *Mechanism*: Light availability, temperature, and predation pressure gradients\n\n### Q2: Coral Physical Effects on CAFI\n- **H2a**: Coral volume positively predicts CAFI abundance (habitat size effect)\n  - *Direction*: Power law scaling relationship (~0.75 exponent)\n  - *Mechanism*: Larger corals provide more microhabitat space and refugia\n- **H2b**: Wide-branching corals support higher CAFI diversity than tight-branching\n  - *Direction*: Wide > tight branching for richness and Shannon diversity\n  - *Mechanism*: Increased structural complexity and niche availability\n- **H2c**: Coral physiological condition positively affects CAFI community metrics\n  - *Direction*: Higher condition score \u2192 higher abundance/diversity\n  - *Mechanism*: Healthier corals provide better habitat quality and resources\n\n### Q3: Spatial Structure\n- **H3a**: CAFI communities exhibit significant positive spatial autocorrelation\n  - *Direction*: Moran's I > 0, p < 0.05\n  - *Mechanism*: Dispersal limitation and environmental clustering\n- **H3b**: Spatial autocorrelation varies by taxonomic group\n  - *Direction*: Crabs > shrimp > fish > snails for spatial clustering\n  - *Mechanism*: Different mobility and dispersal capabilities\n\n### Q4: Network Structure\n- **H4a**: CAFI co-occurrence networks exhibit modular structure\n  - *Direction*: Modularity coefficient 0.3-0.5\n  - *Mechanism*: Functional groups and niche partitioning\n- **H4b**: Network modules reflect taxonomic and functional groupings\n  - *Direction*: Modules align with crab/shrimp/fish/snail categories\n  - *Mechanism*: Similar ecological requirements and interactions\n- **H4c**: Keystone species can be identified via network centrality metrics\n  - *Direction*: High degree \u00d7 betweenness species are ecological keystones\n  - *Mechanism*: Central species facilitate community assembly and stability\n\n---\n\n## 3. Conceptual Causal Diagram (in words)\n\n### Primary Causal Pathways\n1. **Environmental Context** \u2192 **Coral Characteristics** \u2192 **CAFI Communities**\n   - Site (HAU/MAT/MRB) influences coral growth conditions and morphology\n   - Depth affects coral physiology and available habitat complexity\n\n2. **Coral Physical Structure** \u2192 **Microhabitat Availability** \u2192 **CAFI Diversity**\n   - Volume/surface area determine total habitat space\n   - Branch width affects structural complexity and niche diversity\n   - Morphotype influences architectural features\n\n3. **Coral Physiological Condition** \u2192 **Habitat Quality** \u2192 **CAFI Abundance**\n   - Protein, carbohydrate, zooxanthellae density affect resource availability\n   - Condition score integrates multiple physiological indicators\n\n### Key Confounders\n- **Position bias**: Larger corals sampled farther from base (r = 0.565)\n- **Site-depth correlation**: Different depth ranges across sites\n- **Morphotype-site association**: Non-random distribution of coral types\n- **Sampling effort**: Potential detection bias in cryptic fauna\n\n### Mediators and Moderators\n- **Mediators**: Coral condition mediates site effects on CAFI\n- **Moderators**: Branch width may moderate volume effects on diversity\n\n---\n\n## 4. Variable Definitions\n\n### Response Variables\n- **CAFI abundance**: Count of individuals per coral colony\n  - *Type*: Count data (Poisson/negative binomial)\n  - *Scale*: 0 to ~200 individuals\n  - *Expected range*: 1-150 based on preliminary data\n\n- **CAFI richness**: Number of distinct OTUs per coral\n  - *Type*: Count data\n  - *Scale*: 1 to 50 OTUs\n  - *Expected range*: 3-25 OTUs per coral\n\n- **Shannon diversity**: H' = -\u03a3(pi \u00d7 ln(pi))\n  - *Type*: Continuous\n  - *Scale*: 0 to log(richness)\n  - *Expected range*: 0.5-3.0\n\n- **Community composition**: Bray-Curtis dissimilarity matrix\n  - *Type*: Distance matrix\n  - *Scale*: 0 (identical) to 1 (no shared species)\n  - *Expected range*: 0.2-0.9 based on beta diversity\n\n### Predictor Variables\n- **Coral volume**: cm\u00b3, log-transformed for analysis\n  - *Type*: Continuous\n  - *Scale*: 50-5,000 cm\u00b3\n  - *Measurement*: Ellipsoid approximation from dimensions\n\n- **Coral surface area**: cm\u00b2, log-transformed\n  - *Type*: Continuous\n  - *Scale*: Derived from volume measurements\n  - *Expected range*: 100-3,000 cm\u00b2\n\n- **Branch width**: Categorical morphological trait\n  - *Type*: Binary factor (tight vs. wide)\n  - *Scale*: Field assessment of branching pattern\n  - *Distribution*: Expected ~50/50 split\n\n- **Depth**: Meters below surface\n  - *Type*: Continuous\n  - *Scale*: 2-15 meters\n  - *Site variation*: Different ranges per site\n\n### Random/Grouping Factors\n- **Site**: Reef location (HAU/MAT/MRB)\n  - *Type*: Categorical factor (3 levels)\n  - *Sample sizes*: HAU=38, MAT=39, MRB=37 corals\n  - *Treatment as*: Random effect in mixed models\n\n- **Morphotype**: Coral morphological category\n  - *Type*: Categorical factor (verrucosa/meandrina/eydouxi)\n  - *Caveat*: Field identification only, no genetic confirmation\n  - *Distribution*: Uneven across sites\n\n### Physiological Variables (Position-Corrected)\n- **Condition score**: PC1 from PCA of physiological metrics\n  - *Type*: Continuous (standardized)\n  - *Scale*: Explains ~60% of physiological variance\n  - *Components*: Protein, carbohydrate, zooxanthellae, AFDW\n\n- **Individual physiological metrics**:\n  - Protein content (mg/cm\u00b2)\n  - Carbohydrate content (mg/cm\u00b2)\n  - Zooxanthellae density (cells/cm\u00b2)\n  - AFDW (mg/cm\u00b2)\n\n---\n\n## 5. Planned Endpoints and Metrics\n\n### Primary Endpoints\n1. **Community Composition**: PERMANOVA F-statistics and R\u00b2 values\n   - *Threshold*: p < 0.05 for significant effects\n   - *Effect size*: R\u00b2 > 0.05 for meaningful effects\n\n2. **Diversity-Volume Relationship**: Scaling exponent and R\u00b2\n   - *Threshold*: 95% CI excludes 0 for significant scaling\n   - *Expected*: Power law exponent ~0.75\n\n3. **Spatial Autocorrelation**: Moran's I coefficient\n   - *Threshold*: p < 0.05 for significant autocorrelation\n   - *Effect size*: |I| > 0.1 for meaningful clustering\n\n4. **Network Modularity**: Modularity coefficient Q\n   - *Threshold*: Q > 0.3 for significant modular structure\n   - *Comparison*: Against null model expectations\n\n### Secondary Endpoints\n- Model performance metrics (R\u00b2, AIC, cross-validation accuracy)\n- Individual species abundance patterns\n- Network centrality metrics for keystone identification\n- Residual spatial autocorrelation in models\n\n---\n\n## 6. Primary vs Secondary Analyses\n\n### Primary (Confirmatory) Analyses\n1. **PERMANOVA** on community composition ~ site + morphotype + depth\n2. **GLMM** for abundance/richness ~ volume + branch width + (1|site)\n3. **Moran's I** test for spatial autocorrelation in residuals\n4. **Network modularity** analysis with significance testing\n\n### Secondary (Exploratory) Analyses\n1. Machine learning models (Random Forest, XGBoost) for prediction\n2. Individual species response patterns\n3. Interaction effects (volume \u00d7 branch width)\n4. Temporal patterns (if multiple time points available)\n5. Keystone species identification via network centrality\n6. Local indicators of spatial association (LISA)\n\n---\n\n## 7. Risks and Confounders\n\n### Major Risks\n1. **Taxonomic Resolution Bias**\n   - *Risk*: OTU approach may lump/split true species\n   - *Mitigation*: Acknowledge limitation, focus on community patterns\n   - *Impact*: May obscure fine-scale ecological relationships\n\n2. **Position Sampling Bias**\n   - *Risk*: Larger corals sampled farther from base (r = 0.565)\n   - *Mitigation*: Use position-corrected physiological variables\n   - *Impact*: Could confound size-physiology relationships\n\n3. **Site-Specific Confounding**\n   - *Risk*: Unmeasured environmental differences between sites\n   - *Mitigation*: Include site as random effect, acknowledge limitations\n   - *Impact*: May attribute site effects to measured variables\n\n### Statistical Assumptions\n- **Assumption**: CAFI detection probability is constant across coral sizes\n- **Assumption**: OTU identifications are consistent across observers/time\n- **Assumption**: Coral morphotype classifications are reliable\n- **Assumption**: Spatial independence after accounting for autocorrelation\n\n### Missing Data Concerns\n1. **Incomplete Physiology**: Not all 204 corals have complete physiological data\n   - *Impact*: Reduced sample size for condition analyses\n   - *Mitigation*: Multiple imputation or complete-case analysis\n\n2. **Rare Species**: Many OTUs with few occurrences\n   - *Impact*: Low power for species-specific analyses\n   - *Mitigation*: Focus on abundant species or aggregate analyses\n\n### Design Limitations\n1. **Observational Design**: Cannot establish causation\n2. **Single Time Point**: No temporal replication\n3. **Limited Spatial Extent**: Three sites may not represent full diversity\n4. **Coral Taxonomy**: Field identification without genetic confirmation\n\n### Mitigation Strategies\n- Use robust statistical methods (GLMMs, permutation tests)\n- Report effect sizes alongside significance tests\n- Conduct sensitivity analyses excluding outliers/uncertain identifications\n- Acknowledge limitations explicitly in interpretation\n- Focus on pattern description rather than mechanistic claims\n\n---\n\n**Assumption**: All analyses assume that the 114 corals with complete data (vs. 204 total mentioned) represent an unbiased subset of the full survey.\n\n**Assumption**: The community matrix (114 \u00d7 243 species) represents the final cleaned dataset after quality control procedures.",
          "hypothesis_tree": {
            "umbrella_question": "To be extracted from brief",
            "nested_questions": [],
            "hypotheses": []
          },
          "variable_definitions": {
            "response_variables": [],
            "predictor_variables": [],
            "random_effects": []
          },
          "risk_analysis": [
            {
              "risk": "To be identified from project brief",
              "mitigation": "To be determined"
            }
          ]
        }
      }
    ],
    "literature": [
      {
        "timestamp": "2025-11-21T11:57:57.142126",
        "output": {
          "thematic_synthesis": "# Deep Literature Analysis: Coral-Associated Fauna Communities\n\n## 1. Thematic Synthesis\n\n### 1.1 Cryptic Reef Biodiversity and CAFI Communities\n\n**Well-Established Findings:**\n- Coral colonies harbor diverse cryptic fauna communities that significantly contribute to reef biodiversity (Stella et al. 2011; Plaisance et al. 2011)\n- Pocillopora corals specifically support rich assemblages of crabs, shrimp, fish, and gastropods across Indo-Pacific reefs (Coles 1980; Patton 1994)\n- Guardian crab mutualisms (Trapezia spp.) with Pocillopora are widespread and ecologically important (Glynn 1983; Stewart et al. 2006)\n- Cryptic fauna diversity often exceeds that of conspicuous reef organisms by orders of magnitude (Knowlton et al. 2010)\n\n**Debated Areas:**\n- Whether cryptic communities are primarily structured by deterministic (niche-based) vs. stochastic (dispersal-limited) processes\n- The relative importance of coral host identity vs. coral structural complexity in determining fauna composition\n- Temporal stability of cryptic associations across coral bleaching and recovery cycles\n\n### 1.2 Coral Morphology and Habitat Complexity Effects\n\n**Well-Established Findings:**\n- Coral architectural complexity strongly predicts associated fauna diversity (Vytopil & Willis 2001; Kerry & Bellwood 2012)\n- Branching corals generally support higher fauna diversity than massive growth forms (Stella et al. 2011)\n- Within-species morphological variation affects microhabitat availability and fauna assemblages (Todd 2008)\n- Surface area to volume ratios influence both coral physiology and fauna carrying capacity (Dornelas et al. 2006)\n\n**Debated Areas:**\n- Whether branch spacing (tight vs. wide) has consistent effects across different coral species and regions\n- The relative importance of coral size vs. structural complexity when both vary simultaneously\n- How coral growth form interacts with environmental gradients to shape fauna communities\n\n### 1.3 Species-Area Relationships and Scaling Laws\n\n**Well-Established Findings:**\n- Individual coral colonies exhibit species-area relationships analogous to island biogeography (Abele & Patton 1976; Patton 1994)\n- Power-law scaling exponents typically range from 0.2-0.35 for coral-associated fauna (Dornelas et al. 2006)\n- Larger coral colonies support disproportionately more rare species (Preston et al. 2016)\n\n**Debated Areas:**\n- Whether scaling relationships are consistent across different coral taxa and environmental contexts\n- The mechanisms underlying observed scaling exponents (habitat heterogeneity vs. passive sampling)\n- How coral mortality and fragmentation affect established species-area patterns\n\n### 1.4 Spatial Structure and Autocorrelation\n\n**Well-Established Findings:**\n- Marine communities commonly exhibit positive spatial autocorrelation due to dispersal limitation and environmental clustering (Legendre et al. 2005)\n- Coral reef communities show significant spatial structure at multiple scales (10s of meters to kilometers) (Dornelas et al. 2006)\n- Different taxonomic groups exhibit varying degrees of spatial clustering based on dispersal capabilities (Palumbi 2003)\n\n**Debated Areas:**\n- The spatial scales at which different ecological processes operate in coral reef systems\n- How anthropogenic disturbances alter natural spatial patterns in reef communities\n- Whether spatial autocorrelation reflects primarily environmental vs. biotic processes\n\n### 1.5 Network Approaches and Co-occurrence Patterns\n\n**Well-Established Findings:**\n- Ecological networks often exhibit modular structure reflecting functional groups and niche partitioning (Olesen et al. 2007)\n- Co-occurrence networks can identify keystone species and community assembly rules (Bascompte & Jordano 2007)\n- Network modularity provides insights into community stability and resilience (Th\u00e9bault & Fontaine 2010)\n\n**Debated Areas:**\n- Appropriate null models for testing significance of network properties in ecological systems\n- Whether network modules correspond to functional groups or simply reflect sampling artifacts\n- How to distinguish between positive interactions (facilitation) and shared environmental preferences in co-occurrence data\n\n### 1.6 Coral Physiology and Habitat Quality\n\n**Well-Established Findings:**\n- Coral tissue composition (protein, carbohydrate, lipid content) reflects nutritional status and environmental stress (Fitt et al. 2000)\n- Zooxanthellae density correlates with coral health and photosynthetic capacity (Muscatine et al. 1989)\n- Coral size affects physiological performance through surface area to volume scaling relationships (Sebens et al. 1997)\n\n**Debated Areas:**\n- Which physiological metrics best integrate overall coral \"condition\" or habitat quality\n- How coral physiology affects associated fauna beyond simple correlation patterns\n- Position effects on coral tissue composition and their implications for standardized sampling\n\n## 2. Gap Map\n\n### Gaps Addressed by Current Project:\n\n\u2022 **Multi-scale community structure analysis**: Few studies integrate local (within-coral), site-level, and network-scale patterns in a single system\n  - *Links to H3a, H4a*: Testing spatial autocorrelation and network modularity simultaneously\n\n\u2022 **Comprehensive coral morphology effects**: Limited quantitative analysis of how intraspecific morphological variation (branch width) affects fauna communities\n  - *Links to H2b*: Testing wide vs. tight branching effects on diversity\n\n\u2022 **Integrated physiological condition metrics**: Most studies examine single physiological variables rather than composite condition indices\n  - *Links to H2c*: Using PCA-derived condition scores to predict fauna patterns\n\n\u2022 **Network-based keystone identification**: Few applications of network centrality metrics to identify ecologically important species in coral systems\n  - *Links to H4c*: Using degree \u00d7 betweenness to identify keystone CAFI species\n\n\u2022 **Spatial autocorrelation in coral-fauna relationships**: Limited testing of whether coral-fauna relationships remain significant after accounting for spatial structure\n  - *Links to H3a, H3b*: Testing Moran's I and incorporating spatial effects in models\n\n\u2022 **Machine learning approaches**: Underutilization of ensemble methods for predicting coral-fauna relationships\n  - *Links to all hypotheses*: Using Random Forest/XGBoost to identify non-linear patterns and variable importance\n\n\u2022 **Position-corrected physiological analyses**: Recognition but limited correction for systematic sampling biases in coral physiology studies\n  - *Methodological contribution*: Position-corrected condition scores address known bias\n\n## 3. Methods-from-Literature Summary\n\n### Common Study Designs:\n- **Observational surveys** with stratified sampling across reef zones and coral morphotypes\n- **Mensurative experiments** comparing fauna across coral size classes or morphological categories  \n- **Transplant experiments** moving coral fragments to test environmental vs. genetic effects\n- **Time series** monitoring fauna communities through coral bleaching/recovery cycles\n\n### Standard Metrics:\n- **Alpha diversity**: Species richness, Shannon-Wiener index, Simpson's index\n- **Beta diversity**: Bray-Curtis dissimilarity, Jaccard similarity, Sorensen index\n- **Community composition**: Non-metric multidimensional scaling (NMDS), Principal Coordinates Analysis (PCoA)\n- **Network metrics**: Modularity (Q), clustering coefficient, degree centrality, betweenness centrality\n\n### Analysis Approaches:\n- **Multivariate statistics**: PERMANOVA, ANOSIM, SIMPER for community composition\n- **Mixed-effects models**: GLMMs with site/colony as random effects to account for hierarchical structure\n- **Spatial statistics**: Moran's I, Mantel tests, spatial eigenvector mapping\n- **Network analysis**: Louvain algorithm for module detection, null model comparisons\n- **Machine learning**: Random Forest for variable importance, ensemble methods for prediction\n\n### Sampling Considerations:\n- **Standardized effort**: Fixed time searches or exhaustive sampling of coral colonies\n- **Taxonomic resolution**: Field identification to morphospecies vs. DNA barcoding\n- **Coral selection**: Random vs. stratified sampling across size/morphology gradients\n- **Spatial design**: Nested sampling (sites > transects > corals) to separate spatial scales\n\n## 4. Draft Intro Outline\n\n### I. Introduction\n\n#### A. Coral Reefs as Biodiversity Hotspots\n- Emphasize cryptic diversity and habitat complexity (Stella et al. 2011; Knowlton et al. 2010)\n- Introduce coral-associated fauna (CAFI) as model system for understanding biodiversity patterns\n\n#### B. Coral Colonies as Habitat Islands  \n- Present species-area theory applied to individual coral colonies (Abele & Patton 1976)\n- Discuss habitat heterogeneity and niche availability in branching corals (Kerry & Bellwood 2012)\n\n#### C. Pocillopora as Model System\n- Review Pocillopora ecology and morphological variation across Indo-Pacific (Coles 1980)\n- Highlight guardian crab mutualisms and other key associations (Glynn 1983; Stewart et al. 2006)\n\n#### D. Factors Structuring Coral-Associated Communities\n- **Physical factors**: Coral size, morphology, and architectural complexity (Vytopil & Willis 2001)\n- **Physiological factors**: Coral health, tissue composition, and resource availability (Fitt et al. 2000)\n- **Spatial factors**: Environmental gradients and dispersal limitation (Legendre et al. 2005)\n\n#### E. Network Approaches to Community Structure\n- Introduce co-occurrence networks and modularity in ecological systems (Bascompte & Jordano 2007)\n- Discuss keystone species identification through network centrality (Olesen et al. 2007)\n\n#### F. Study Objectives and Hypotheses\n- Present four research questions addressing community composition, coral effects, spatial structure, and network patterns\n- State specific hypotheses linking coral traits to CAFI community metrics\n\n### II. Methods\n\n#### A. Study System and Site Description\n- Mo'orea LTER site characteristics and reef zonation\n- Pocillopora morphotype distributions and ecological context\n\n#### B. Field Sampling Protocol  \n- Coral selection criteria and CAFI extraction methods\n- Morphological measurements and physiological sampling procedures\n\n#### C. Laboratory Analysis\n- CAFI identification and OTU designation protocols\n- Coral tissue analysis for physiological condition metrics\n\n#### D. Statistical Analysis\n- Community composition analysis (PERMANOVA, NMDS)\n- Mixed-effects modeling approach for coral-CAFI relationships\n- Spatial autocorrelation testing and network analysis methods\n\n*Note: This outline integrates established literature with the specific innovations of the current study, emphasizing how the work addresses identified gaps while building on solid theoretical foundations.*\n\n**Uncertainty flags**: Some specific citation years and author combinations may need verification. The scaling exponent range (0.2-0.35) for coral-associated fauna should be confirmed against primary literature. Network analysis applications to coral systems may be more limited than suggested.",
          "gap_analysis": "# Gap Analysis\n\n[See thematic synthesis]",
          "methods_summary": "# Methods from Literature\n\n[See thematic synthesis]",
          "intro_outline": "# Draft Introduction Outline\n\n[See thematic synthesis]"
        }
      }
    ],
    "framework": [
      {
        "timestamp": "2025-11-21T11:58:37.323287",
        "output": {
          "conceptual_frameworks": "# Conceptual Framework for Coral-Associated Fauna Communities\n\n## 1. Framework Descriptions\n\n### Framework 1: Habitat-Mediated Community Assembly Framework\n\n**Name**: Habitat-Mediated Community Assembly Framework for Coral-Associated Fauna (CAFI)\n\n**Key Entities and Processes**:\n- **Environmental Context**: Reef zone characteristics (fringing, lagoon, barrier) that create distinct abiotic conditions including hydrodynamics, nutrient availability, temperature regimes, and predation pressure\n- **Coral Host Properties**: Physical architecture (volume, surface area, branch morphology) and physiological condition (tissue composition, zooxanthellae density, metabolic status)\n- **Microhabitat Generation**: The transformation of coral physical and physiological properties into available niche space and resource availability for associated fauna\n- **Community Assembly Filters**: Sequential filtering processes including dispersal limitation, habitat matching, and biotic interactions that determine which species can establish and persist\n- **Spatial Structuring Processes**: Distance-decay relationships, environmental clustering, and connectivity patterns that create spatial autocorrelation in community composition\n\n**Predictive Mechanisms**:\n1. **Habitat Size Effect**: Larger coral volumes provide proportionally more microhabitat space, following power-law scaling relationships that predict higher CAFI abundance and richness\n2. **Architectural Complexity Effect**: Coral morphological traits (especially branch spacing) determine structural complexity and niche diversity, with wide-branching morphotypes supporting higher diversity than tight-branching forms\n3. **Physiological Quality Effect**: Coral condition mediates habitat quality through resource availability and metabolic byproducts, with healthier corals supporting more abundant and diverse fauna communities\n4. **Environmental Filtering Effect**: Reef zone characteristics filter regional species pools, creating predictable differences in community composition across environmental gradients\n5. **Spatial Aggregation Effect**: Limited dispersal and environmental clustering create positive spatial autocorrelation, with strength varying by taxonomic group based on mobility and life history traits\n\n### Framework 2: Multi-Scale Network Assembly Framework\n\n**Name**: Multi-Scale Network Assembly Framework for CAFI Co-occurrence Patterns\n\n**Key Entities and Processes**:\n- **Species Pool**: Regional CAFI species available for colonization across Mo'orea reef systems\n- **Functional Groups**: Taxonomically and ecologically coherent groups (crabs, shrimp, fish, gastropods) with similar resource requirements and ecological roles\n- **Co-occurrence Networks**: Statistical associations between species pairs that reflect shared habitat preferences, facilitative interactions, or competitive exclusion\n- **Network Modules**: Clusters of strongly co-occurring species that represent functional communities or niche-based assemblages\n- **Keystone Species**: Taxa with high network centrality that disproportionately influence community assembly and stability\n\n**Predictive Mechanisms**:\n1. **Functional Modularity**: Species with similar ecological requirements and resource use patterns form network modules, creating predictable co-occurrence blocks\n2. **Keystone Facilitation**: Species with high degree and betweenness centrality facilitate colonization and persistence of other taxa through habitat modification or resource provisioning\n3. **Niche Complementarity**: Within modules, species exhibit resource partitioning that reduces competition and promotes coexistence\n4. **Hierarchical Assembly**: Network structure emerges from nested processes operating at coral (microhabitat), site (environmental), and regional (biogeographic) scales\n\n## 2. Diagram Description\n\n### Figure 1: Conceptual Framework Schematic\n\n**Panel A: Habitat-Mediated Assembly Process (Top Half)**\n- **Left side**: Environmental context box showing three reef zones (HAU-fringing, MAT-lagoon, MRB-barrier) with arrows indicating environmental gradients (wave energy, nutrients, temperature)\n- **Center**: Coral host characteristics depicted as branching coral silhouettes of different sizes and morphologies, with internal indicators of physiological condition (color-coded from stressed=red to healthy=green)\n- **Right side**: CAFI community representation showing taxonomic groups (crabs, shrimp, fish, gastropods) with abundance indicated by symbol size and diversity by number of different symbols\n\n**Connecting Elements**:\n- Thick arrows from environmental context to coral characteristics (labeled \"Environmental Filtering\")\n- Medium arrows from coral characteristics to CAFI communities (labeled \"Habitat Provisioning\")\n- Dashed feedback arrow from CAFI to coral condition (labeled \"Potential Feedback\")\n\n**Panel B: Network Assembly Structure (Bottom Half)**\n- **Left**: Individual coral colonies shown as circles with internal network diagrams representing within-coral species co-occurrence patterns\n- **Center**: Site-level network showing connections between coral colonies, with line thickness indicating community similarity\n- **Right**: Regional network modules depicted as colored clusters of species nodes, with keystone species highlighted as larger nodes with high connectivity\n\n**Connecting Elements**:\n- Hierarchical arrows showing scale transitions (coral \u2192 site \u2192 regional)\n- Color-coding to show how local modules contribute to regional network structure\n- Centrality metrics displayed as node size and connection strength\n\n**Labels and Annotations**:\n- Scale indicators (meters to kilometers)\n- Process labels (Assembly Filters, Spatial Autocorrelation, Network Modularity)\n- Hypothesis connections (H1a-H4c) linked to specific diagram elements\n- Legend showing symbol meanings for taxa, coral conditions, and network properties\n\n## 3. Plain-Language Narrative\n\nCoral colonies function as discrete habitat islands within the broader reef ecosystem, each supporting a unique assemblage of small invertebrates and fish collectively known as coral-associated fauna (CAFI). Our conceptual framework proposes that CAFI community structure emerges through a hierarchical process of habitat-mediated assembly, where environmental conditions shape coral host characteristics, which in turn determine the availability and quality of microhabitats for associated species. This process operates across multiple spatial scales, from individual coral colonies to reef-wide patterns, creating predictable relationships between coral traits and community properties.\n\nAt the foundation of this framework lies the recognition that coral colonies vary dramatically in their capacity to support associated fauna communities. Physical characteristics such as colony size and branching morphology directly determine the amount and complexity of available habitat space, following well-established species-area relationships where larger and more architecturally complex corals support proportionally more species. Simultaneously, coral physiological condition\u2014integrating tissue composition, zooxanthellae density, and metabolic status\u2014influences habitat quality through resource availability and environmental buffering. These coral-level processes are embedded within broader environmental gradients across reef zones, creating systematic differences in community composition that reflect both local habitat characteristics and regional species pools.\n\nThe framework extends beyond simple coral-fauna relationships to incorporate the network structure of species co-occurrence patterns, recognizing that CAFI communities are not random assemblages but exhibit predictable associations reflecting shared ecological requirements and potential interactions. We propose that these co-occurrence networks exhibit modular structure, with groups of strongly associated species forming functional communities that correspond to major taxonomic and ecological groupings. Within this network structure, certain species may function as keystones, facilitating the establishment and persistence of other taxa through habitat modification, resource provisioning, or other ecological services.\n\nThis multi-scale perspective bridges individual-level ecological processes with community-level patterns, providing a mechanistic framework for understanding how local coral characteristics scale up to influence broader patterns of reef biodiversity. By integrating habitat heterogeneity theory, network ecology, and coral reef biology, this framework generates testable predictions about the factors controlling cryptic reef biodiversity while highlighting the central role of coral hosts as ecosystem engineers that structure associated biological communities across multiple spatial and organizational scales.",
          "figure1_design": "# Figure 1 Design\n\n[See conceptual frameworks]",
          "narrative": "# Framework Narrative\n\n[See conceptual frameworks]"
        }
      }
    ],
    "data_qa": [
      {
        "timestamp": "2025-11-21T11:59:42.845546",
        "output": {
          "qa_playbook": "# Data Quality Assurance Playbook\n## CAFI Survey Analysis - Mo'orea Coral-Associated Fauna Communities\n\n---\n\n## 1. Structural Expectations\n\n### 1.1 Dataset Architecture\n```\nPrimary Tables:\n- survey_master (114 \u00d7 354): Master dataset with all variables\n- cafi_clean (3989 \u00d7 40): Individual CAFI observations  \n- coral_clean (114 \u00d7 58): Coral colony characteristics\n- physio_clean (108 \u00d7 51): Physiological measurements\n- community_matrix (114 \u00d7 243): Species abundance matrix\n- env_data (114 \u00d7 54): Environmental variables\n- metadata (114 \u00d7 10): Survey metadata\n```\n\n### 1.2 Key Relationships and Join Logic\n```\nPrimary Keys:\n- coral_id: Unique identifier for each coral colony (1-114)\n- cafi_id: Unique identifier for each CAFI observation\n- otu_id: Unique identifier for each taxonomic unit\n\nJoin Structure:\nsurvey_master \u2190\u2192 coral_clean (1:1 on coral_id)\nsurvey_master \u2190\u2192 physio_clean (1:0..1 on coral_id, 6 missing)\ncoral_clean \u2190\u2192 cafi_clean (1:many on coral_id)\ncafi_clean \u2192 community_matrix (aggregated counts by coral_id \u00d7 otu_id)\ncoral_clean \u2190\u2192 env_data (1:1 on coral_id)\ncoral_clean \u2190\u2192 metadata (1:1 on coral_id)\n```\n\n### 1.3 Expected Cardinalities\n- **Total corals surveyed**: 204 (mentioned in PRD)\n- **Corals with complete data**: 114 (in analysis datasets)\n- **CAFI observations**: 3989 individual records\n- **Unique OTUs**: 243 taxonomic units\n- **Sites**: 3 (HAU, MAT, MRB)\n- **Expected site distribution**: HAU=38, MAT=39, MRB=37 corals\n\n---\n\n## 2. Variable-wise Quality Checks\n\n### 2.1 Identifier Variables\n```\ncoral_id:\n- Type: Integer/Character\n- Range: 1-114 (or consistent naming scheme)\n- Missingness: 0% allowed\n- Uniqueness: 100% unique within each dataset\n- Cross-table consistency: Must match across all datasets\n\nsite:\n- Type: Factor\n- Allowable values: {\"HAU\", \"MAT\", \"MRB\"}\n- Missingness: 0% allowed\n- Expected distribution: ~33% each \u00b1 10%\n```\n\n### 2.2 Response Variables\n```\nCAFI Abundance (per coral):\n- Type: Non-negative integer\n- Range: 1-200 (based on PRD expectations)\n- Missingness: 0% for corals in analysis\n- Distribution: Likely right-skewed, zero-inflated possible\n- Outlier threshold: > 3 SD from log-transformed mean\n\nCAFI Richness (OTUs per coral):\n- Type: Positive integer  \n- Range: 1-50 (PRD expectation: 3-25)\n- Missingness: 0% allowed\n- Constraint: richness \u2264 abundance\n- Outlier threshold: Outside 1-50 range\n\nShannon Diversity:\n- Type: Continuous, non-negative\n- Range: 0 to log(max_richness)\n- Expected range: 0.5-3.0 (per PRD)\n- Missingness: 0% for corals with CAFI\n- Constraint: H' = 0 only if richness = 1\n```\n\n### 2.3 Coral Physical Variables\n```\nCoral Volume:\n- Type: Continuous, positive\n- Range: 50-5000 cm\u00b3 (per PRD)\n- Missingness: 0% allowed\n- Log-transformation: Check for log-normal distribution\n- Outlier threshold: < 10 cm\u00b3 or > 10,000 cm\u00b3\n\nCoral Surface Area:\n- Type: Continuous, positive\n- Range: 100-3000 cm\u00b2 (derived from volume)\n- Constraint: Biologically plausible volume:surface ratio\n- Correlation check: Strong positive correlation with volume\n\nBranch Width:\n- Type: Binary factor\n- Levels: {\"tight\", \"wide\"} or {0, 1}\n- Missingness: 0% allowed\n- Expected distribution: ~50/50 \u00b1 20%\n\nMorphotype:\n- Type: Factor\n- Levels: {\"verrucosa\", \"meandrina\", \"eydouxi\"}\n- Missingness: 0% allowed\n- Site association: Check for non-random distribution\n```\n\n### 2.4 Environmental Variables\n```\nDepth:\n- Type: Continuous, positive\n- Range: 2-15 meters (per PRD)\n- Missingness: 0% allowed\n- Site-specific ranges: Different per site expected\n- Precision: Reasonable to 0.1m\n\nPosition (sampling bias variable):\n- Type: Continuous\n- Correlation with volume: Expected r \u2248 0.565\n- Use: For position-corrected physiology variables\n```\n\n### 2.5 Physiological Variables\n```\nCondition Score (PC1):\n- Type: Continuous (standardized)\n- Range: Typically -3 to +3 for standardized scores\n- Missingness: 5.3% allowed (6/114 corals)\n- Distribution: Should be approximately normal\n- Variance explained: ~60% (per PRD)\n\nIndividual Metrics:\nProtein Content:\n- Type: Continuous, non-negative\n- Units: mg/cm\u00b2\n- Range: Biologically plausible (0.1-10 mg/cm\u00b2)\n- Missingness: Same as condition score\n\nCarbohydrate Content:\n- Type: Continuous, non-negative  \n- Units: mg/cm\u00b2\n- Range: Biologically plausible (0.1-20 mg/cm\u00b2)\n\nZooxanthellae Density:\n- Type: Continuous, positive\n- Units: cells/cm\u00b2\n- Range: 10\u2074-10\u2077 cells/cm\u00b2 (typical for corals)\n- Log-transformation: Likely needed\n\nAFDW (Ash-Free Dry Weight):\n- Type: Continuous, positive\n- Units: mg/cm\u00b2\n- Range: 0.1-50 mg/cm\u00b2 (typical range)\n```\n\n### 2.6 Community Matrix Variables\n```\nSpecies Abundance:\n- Type: Non-negative integer\n- Range: 0 to max observed abundance\n- Sparsity: Expected high proportion of zeros\n- Row sums: Must equal total CAFI abundance per coral\n- Column sums: Total abundance per OTU across corals\n\nOTU Identifiers:\n- Type: Character/Factor\n- Format: Consistent naming convention\n- Uniqueness: 243 unique values expected\n- Missingness: 0% allowed\n```\n\n---\n\n## 3. Global QA Checks\n\n### 3.1 Outlier Detection\n```\nUnivariate Outliers:\n- Method: Modified Z-score > 3.5 for continuous variables\n- Method: IQR rule (Q3 + 1.5\u00d7IQR) for count data\n- Variables: Volume, surface area, depth, abundance, richness\n- Action: Flag, don't remove automatically\n\nMultivariate Outliers:\n- Method: Mahalanobis distance > \u03c7\u00b2 critical value\n- Variables: Coral physical characteristics\n- Method: Isolation Forest for high-dimensional data\n- Community data: Bray-Curtis distance > 2 SD from centroid\n\nBiological Implausibility:\n- Volume:surface area ratios outside 0.1-2.0 range\n- Shannon diversity > log(richness)\n- Abundance < richness (impossible)\n- Physiological values outside literature ranges\n```\n\n### 3.2 Duplicate Detection\n```\nExact Duplicates:\n- Check: Identical rows across all variables\n- Scope: Within and across datasets\n- Tolerance: 0 for identifiers, small epsilon for measurements\n\nNear Duplicates:\n- Coral characteristics: Euclidean distance < 0.01 (scaled)\n- GPS coordinates: Distance < 1 meter (if available)\n- CAFI observations: Same coral_id + otu_id combinations\n- Physiological measurements: Correlation > 0.99\n\nIdentifier Conflicts:\n- Same coral_id with different characteristics\n- Same GPS coordinates with different coral_ids\n- Inconsistent site assignments for same coral_id\n```\n\n### 3.3 Time Series Consistency\n```\nTemporal Variables (if applicable):\n- Collection date: Consistent format (YYYY-MM-DD)\n- Date range: Reasonable survey period (days to months)\n- Seasonal effects: Check for temporal clustering\n- Missing dates: Flag corals without collection dates\n\nSequential Consistency:\n- Sample processing order vs. collection order\n- Batch effects in physiological measurements\n- Observer effects over time (if multiple observers)\n```\n\n### 3.4 Cross-Dataset Consistency\n```\nSample Size Alignment:\n- coral_clean (114) = survey_master (114) \u2713\n- physio_clean (108) = survey_master subset \u2713\n- community_matrix rows (114) = coral_clean (114) \u2713\n- cafi_clean aggregated counts = community_matrix \u2713\n\nVariable Consistency:\n- Same coral_id has same site across datasets\n- Same coral_id has same morphotype across datasets\n- Derived variables match calculations\n- Units consistent across datasets\n\nReferential Integrity:\n- All coral_ids in physio_clean exist in coral_clean\n- All coral_ids in cafi_clean exist in coral_clean\n- All otu_ids in community_matrix have corresponding records\n```\n\n---\n\n## 4. QA Plots and Summaries\n\n### 4.1 Distribution Diagnostics (8 plots)\n1. **Histogram grid**: All continuous variables with density overlays\n2. **Q-Q plots**: Normality assessment for key variables\n3. **Box plots by site**: Distribution differences across sites\n4. **Log-scale histograms**: Volume, surface area, abundance, zooxanthellae\n5. **Bar plots**: Categorical variables (site, morphotype, branch width)\n6. **Correlation heatmap**: All continuous variables with hierarchical clustering\n7. **Missing data pattern**: Visualization of missing data structure\n8. **Outlier detection plot**: Mahalanobis distance vs. observation index\n\n### 4.2 Relationship Diagnostics (6 plots)\n9. **Volume vs. surface area**: Expected allometric relationship\n10. **Abundance vs. richness**: Species-area relationship\n11. **Position vs. volume**: Documented sampling bias (r \u2248 0.565)\n12. **Depth by site**: Site-specific depth distributions\n13. **Physiological PCA biplot**: PC1 vs. PC2 with variable loadings\n14. **Community composition PCA**: First two axes with site/morphotype colors\n\n### 4.3 Spatial and Temporal Diagnostics (3 plots)\n15. **Site map**: Coral locations if GPS available\n16. **Temporal distribution**: Collection dates over survey period\n17. **Spatial autocorrelation**: Moran's I correlograms if coordinates available\n\n### 4.4 Data Quality Summaries (3 summaries)\n18. **Completeness report**: Missing data percentages by variable and dataset\n19. **Outlier summary table**: Flagged observations with reasons\n20. **Cross-validation summary**: Consistency checks between datasets\n\n---\n\n## 5. Code Skeleton\n\n### 5.1 R Implementation Framework\n```r\n# Load required libraries\nlibrary(tidyverse)\nlibrary(VIM)          # Missing data visualization\nlibrary(corrplot)     # Correlation plots\nlibrary(car)          # Outlier detection\nlibrary(vegan)        # Community ecology functions\n\n# Main QA function\nrun_cafi_qa <- function(data_list) {\n  \n  # Initialize QA report\n  qa_report <- list(\n    timestamp = Sys.time(),\n    datasets = names(data_list),\n    flags = list(),\n    plots = list(),\n    summaries = list()\n  )\n  \n  # 1. STRUCTURAL CHECKS\n  qa_report$structural <- check_structure(data_list)\n  \n  # 2. VARIABLE-WISE CHECKS  \n  qa_report$variables <- check_variables(data_list)\n  \n  # 3. GLOBAL CHECKS\n  qa_report$global <- check_global_quality(data_list)\n  \n  # 4. GENERATE PLOTS\n  qa_report$plots <- generate_qa_plots(data_list)\n  \n  # 5. COMPILE SUMMARY\n  qa_report$summary <- compile_qa_summary(qa_report)\n  \n  return(qa_report)\n}\n\n# Structural validation\ncheck_structure <- function(data_list) {\n  \n  structure_checks <- list()\n  \n  # Check expected dimensions\n  expected_dims <- list(\n    survey_master = c(114, 354),\n    cafi_clean = c(3989, 40),\n    coral_clean = c(114, 58),\n    physio_clean = c(108, 51),\n    community_matrix = c(114, 243),\n    env_data = c(114, 54),\n    metadata = c(114, 10)\n  )\n  \n  for(dataset in names(expected_dims)) {\n    if(dataset %in% names(data_list)) {\n      actual_dims <- dim(data_list[[dataset]])\n      expected <- expected_dims[[dataset]]\n      \n      structure_checks[[dataset]] <- list(\n        expected_rows = expected[1],\n        actual_rows = actual_dims[1],\n        expected_cols = expected[2], \n        actual_cols = actual_dims[2],\n        rows_match = actual_dims[1] == expected[1],\n        cols_match = actual_dims[2] == expected[2]\n      )\n    }\n  }\n  \n  # Check join keys\n  structure_checks$join_integrity <- check_join_keys(data_list)\n  \n  return(structure_checks)\n}\n\n# Variable validation\ncheck_variables <- function(data_list) {\n  \n  var_checks <- list()\n  \n  # Response variables\n  if(\"survey_master\" %in% names(data_list)) {\n    df <- data_list$survey_master\n    \n    # CAFI abundance checks\n    if(\"cafi_abundance\" %in% names(df)) {\n      var_checks$cafi_abundance <- list(\n        type_correct = is.numeric(df$cafi_abundance),\n        non_negative = all(df$cafi_abundance >= 0, na.rm = TRUE),\n        range_check = range(df$cafi_abundance, na.rm = TRUE),\n        within_expected = all(df$cafi_abundance <= 200, na.rm = TRUE),\n        missing_count = sum(is.na(df$cafi_abundance)),\n        outliers = identify_outliers(df$cafi_abundance)\n      )\n    }\n    \n    # Coral volume checks\n    if(\"coral_volume\" %in% names(df)) {\n      var_checks$coral_volume <- list(\n        type_correct = is.numeric(df$coral_volume),\n        positive = all(df$coral_volume > 0, na.rm = TRUE),\n        range_check = range(df$coral_volume, na.rm = TRUE),\n        within_expected = all(df$coral_volume >= 50 & df$coral_volume <= 5000, na.rm = TRUE),\n        log_normal = test_log_normality(df$coral_volume),\n        outliers = identify_outliers(log(df$coral_volume))\n      )\n    }\n    \n    # Site variable checks\n    if(\"site\" %in% names(df)) {\n      var_checks$site <- list(\n        type_correct = is.factor(df$site) || is.character(df$site),\n        valid_levels = all(df$site %in% c(\"HAU\", \"MAT\", \"MRB\")),\n        missing_count = sum(is.na(df$site)),\n        distribution = table(df$site),\n        balanced = check_site_balance(df$site)\n      )\n    }\n  }\n  \n  ",
          "qa_checks": "# QA Checks\n\n[See playbook]",
          "code_snippets": "# QA Code Snippets\n\n[See playbook]",
          "qa_report_template": "# QA Report Template\n\n[See playbook]"
        }
      }
    ],
    "eda": [
      {
        "timestamp": "2025-11-21T12:00:59.808592",
        "output": {
          "eda_plan": "# Exploratory Data Analysis Plan\n## CAFI Survey Analysis - Mo'orea Coral-Associated Fauna Communities\n\n---\n\n## 1. EDA Plan Structure\n\n### 1.1 Response Variable Focus Areas\n\n**Primary Response Variables:**\n- CAFI abundance (count per coral)\n- CAFI richness (OTUs per coral) \n- Shannon diversity index\n- Community composition (multivariate)\n\n**Analysis Organization:**\n1. **Univariate Response Patterns** - Distribution shapes, outliers, transformations\n2. **Response-Predictor Relationships** - Bivariate associations with key predictors\n3. **Multivariate Response Structure** - Community composition patterns\n4. **Spatial Response Patterns** - Geographic clustering and autocorrelation\n\n### 1.2 Key Predictor Categories\n\n**Environmental Predictors:**\n- Site (HAU/MAT/MRB) - categorical\n- Depth (2-15m) - continuous\n- Spatial coordinates (if available) - continuous\n\n**Coral Physical Predictors:**\n- Volume (50-5000 cm\u00b3) - continuous, log-transformed\n- Surface area (derived) - continuous, log-transformed\n- Branch width (tight/wide) - binary categorical\n- Morphotype (verrucosa/meandrina/eydouxi) - categorical\n\n**Coral Physiological Predictors:**\n- Condition score (PC1) - continuous, standardized\n- Individual metrics (protein, carbohydrate, zooxanthellae, AFDW) - continuous\n\n### 1.3 Analysis Sequence\n\n**Phase 1: Univariate Exploration**\n- Distribution assessment for all variables\n- Outlier identification and biological plausibility\n- Transformation needs evaluation\n\n**Phase 2: Bivariate Relationships**\n- Response-predictor associations\n- Predictor-predictor correlations and confounding\n- Site-specific patterns\n\n**Phase 3: Multivariate Patterns**\n- Community composition ordination\n- Species abundance distributions\n- Co-occurrence networks (preliminary)\n\n**Phase 4: Spatial Structure**\n- Spatial autocorrelation assessment\n- Site-level clustering patterns\n- Distance-decay relationships\n\n---\n\n## 2. Plot Catalog\n\n### 2.1 Univariate Distribution Plots (6 plots)\n\n**Plot 1: Response Variable Distributions**\n- *Description*: 2\u00d72 panel of histograms with density overlays\n- *Variables*: Abundance, richness, Shannon diversity, Simpson diversity\n- *Purpose*: Assess distribution shapes, identify zero-inflation, evaluate transformation needs\n- *Code outline*:\n```r\nresponse_vars %>% \n  pivot_longer(cols = c(abundance, richness, shannon, simpson)) %>%\n  ggplot(aes(x = value)) + \n  geom_histogram(aes(y = ..density..), alpha = 0.7) +\n  geom_density(color = \"red\", size = 1) +\n  facet_wrap(~name, scales = \"free\") +\n  labs(title = \"Response Variable Distributions\")\n```\n\n**Plot 2: Coral Physical Variable Distributions**\n- *Description*: Log-scale histograms for volume and surface area, regular histograms for depth\n- *Variables*: log(volume), log(surface_area), depth\n- *Purpose*: Evaluate log-normality assumptions, identify outliers\n- *Code outline*:\n```r\ncoral_vars %>%\n  mutate(log_volume = log(volume), log_surface = log(surface_area)) %>%\n  select(log_volume, log_surface, depth) %>%\n  pivot_longer(everything()) %>%\n  ggplot(aes(x = value)) + \n  geom_histogram(bins = 20, alpha = 0.7) +\n  facet_wrap(~name, scales = \"free\")\n```\n\n**Plot 3: Categorical Variable Distributions**\n- *Description*: Bar plots for site, morphotype, branch width\n- *Variables*: Site, morphotype, branch_width\n- *Purpose*: Check sample balance, identify potential confounding\n- *Code outline*:\n```r\ncategorical_vars %>%\n  pivot_longer(c(site, morphotype, branch_width)) %>%\n  ggplot(aes(x = value)) + \n  geom_bar(aes(fill = value), alpha = 0.8) +\n  facet_wrap(~name, scales = \"free_x\") +\n  theme(axis.text.x = element_text(angle = 45))\n```\n\n**Plot 4: Physiological Variable Distributions**\n- *Description*: Histograms for condition score and individual metrics\n- *Variables*: Condition score, protein, carbohydrate, zooxanthellae, AFDW\n- *Purpose*: Assess normality of condition score, identify physiological outliers\n- *Code outline*:\n```r\nphysio_vars %>%\n  select(condition_score, protein, carbohydrate, zooxanthellae, afdw) %>%\n  pivot_longer(everything()) %>%\n  ggplot(aes(x = value)) + \n  geom_histogram(bins = 15) +\n  facet_wrap(~name, scales = \"free\")\n```\n\n**Plot 5: Species Abundance Distribution**\n- *Description*: Rank-abundance curve and frequency histogram\n- *Variables*: Species total abundances across all corals\n- *Purpose*: Assess community structure, identify dominant vs. rare species\n- *Code outline*:\n```r\nspecies_abundances %>%\n  arrange(desc(total_abundance)) %>%\n  mutate(rank = row_number()) %>%\n  ggplot(aes(x = rank, y = total_abundance)) +\n  geom_point() + geom_line() +\n  scale_y_log10() +\n  labs(title = \"Species Rank-Abundance Curve\")\n```\n\n**Plot 6: Zero-Inflation Assessment**\n- *Description*: Proportion of zeros by coral and by species\n- *Variables*: Community matrix zero patterns\n- *Purpose*: Quantify sparsity, inform modeling choices\n- *Code outline*:\n```r\n# Zeros by coral\ncoral_zeros <- community_matrix %>% \n  rowwise() %>% \n  summarise(prop_zeros = sum(c_across(everything()) == 0) / ncol(.))\n# Plot histogram of zero proportions\n```\n\n### 2.2 Bivariate Relationship Plots (8 plots)\n\n**Plot 7: Volume-Abundance Scaling**\n- *Description*: Log-log scatter plot with fitted power law\n- *Variables*: log(volume) vs log(abundance)\n- *Purpose*: Test species-area relationship, estimate scaling exponent\n- *Code outline*:\n```r\nggplot(data, aes(x = log(volume), y = log(abundance))) +\n  geom_point(aes(color = site), alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = TRUE, color = \"black\") +\n  labs(title = \"Volume-Abundance Scaling Relationship\")\n```\n\n**Plot 8: Volume-Diversity Relationships**\n- *Description*: 2\u00d72 panel showing volume vs. richness, Shannon, Simpson\n- *Variables*: Volume vs. diversity metrics\n- *Purpose*: Assess habitat size effects on different diversity measures\n- *Code outline*:\n```r\ndiversity_metrics %>%\n  pivot_longer(c(richness, shannon, simpson)) %>%\n  ggplot(aes(x = log(volume), y = value)) +\n  geom_point(aes(color = site)) +\n  geom_smooth(method = \"lm\") +\n  facet_wrap(~name, scales = \"free_y\")\n```\n\n**Plot 9: Depth Effects by Site**\n- *Description*: Scatter plots of depth vs. response variables, colored by site\n- *Variables*: Depth vs. abundance, richness, Shannon diversity\n- *Purpose*: Identify depth gradients and site-specific patterns\n- *Code outline*:\n```r\nresponse_vars %>%\n  pivot_longer(c(abundance, richness, shannon)) %>%\n  ggplot(aes(x = depth, y = value, color = site)) +\n  geom_point(alpha = 0.7) +\n  geom_smooth(method = \"loess\", se = FALSE) +\n  facet_wrap(~name, scales = \"free_y\")\n```\n\n**Plot 10: Morphotype Effects**\n- *Description*: Box plots of response variables by morphotype\n- *Variables*: Morphotype vs. abundance, richness, Shannon diversity\n- *Purpose*: Compare community metrics across coral morphological types\n- *Code outline*:\n```r\nresponse_vars %>%\n  pivot_longer(c(abundance, richness, shannon)) %>%\n  ggplot(aes(x = morphotype, y = value, fill = morphotype)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.5) +\n  facet_wrap(~name, scales = \"free_y\")\n```\n\n**Plot 11: Branch Width Effects**\n- *Description*: Box plots comparing tight vs. wide branching corals\n- *Variables*: Branch width vs. response variables\n- *Purpose*: Test structural complexity effects on CAFI communities\n- *Code outline*:\n```r\nggplot(data, aes(x = branch_width, y = shannon, fill = branch_width)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2) +\n  facet_wrap(~site) +\n  labs(title = \"Branch Width Effects on Shannon Diversity by Site\")\n```\n\n**Plot 12: Condition Score Relationships**\n- *Description*: Scatter plots of condition score vs. response variables\n- *Variables*: Condition score vs. abundance, richness, Shannon\n- *Purpose*: Assess coral health effects on associated fauna\n- *Code outline*:\n```r\nresponse_vars %>%\n  pivot_longer(c(abundance, richness, shannon)) %>%\n  ggplot(aes(x = condition_score, y = value)) +\n  geom_point(aes(color = site), alpha = 0.7) +\n  geom_smooth(method = \"lm\") +\n  facet_wrap(~name, scales = \"free_y\")\n```\n\n**Plot 13: Predictor Correlation Matrix**\n- *Description*: Correlation heatmap with hierarchical clustering\n- *Variables*: All continuous predictors\n- *Purpose*: Identify multicollinearity, understand predictor relationships\n- *Code outline*:\n```r\ncor_matrix <- cor(continuous_predictors, use = \"pairwise.complete.obs\")\ncorrplot(cor_matrix, method = \"color\", order = \"hclust\", \n         tl.cex = 0.8, tl.col = \"black\")\n```\n\n**Plot 14: Position Bias Visualization**\n- *Description*: Scatter plot of position vs. volume with correlation\n- *Variables*: Position vs. volume, colored by physiological metrics\n- *Purpose*: Visualize documented sampling bias (r \u2248 0.565)\n- *Code outline*:\n```r\nggplot(data, aes(x = position, y = log(volume))) +\n  geom_point(aes(color = condition_score), alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = TRUE) +\n  labs(title = \"Position Sampling Bias (r \u2248 0.565)\")\n```\n\n### 2.3 Multivariate Community Plots (6 plots)\n\n**Plot 15: Community Composition Ordination**\n- *Description*: NMDS or PCoA of Bray-Curtis distances\n- *Variables*: Community composition matrix\n- *Purpose*: Visualize overall community structure and site clustering\n- *Code outline*:\n```r\nnmds_result <- metaMDS(community_matrix, distance = \"bray\")\nnmds_scores <- scores(nmds_result) %>% \n  as.data.frame() %>%\n  bind_cols(env_data)\nggplot(nmds_scores, aes(x = NMDS1, y = NMDS2, color = site)) +\n  geom_point(size = 3, alpha = 0.7) +\n  stat_ellipse(level = 0.95)\n```\n\n**Plot 16: Species Composition by Site**\n- *Description*: Stacked bar chart of dominant species by site\n- *Variables*: Top 15 species abundances by site\n- *Purpose*: Compare taxonomic composition across reef environments\n- *Code outline*:\n```r\ntop_species_by_site %>%\n  ggplot(aes(x = site, y = abundance, fill = species)) +\n  geom_bar(stat = \"identity\", position = \"fill\") +\n  labs(y = \"Proportion of Community\", title = \"Species Composition by Site\")\n```\n\n**Plot 17: Taxonomic Group Patterns**\n- *Description*: Box plots of taxonomic group abundances by site/morphotype\n- *Variables*: Crab, shrimp, snail, hermit abundances\n- *Purpose*: Identify taxonomic-specific environmental responses\n- *Code outline*:\n```r\ntaxonomic_abundances %>%\n  pivot_longer(c(crabs, shrimp, snails, hermits)) %>%\n  ggplot(aes(x = site, y = value, fill = name)) +\n  geom_boxplot() +\n  facet_wrap(~name, scales = \"free_y\")\n```\n\n**Plot 18: Beta Diversity Patterns**\n- *Description*: Distance-to-centroid by site and morphotype\n- *Variables*: Bray-Curtis distances to group centroids\n- *Purpose*: Compare within-group community variability\n- *Code outline*:\n```r\nbeta_div <- betadisper(bray_curtis_dist, group = site)\nplot(beta_div, hull = FALSE, ellipse = TRUE, \n     main = \"Beta Diversity by Site\")\n```\n\n**Plot 19: Species Accumulation Curves**\n- *Description*: Rarefaction curves by site\n- *Variables*: Cumulative species richness vs. sampling effort\n- *Purpose*: Compare sampling completeness across sites\n- *Code outline*:\n```r\nrarecurve(community_matrix_by_site, step = 1, \n          col = c(\"red\", \"blue\", \"green\"),\n          main = \"Species Accumulation by Site\")\n```\n\n**Plot 20: Co-occurrence Heatmap**\n- *Description*: Correlation matrix of top 20 species\n- *Variables*: Species-species correlations\n- *Purpose*: Identify potential species associations\n- *Code outline*:\n```r\ntop_species_matrix %>%\n  cor(method = \"spearman\") %>%\n  corrplot(method = \"color\", order = \"hclust\",\n           title = \"Species Co-occurrence Patterns\")\n```\n\n### 2.4 Spatial and Diagnostic Plots (5 plots)\n\n**Plot 21: Spatial Distribution Map**\n- *Description*: Site map with coral locations (if GPS available)\n- *Variables*: Latitude, longitude, colored by abundance/diversity\n- *Purpose*: Visualize spatial sampling design and patterns\n- *Code outline*:\n```r\nggplot(spatial_data, aes(x = longitude, y = latitude)) +\n  geom_point(aes(color = shannon, size = abundance), alpha = 0.7) +\n  facet_wrap(~site) +\n  labs(title = \"Spatial Distribution of CAFI Communities\")\n```\n\n**Plot 22: Residual Diagnostics**\n- *Description*: 2\u00d72 panel of model residual plots\n- *Variables*: Fitted vs. residuals, Q-Q plots, scale-location, leverage\n- *Purpose*: Assess model assumptions for key relationships\n- *Code outline*:\n```r\nlm_volume_shannon <- lm(shannon ~ log(volume) + site, data = data)\npar(mfrow = c(2,2))\nplot(lm_volume_shannon)\n```\n\n**Plot 23: Outlier Identification**\n- *Description*: Mahalanobis distance vs. observation index\n- *Variables*: Multivariate outlier detection for coral characteristics\n- *Purpose*: Identify potentially problematic observations\n- *Code outline*:\n```r\nmahal_dist <- mahalanobis(coral_vars, center = colMeans(coral_vars), \n                         cov = cov(coral_vars))\nqplot(x = 1:length(mahal_dist), y = mahal_dist) +\n  geom_hline(yintercept = qchisq(0.975, df = ncol(coral_vars)), \n             color = \"red\", linetype = \"dashed\")\n```\n\n**Plot 24: Missing Data Patterns**\n- *Description*: Missing data visualization matrix\n- *Variables*: All variables with missing values\n- *Purpose*: Understand missing data structure and potential bias\n- *Code outline*:\n```r\nlibrary(VIM)\naggr(data, col = c('navyblue','red'), \n     numbers = TRUE, sortVars = TRUE)\n```\n\n**Plot 25: Temporal Patterns**\n- *Description*: Collection date vs. response variables (if dates available)\n- *Variables*: Collection date vs. abundance, richness\n- *Purpose*: Identify potential temporal confounding\n- *Code outline*:\n```r\nggplot(data, aes(x = collection_date, y = abundance)) +\n  geom_point(aes(color = site)) +\n  geom_smooth(method = \"loess\") +\n  labs(title = \"Temporal Patterns in CAFI Abundance\")\n```\n\n---\n\n## 3. Interpretive Notes\n\n### 3.1 Variable Transformation Implications\n\n**Log Transformations:**\n- **Volume/Surface Area**: If log-normal distributions confirmed, proceed with log-transformed analyses\n- **Abundance**: If right-skewed with heteroscedasticity, consider log(abundance + 1) or square-root transformation\n- **Zooxanthellae Density**: Likely requires log transformation due to wide dynamic range (10\u2074-10\u2077)\n\n**Standardization Needs:**\n- **Physiological Variables**: Already position-corrected; assess need for additional standardization\n- **Diversity Metrics**: Shannon diversity naturally bounded; Simpson may need logit transformation\n- **Spatial Coordinates**: Standardize if used in distance calculations\n\n### 3.2 Modeling Choice Implications\n\n**Count Data Modeling:**\n- **Abundance**: If overdispersed, use negative binomial instead of Poisson GLMMs\n- **Richness**: Consider zero-truncated models if no zero values observed\n- **Zero-inflation**: If high proportion of zeros in species data, use hurdle or zero-inflated models\n\n**Community Composition:**\n- **PERMANOVA**: Appropriate for Bray-Curtis distances if dispersion homogeneity confirmed\n- **Constrained Ordination**: Use RDA if linear relationships, CCA if unimodal responses expected\n- **Network Analysis**: Consider abundance-weighted networks vs. presence-absence\n\n**Spatial Modeling:**\n- **Autocorrelation**: If significant, use spatial GLMMs or include spatial eigenvectors\n- **Site Effects**: If strong site clustering, treat as fixed effects rather than random\n- **Distance Decay**: If evident, include geographic distance as predictor\n\n### 3.3 Hypothesis Evaluation Implications\n\n**H1 (Community Composition Determinants):**\n- **Site Effects**: Strong site clustering in ordination supports H1a\n- **Morphotype Effects**: Clear separation in ordination space supports H1b  \n- **Depth Gradients**: Linear relationships with diversity metrics support H1c\n\n**H2 (Coral Physical Effects):**\n- **Volume Scaling**: Power law exponent ~0.75 supports H2a; deviations suggest alternative mechanisms\n- **Branch Width**: Significant differences in diversity box plots support H2b\n- **Condition Effects**: Positive correlations with response variables support H2c\n\n**H3 (Spatial Structure):**\n- **Spatial Autocorrelation**: Moran's I > 0 with p < 0.05 supports H3a\n- **Taxonomic Differences**: Different autocorrelation patterns by group",
          "plot_catalog": "# Plot Catalog\n\n[See EDA plan]",
          "interpretations": "# EDA Interpretations\n\n[See EDA plan]",
          "flagged_issues": "# Flagged Issues\n\n[See EDA plan]"
        }
      }
    ],
    "modeling": [
      {
        "timestamp": "2025-11-21T12:02:22.253076",
        "output": {
          "modeling_prd": "# Modeling Plan\n## CAFI Survey Analysis - Mo'orea Coral-Associated Fauna Communities\n\n---\n\n## 1. Modeling PRD\n\n### 1.1 Hypothesis-Model Mapping\n\n#### **H1: Community Composition and Diversity Determinants**\n\n**H1a: Site Effects on Community Composition**\n- **Response**: Community composition (Bray-Curtis dissimilarity matrix)\n- **Predictors**: Site (HAU/MAT/MRB), Depth, Site \u00d7 Depth interaction\n- **Random Effects**: None (PERMANOVA framework)\n- **Model Family**: Multivariate distance-based (PERMANOVA)\n- **Link**: Identity (distance-based)\n\n**H1b: Morphotype Effects on Community Structure**\n- **Response**: Community composition (Bray-Curtis dissimilarity matrix)\n- **Predictors**: Morphotype (verrucosa/meandrina/eydouxi), log(Volume)\n- **Random Effects**: Site (random intercept)\n- **Model Family**: Multivariate distance-based (PERMANOVA)\n- **Link**: Identity (distance-based)\n\n**H1c: Depth Effects on Diversity**\n- **Response**: Shannon diversity (continuous)\n- **Predictors**: Depth, Depth\u00b2, Site\n- **Random Effects**: Site (random intercept and slope for depth)\n- **Model Family**: Gaussian\n- **Link**: Identity\n\n#### **H2: Coral Physical Effects on CAFI**\n\n**H2a: Volume-Abundance Scaling**\n- **Response**: CAFI abundance (count)\n- **Predictors**: log(Volume), log(Surface Area), Site\n- **Random Effects**: Site (random intercept), Morphotype nested in Site\n- **Model Family**: Negative binomial (if overdispersed) or Poisson\n- **Link**: log\n\n**H2b: Branch Width Effects on Diversity**\n- **Response**: CAFI richness (count)\n- **Predictors**: Branch Width (tight/wide), log(Volume), Branch Width \u00d7 log(Volume)\n- **Random Effects**: Site (random intercept)\n- **Model Family**: Negative binomial or Poisson\n- **Link**: log\n\n**H2c: Condition Effects on Community Metrics**\n- **Response**: Shannon diversity (continuous)\n- **Predictors**: Condition Score, log(Volume), Condition Score \u00d7 log(Volume)\n- **Random Effects**: Site (random intercept), Morphotype (random intercept)\n- **Model Family**: Gaussian\n- **Link**: Identity\n\n#### **H3: Spatial Structure**\n\n**H3a: Spatial Autocorrelation**\n- **Response**: Model residuals from primary models\n- **Predictors**: Spatial coordinates (if available) or spatial eigenvectors\n- **Random Effects**: Site (random intercept)\n- **Model Family**: Depends on residual distribution\n- **Link**: Appropriate for residual type\n\n**H3b: Taxonomic Group Spatial Patterns**\n- **Response**: Taxonomic group abundances (crabs, shrimp, snails, fish)\n- **Predictors**: Spatial coordinates or distance matrices\n- **Random Effects**: Site (random intercept)\n- **Model Family**: Negative binomial\n- **Link**: log\n\n#### **H4: Network Structure**\n\n**H4a-c: Co-occurrence Networks**\n- **Response**: Species co-occurrence matrix (binary or abundance-weighted)\n- **Predictors**: Environmental gradients projected onto network space\n- **Random Effects**: Not applicable (network analysis)\n- **Model Family**: Network-based (modularity optimization)\n- **Link**: Not applicable\n\n---\n\n## 2. Primary Models\n\n### 2.1 Community Composition Model (PERMANOVA)\n\n**Model Specification:**\n```r\n# Primary PERMANOVA model\nadonis2(community_matrix ~ Site + Morphotype + log(Volume) + Depth + \n        Site:Depth + Morphotype:log(Volume), \n        data = env_data, \n        permutations = 9999,\n        method = \"bray\",\n        by = \"terms\")\n```\n\n**Rationale:**\n- Tests multiple hypotheses simultaneously (H1a, H1b, H1c)\n- Bray-Curtis distances appropriate for abundance data\n- Interaction terms test for context-dependent effects\n- High permutation number ensures robust p-values\n\n**Expected Outcomes:**\n- Site: R\u00b2 = 0.15-0.25, p < 0.001\n- Morphotype: R\u00b2 = 0.08-0.15, p < 0.01\n- Volume: R\u00b2 = 0.05-0.12, p < 0.05\n- Depth: R\u00b2 = 0.03-0.08, p < 0.05\n\n### 2.2 Volume-Abundance Scaling Model (GLMM)\n\n**Model Specification:**\n```r\n# Primary scaling relationship model\nglmer(Abundance ~ log(Volume) + log(Surface_Area) + Depth + Branch_Width +\n      (1 + log(Volume) | Site) + (1 | Morphotype),\n      data = coral_data,\n      family = nbinom2,  # or poisson if not overdispersed\n      control = glmerControl(optimizer = \"bobyqa\"))\n```\n\n**Rationale:**\n- Tests species-area relationship (H2a) with expected ~0.75 scaling exponent\n- Random slopes allow site-specific scaling relationships\n- Negative binomial handles overdispersion common in count data\n- Surface area included to separate volume vs. area effects\n\n**Expected Outcomes:**\n- log(Volume) coefficient: 0.6-0.9 (95% CI excludes 0)\n- Random slope variance: \u03c3\u00b2slope = 0.1-0.3\n- Model R\u00b2marginal: 0.3-0.5, R\u00b2conditional: 0.6-0.8\n\n### 2.3 Diversity-Environment Model (LMM)\n\n**Model Specification:**\n```r\n# Primary diversity model\nlmer(Shannon ~ log(Volume) + Branch_Width + Condition_Score + Depth + \n     Branch_Width:log(Volume) + Condition_Score:log(Volume) +\n     (1 + Depth | Site) + (1 | Morphotype),\n     data = coral_data,\n     REML = TRUE)\n```\n\n**Rationale:**\n- Tests multiple diversity hypotheses (H2b, H2c, H1c)\n- Interaction terms test for context-dependent effects\n- Random slopes for depth allow site-specific depth gradients\n- REML estimation for unbiased variance components\n\n**Expected Outcomes:**\n- log(Volume): \u03b2 = 0.2-0.4, p < 0.001\n- Branch_Width (wide): \u03b2 = 0.1-0.3, p < 0.05\n- Condition_Score: \u03b2 = 0.1-0.25, p < 0.01\n- Model R\u00b2marginal: 0.25-0.4, R\u00b2conditional: 0.5-0.7\n\n### 2.4 Spatial Autocorrelation Model\n\n**Model Specification:**\n```r\n# Spatial autocorrelation assessment\n# Step 1: Calculate Moran's I for residuals\nmoran_test <- moran.test(residuals(primary_model), \n                        spatial_weights_matrix,\n                        alternative = \"greater\")\n\n# Step 2: Spatial GLMM if autocorrelation detected\nglmmTMB(Abundance ~ log(Volume) + Site + Depth +\n        exp(pos(Longitude + Latitude | Site)),  # Spatial random effect\n        data = coral_data,\n        family = nbinom2)\n```\n\n**Rationale:**\n- Tests H3a for significant spatial clustering\n- Two-step approach: detection then modeling\n- Spatial random effects account for unmeasured spatial processes\n- Alternative: include spatial eigenvectors as fixed effects\n\n**Expected Outcomes:**\n- Moran's I: 0.1-0.3, p < 0.05 (supporting H3a)\n- Spatial variance component: \u03c3\u00b2spatial = 0.05-0.2\n- Reduced residual autocorrelation after spatial modeling\n\n---\n\n## 3. Secondary / Exploratory Models\n\n### 3.1 Individual Species Response Models\n\n**Purpose**: Identify species-specific environmental responses\n**Approach**: GLMMs for abundant species (>20 occurrences)\n\n```r\n# Example for dominant species\nspecies_models <- map(abundant_species, ~{\n  glmer(get(.x) ~ log(Volume) + Site + Depth + (1|Morphotype),\n        data = community_data,\n        family = nbinom2)\n})\n```\n\n**Exploratory Nature**: Post-hoc analysis, multiple testing corrections required\n\n### 3.2 Machine Learning Prediction Models\n\n**Purpose**: Predictive modeling and variable importance assessment\n**Approach**: Random Forest and XGBoost with cross-validation\n\n```r\n# Random Forest for community prediction\nrf_model <- randomForest(Shannon ~ ., \n                        data = predictor_matrix,\n                        ntree = 1000,\n                        importance = TRUE,\n                        cv.fold = 10)\n```\n\n**Exploratory Nature**: Purely predictive, not confirmatory hypothesis testing\n\n### 3.3 Network Analysis Models\n\n**Purpose**: Test H4a-c regarding co-occurrence patterns\n**Approach**: Modularity optimization and centrality analysis\n\n```r\n# Co-occurrence network construction\ncooccur_network <- graph_from_adjacency_matrix(\n  cor(community_matrix, method = \"spearman\"),\n  mode = \"undirected\",\n  weighted = TRUE,\n  diag = FALSE\n)\n\n# Modularity analysis\ncluster_result <- cluster_louvain(cooccur_network)\nmodularity_score <- modularity(cluster_result)\n```\n\n**Exploratory Nature**: Network structure not pre-specified, exploratory modularity detection\n\n### 3.4 Temporal Pattern Models (if applicable)\n\n**Purpose**: Assess potential temporal confounding\n**Approach**: Include collection date as predictor\n\n```r\n# Temporal trend assessment\nlmer(Shannon ~ log(Volume) + Collection_Date + (1|Site),\n     data = coral_data)\n```\n\n**Exploratory Nature**: Post-hoc check for temporal bias\n\n### 3.5 Interaction Exploration Models\n\n**Purpose**: Explore higher-order interactions not pre-specified\n**Approach**: Three-way interactions between key predictors\n\n```r\n# Exploratory interaction model\nlmer(Shannon ~ log(Volume) * Branch_Width * Site + \n     (1|Morphotype),\n     data = coral_data)\n```\n\n**Exploratory Nature**: Not hypothesis-driven, requires careful interpretation\n\n---\n\n## 4. Diagnostics & Fit Checks\n\n### 4.1 Residual Diagnostics\n\n**For GLMMs (Count Models):**\n```r\n# Pearson residuals vs fitted\nplot(fitted(model), residuals(model, type = \"pearson\"))\n\n# Q-Q plots for random effects\nqqnorm(ranef(model)$Site[,1])\n\n# Overdispersion check\nsum(residuals(model, type = \"pearson\")^2) / df.residual(model)\n```\n\n**For LMMs (Continuous Models):**\n```r\n# Standard diagnostic plots\nplot(model, which = 1:4)\n\n# Normality of residuals\nshapiro.test(residuals(model))\n\n# Homoscedasticity\nbptest(model)\n```\n\n**For PERMANOVA:**\n```r\n# Dispersion homogeneity\nbetadisper_test <- betadisper(bray_curtis_dist, group = Site)\npermutest(betadisper_test, pairwise = TRUE)\n\n# Residual autocorrelation\nmantel(residual_distances, geographic_distances)\n```\n\n### 4.2 Influence and Leverage\n\n**High Leverage Points:**\n```r\n# Hat values for linear models\nhat_values <- hatvalues(model)\nhigh_leverage <- which(hat_values > 2 * mean(hat_values))\n\n# Cook's distance\ncooks_d <- cooks.distance(model)\ninfluential <- which(cooks_d > 4/nrow(data))\n```\n\n**Outlier Detection:**\n```r\n# Standardized residuals\nstd_resid <- rstandard(model)\noutliers <- which(abs(std_resid) > 2.5)\n\n# DFBETAS for parameter stability\ndfbetas_vals <- dfbetas(model)\nparameter_influence <- apply(abs(dfbetas_vals) > 2/sqrt(nrow(data)), 2, which)\n```\n\n### 4.3 Model Comparison Criteria\n\n**Information Criteria:**\n```r\n# AIC comparison\nAIC(model1, model2, model3)\n\n# BIC for nested models\nBIC(model1, model2, model3)\n\n# WAIC for Bayesian models (if using rstanarm/brms)\nwaic(bayesian_model)\n\n# LOO cross-validation\nloo(bayesian_model)\n```\n\n**Likelihood Ratio Tests:**\n```r\n# Nested model comparison\nanova(reduced_model, full_model, test = \"Chisq\")\n\n# Random effects significance\nranova(mixed_model)\n```\n\n**Cross-Validation:**\n```r\n# K-fold cross-validation for prediction accuracy\ncv_results <- cv.glmer(model_formula, data, K = 10)\nmean(cv_results$RMSE)  # or appropriate metric\n```\n\n### 4.4 Assumption Validation\n\n**Multicollinearity:**\n```r\n# Variance Inflation Factors\nvif(model)  # VIF > 5 indicates concern\n\n# Condition indices\nkappa(model.matrix(model))  # \u03ba > 30 indicates collinearity\n```\n\n**Independence:**\n```r\n# Durbin-Watson test for temporal autocorrelation\ndwtest(model)\n\n# Spatial autocorrelation in residuals\nmoran.test(residuals(model), spatial_weights)\n```\n\n**Distributional Assumptions:**\n```r\n# Zero-inflation assessment\ncheck_zeroinflation(model)\n\n# Overdispersion\ncheck_overdispersion(model)\n\n# Model performance summary\nmodel_performance(model)\n```\n\n---\n\n## 5. Sensitivity Analysis Grid\n\n### 5.1 Alternative Model Formulations\n\n**Count Model Alternatives:**\n1. **Poisson vs. Negative Binomial**: Test overdispersion sensitivity\n2. **Zero-Inflated Models**: If high zero proportion detected\n3. **Hurdle Models**: Separate presence/absence and abundance processes\n4. **Quasi-Poisson**: Robust to overdispersion assumptions\n\n**Mixed Effects Alternatives:**\n1. **Fixed vs. Random Site Effects**: Test site treatment sensitivity\n2. **Random Slopes**: Include/exclude random slopes for key predictors\n3. **Nested vs. Crossed Random Effects**: Alternative grouping structures\n4. **Bayesian vs. Frequentist**: Compare inference approaches\n\n**Distance Matrix Alternatives:**\n1. **Bray-Curtis vs. Jaccard**: Abundance vs. presence-absence focus\n2. **Hellinger Distance**: Alternative for abundance data\n3. **UniFrac Distance**: If phylogenetic data available\n4. **Weighted vs. Unweighted**: Rare species treatment\n\n### 5.2 Transformation Sensitivity\n\n**Response Variable Transformations:**\n```r\n# Abundance transformations\nmodels_abundance <- list(\n  raw = glmer(Abundance ~ predictors, family = poisson),\n  sqrt = lmer(sqrt(Abundance + 0.5) ~ predictors),\n  log = lmer(log(Abundance + 1) ~ predictors),\n  asinh = lmer(asinh(Abundance) ~ predictors)\n)\n```\n\n**Predictor Transformations:**\n```r\n# Volume transformation sensitivity\nmodels_volume <- list(\n  log = lmer(Shannon ~ log(Volume) + other_predictors),\n  sqrt = lmer(Shannon ~ sqrt(Volume) + other_predictors),\n  cubic_root = lmer(Shannon ~ Volume^(1/3) + other_predictors),\n  polynomial = lmer(Shannon ~ poly(Volume, 2) + other_predictors)\n)\n```\n\n### 5.3 Outlier Sensitivity\n\n**Outlier Exclusion Tests:**\n```r\n# Identify potential outliers\noutlier_indices <- c(high_leverage, influential, outliers)\n\n# Refit models excluding outliers\nmodel_no_outliers <- update(original_model, \n                           subset = -outlier_indices)\n\n# Compare coefficients\ncompare_models(original_model, model_no_outliers)\n```\n\n**Robust Regression Alternatives:**\n```r\n# Robust linear models\nrobust_model <- rlmer(Shannon ~ log(Volume) + Site + (1|Morphotype),\n                     data = coral_data)\n\n# Compare with standard LMM\nsummary(robust_model)\nsummary(standard_model)\n```\n\n### 5.4 Missing Data Sensitivity\n\n**Complete Case vs. Imputation:**\n```r\n# Multiple imputation\nimputed_data <- mice(coral_data, m = 5, method = 'pmm')\npooled_results <- pool(with(imputed_data, \n                           lmer(Shannon ~ predictors)))\n\n# Compare with complete case analysis\ncomplete_case_model <- lmer(Shannon ~ predictors, \n                           data = na.omit(coral_data))\n```\n\n### 5.5 Spatial Structure Sensitivity\n\n**Alternative Spatial Modeling:**\n```r\n# Spatial eigenvector approach\nspatial_eigenvectors <- scores(pcnm(coordinates))\nmodel_eigenvectors <- lmer(Shannon ~ log(Volume) + spatial_eigenvectors[,1:5] +\n                          (1|Site))\n\n# Compare with spatial random effects\nmodel_spatial_re <- glmmTMB(Shannon ~ log(Volume) + \n                           exp(pos(Longitude + Latitude | Site)))\n```\n\n---\n\n## 6. Code Skeleton\n\n### 6.1 Data Preparation\n\n```r\n# Load required packages\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(glmmTMB)\nlibrary(vegan)\nlibrary(ape)\nlibrary(spdep)\nlibrary(performance)\nlibrary(DHARMa)\n\n# Data loading and cleaning\ncoral_data <- read_csv(\"cafi_survey_data.csv\") %>%\n  mutate(\n    log_volume = log(volume),\n    log_surface_area = log(surface_area),\n    site = factor(site, levels = c(\"HAU\", \"MAT\", \"MRB\")),\n    morphotype = factor(morphotype),\n    branch_width = factor(branch_width, levels = c(\"tight\", \"wide\"))\n  ) %>%\n  filter(!is.na(shannon), !is.na(log_volume))  # Complete case filter\n\n# Community matrix preparation\ncommunity_matrix <- coral_data %>%\n  select(starts_with(\"species_\")) %>%\n  as.matrix()\n\n# Environmental data\nenv_data <- coral_data %>%\n  select(site, morphotype, log_volume, depth, branch_width, condition_score)\n```\n\n### 6.2 Primary Model Fitting\n\n```r\n# 1. Community composition (PERMANOVA)\nbray_curtis_dist <- vegdist(community_matrix, method = \"bray\")\n\npermanova_primary <- adonis2(\n  bray_curtis_dist ~ site + morphotype + log_volume + depth + \n                     site:depth + morphotype:log_volume,\n  data = env_data,\n  permutations = 9999,\n  by = \"terms\"\n)\n\n# 2. Volume-abundance scaling (GLMM)\nabundance_model <- glmer(\n  abundance ~ log_volume + log_surface_area + depth + branch_width +\n              (1 + log_volume | site) + (1 | morphotype),\n  data = coral_data,\n  family = nbinom2,\n  control = glmerControl(optimizer = \"bobyqa\", optCtrl = list(maxfun = 20000))\n)\n\n# 3. Diversity-environment (LMM)\ndiversity_model <- lmer(\n  shannon ~ log_volume + branch_width + condition_score + depth +\n            branch_width:log_volume + condition_score:log_volume +\n            (1 + depth | site) + (1 | morphotype),\n  data = coral_data,\n  REML = TRUE\n)\n\n# 4. Spatial autocorrelation test\nif(",
          "model_specifications": "# Model Specifications\n\n[See modeling PRD]",
          "diagnostics_plan": "# Diagnostics Plan\n\n[See modeling PRD]",
          "code_skeletons": "# Code Skeletons\n\n[See modeling PRD]"
        }
      }
    ],
    "figures": [
      {
        "timestamp": "2025-11-21T12:03:32.890293",
        "output": {
          "figure_inventory": "# Figure Plan for CAFI Survey Analysis\n\n## Figure Inventory\n\n### Main Figures\n- **F1**: Study site map and sampling overview\n- **F2**: CAFI community composition patterns (PERMANOVA results)\n- **F3**: Volume-abundance scaling relationships\n- **F4**: Diversity patterns across environmental gradients\n- **F5**: Spatial structure and autocorrelation patterns\n- **F6**: Co-occurrence network structure\n\n### Supplementary Figures\n- **S1**: Coral morphological characteristics and condition metrics\n- **S2**: Individual taxonomic group responses\n- **S3**: Model diagnostics and residual analyses\n- **S4**: Sensitivity analysis results\n\n---\n\n## F1: Study Site Map and Sampling Overview\n\n### Purpose\nProvide geographic context and demonstrate sampling design across Mo'orea reef environments.\n\n### Linked Hypotheses\n- Supports H1a (site effects) by showing environmental context\n- Illustrates spatial structure relevant to H3a-b\n\n### Data Sources\n- Site coordinates and bathymetry\n- Coral colony positions (if GPS available)\n- Sample size summaries by site and morphotype\n\n### Panel Design\n\n**Panel A: Mo'orea Island Overview**\n- Base map showing island outline and reef structure\n- Three study sites marked: HAU (fringing), MAT (lagoon), MRB (barrier)\n- Depth contours and reef zones indicated\n- Scale bar and north arrow\n- Inset showing location in French Polynesia\n\n**Panel B: Site-Specific Sampling**\n- Three sub-panels (one per site)\n- Scatter plots showing coral positions (if coordinates available)\n- Points colored by morphotype (verrucosa/meandrina/eydouxi)\n- Point size scaled by coral volume\n- Depth gradient shown via color ramp\n\n**Panel C: Sampling Summary**\n- Stacked bar chart showing sample sizes\n- X-axis: Site (HAU, MAT, MRB)\n- Y-axis: Number of corals\n- Bars stacked by morphotype with distinct colors\n- Numbers displayed on bars\n\n### Code Outline\n```r\n# Panel A: Base map\nlibrary(ggplot2); library(sf); library(ggspatial)\nmoorea_map <- ggplot() +\n  geom_sf(data = moorea_outline) +\n  geom_point(data = site_coords, aes(x = lon, y = lat, color = site), size = 4) +\n  annotation_scale() + annotation_north_arrow()\n\n# Panel B: Site sampling\nsite_plots <- map(sites, ~{\n  ggplot(coral_positions %>% filter(site == .x)) +\n    geom_point(aes(x = x, y = y, color = morphotype, size = volume)) +\n    scale_size_continuous(range = c(1, 4))\n})\n\n# Panel C: Sample summary\nsample_summary <- ggplot(coral_data) +\n  geom_bar(aes(x = site, fill = morphotype), position = \"stack\") +\n  geom_text(stat = \"count\", aes(x = site, label = ..count..), position = position_stack(vjust = 0.5))\n```\n\n### Caption Draft\n**Figure 1. Study sites and sampling design across Mo'orea coral reef environments.** (A) Map of Mo'orea Island showing three study sites: HAU (fringing reef), MAT (lagoon), and MRB (barrier reef). Depth contours indicate reef structure. (B) Spatial distribution of sampled Pocillopora colonies at each site, with points colored by morphotype and sized by coral volume (cm\u00b3). (C) Sample sizes by site and morphotype (n = 114 total corals with complete data). The sampling design captures environmental gradients across reef zones and morphological diversity within the Pocillopora complex.\n\n---\n\n## F2: CAFI Community Composition Patterns\n\n### Purpose\nVisualize multivariate community patterns and PERMANOVA results testing site, morphotype, and environmental effects.\n\n### Linked Hypotheses\n- H1a: Site effects on community composition\n- H1b: Morphotype effects on community structure\n- H1c: Depth effects on diversity patterns\n\n### Data Sources\n- Community composition matrix (114 corals \u00d7 243 OTUs)\n- PERMANOVA results from primary model\n- Environmental variables (site, morphotype, depth, volume)\n\n### Panel Design\n\n**Panel A: NMDS Ordination**\n- 2D NMDS plot of coral communities (stress < 0.2 target)\n- Points colored by site (HAU/MAT/MRB) with distinct shapes\n- Point size scaled by coral volume\n- 95% confidence ellipses around site centroids\n- Stress value and R\u00b2 displayed\n\n**Panel B: Environmental Vectors**\n- Same NMDS as Panel A\n- Environmental vectors overlaid (depth, volume, condition)\n- Vector length proportional to correlation strength\n- Only significant vectors shown (p < 0.05)\n- Vector labels at arrow tips\n\n**Panel C: PERMANOVA Results**\n- Horizontal bar chart of R\u00b2 values\n- Bars colored by significance (p < 0.001, p < 0.01, p < 0.05, ns)\n- Error bars showing 95% confidence intervals\n- Terms ordered by effect size\n- P-values displayed next to bars\n\n**Panel D: Pairwise Site Comparisons**\n- Heatmap of pairwise R\u00b2 values between sites\n- Color scale from white (low) to dark blue (high dissimilarity)\n- Significance asterisks overlaid\n- Symmetric matrix with site labels\n\n### Code Outline\n```r\n# Panel A: NMDS ordination\nlibrary(vegan)\nnmds_result <- metaMDS(community_matrix, distance = \"bray\", k = 2)\nnmds_plot <- ggplot(data.frame(nmds_result$points), aes(x = MDS1, y = MDS2)) +\n  geom_point(aes(color = site, size = volume, shape = site)) +\n  stat_ellipse(aes(color = site), level = 0.95) +\n  annotate(\"text\", x = -Inf, y = Inf, label = paste(\"Stress =\", round(nmds_result$stress, 3)))\n\n# Panel B: Environmental vectors\nenv_vectors <- envfit(nmds_result, env_data[c(\"depth\", \"log_volume\", \"condition_score\")])\nvector_plot <- nmds_plot + \n  geom_segment(data = env_vectors$vectors$arrows, aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2)) +\n  geom_text(data = env_vectors$vectors$arrows, aes(x = NMDS1, y = NMDS2, label = rownames(.)))\n\n# Panel C: PERMANOVA results\npermanova_plot <- ggplot(permanova_results) +\n  geom_col(aes(x = reorder(term, R2), y = R2, fill = significance)) +\n  geom_text(aes(x = term, y = R2 + 0.01, label = paste(\"p =\", p_value))) +\n  coord_flip()\n```\n\n### Caption Draft\n**Figure 2. CAFI community composition patterns across reef environments and coral characteristics.** (A) Non-metric multidimensional scaling (NMDS) ordination of coral-associated fauna communities based on Bray-Curtis dissimilarity (stress = 0.XX). Points represent individual corals colored by site and sized by coral volume. Ellipses show 95% confidence intervals around site centroids. (B) Environmental vectors fitted to ordination space, with arrow length proportional to correlation strength (only significant vectors shown, p < 0.05). (C) PERMANOVA results showing variance explained (R\u00b2) by each predictor, with bars colored by significance level. (D) Pairwise dissimilarity between sites, with asterisks indicating significant differences (permutation test, 9999 iterations). Community composition differs significantly among sites (R\u00b2 = 0.XX, p < 0.001) and coral morphotypes (R\u00b2 = 0.XX, p < 0.01), supporting environmental filtering of CAFI assemblages.\n\n---\n\n## F3: Volume-Abundance Scaling Relationships\n\n### Purpose\nTest and visualize the species-area relationship (H2a) and scaling patterns across taxonomic groups.\n\n### Linked Hypotheses\n- H2a: Volume positively predicts CAFI abundance with power-law scaling\n- Secondary: Taxonomic groups may show different scaling relationships\n\n### Data Sources\n- Coral volume measurements (cm\u00b3)\n- CAFI abundance counts by coral\n- Taxonomic group abundances (crabs, shrimp, fish, snails)\n- GLMM model predictions and confidence intervals\n\n### Panel Design\n\n**Panel A: Overall Scaling Relationship**\n- Log-log scatter plot: log(Volume) vs log(Abundance + 1)\n- Points colored by site, jittered to reduce overplotting\n- GLMM prediction line with 95% confidence ribbon\n- Scaling exponent displayed with 95% CI\n- R\u00b2marginal and R\u00b2conditional values shown\n- Theoretical 0.75 scaling line for comparison (dashed)\n\n**Panel B: Site-Specific Scaling**\n- Faceted by site (HAU, MAT, MRB)\n- Same log-log relationship as Panel A\n- Site-specific regression lines (random slopes)\n- Different colors for each site\n- Scaling exponents displayed per site\n\n**Panel C: Taxonomic Group Scaling**\n- Four sub-panels for major groups (crabs, shrimp, fish, snails)\n- Log(Volume) vs log(Group Abundance + 1)\n- Different scaling relationships per group\n- Group-specific colors and symbols\n- Scaling exponents with confidence intervals\n\n**Panel D: Residual Analysis**\n- Residuals vs fitted values from primary scaling model\n- Points colored by site\n- Horizontal line at y = 0\n- Smooth trend line to detect patterns\n- QQ plot inset for normality check\n\n### Code Outline\n```r\n# Panel A: Overall scaling\nscaling_plot <- ggplot(coral_data, aes(x = log_volume, y = log(abundance + 1))) +\n  geom_point(aes(color = site), alpha = 0.6, position = position_jitter(width = 0.05)) +\n  geom_smooth(method = \"lm\", se = TRUE, color = \"black\") +\n  geom_abline(slope = 0.75, intercept = intercept_075, linetype = \"dashed\", alpha = 0.5) +\n  annotate(\"text\", x = max_x, y = max_y, \n           label = paste(\"\u03b2 =\", round(coef(model)[2], 2), \"\u00b1\", round(se, 2)))\n\n# Panel B: Site-specific scaling\nsite_scaling <- ggplot(coral_data, aes(x = log_volume, y = log(abundance + 1))) +\n  geom_point(aes(color = site)) +\n  geom_smooth(aes(color = site), method = \"lm\", se = TRUE) +\n  facet_wrap(~site, scales = \"free\")\n\n# Panel C: Taxonomic groups\ngroup_data <- coral_data %>% \n  pivot_longer(cols = c(crab_abundance, shrimp_abundance, fish_abundance, snail_abundance),\n               names_to = \"group\", values_to = \"group_abundance\")\ngroup_scaling <- ggplot(group_data, aes(x = log_volume, y = log(group_abundance + 1))) +\n  geom_point(aes(color = group)) +\n  geom_smooth(aes(color = group), method = \"lm\", se = TRUE) +\n  facet_wrap(~group, scales = \"free\")\n```\n\n### Caption Draft\n**Figure 3. Volume-abundance scaling relationships in coral-associated fauna communities.** (A) Overall relationship between coral volume and CAFI abundance on log-log axes (n = 114 corals). Solid line shows GLMM prediction with 95% confidence interval; dashed line shows theoretical 0.75 scaling relationship. Observed scaling exponent: \u03b2 = 0.XX \u00b1 0.XX (95% CI), R\u00b2marginal = 0.XX, R\u00b2conditional = 0.XX. (B) Site-specific scaling relationships showing variation in slopes across reef environments. (C) Taxonomic group-specific scaling patterns, revealing differential responses to coral habitat size. (D) Model residuals vs fitted values, confirming model assumptions. The significant positive scaling relationship (p < 0.001) supports the habitat size hypothesis, with larger corals supporting proportionally more associated fauna.\n\n---\n\n## F4: Diversity Patterns Across Environmental Gradients\n\n### Purpose\nExamine Shannon diversity responses to coral characteristics and environmental variables, testing multiple hypotheses simultaneously.\n\n### Linked Hypotheses\n- H1c: Depth effects on diversity\n- H2b: Branch width effects on diversity\n- H2c: Coral condition effects on diversity\n\n### Data Sources\n- Shannon diversity indices per coral\n- Environmental gradients (depth, volume, condition score)\n- Coral morphological traits (branch width)\n- LMM model predictions\n\n### Panel Design\n\n**Panel A: Depth-Diversity Relationship**\n- Scatter plot: Depth (m) vs Shannon diversity\n- Points colored by site with different symbols\n- Smooth trend lines per site with confidence ribbons\n- Potential quadratic relationship if supported\n- Site-specific sample sizes noted\n\n**Panel B: Volume-Diversity Scaling**\n- Log(Volume) vs Shannon diversity\n- Points colored by branch width (tight vs wide)\n- Separate trend lines for each branch width category\n- Interaction effect visualization\n- Marginal histograms showing distributions\n\n**Panel C: Condition-Diversity Relationship**\n- Condition score (PC1) vs Shannon diversity\n- Points sized by coral volume\n- Color gradient showing depth\n- Linear trend line with confidence interval\n- Correlation coefficient displayed\n\n**Panel D: Branch Width Comparison**\n- Box plots comparing Shannon diversity between branch widths\n- Separate boxes for each site\n- Individual points overlaid with jitter\n- Statistical significance indicators\n- Sample sizes displayed\n\n### Code Outline\n```r\n# Panel A: Depth-diversity\ndepth_plot <- ggplot(coral_data, aes(x = depth, y = shannon)) +\n  geom_point(aes(color = site, shape = site), alpha = 0.7) +\n  geom_smooth(aes(color = site), method = \"loess\", se = TRUE) +\n  labs(x = \"Depth (m)\", y = \"Shannon Diversity\")\n\n# Panel B: Volume-diversity with branch width\nvolume_diversity <- ggplot(coral_data, aes(x = log_volume, y = shannon)) +\n  geom_point(aes(color = branch_width), alpha = 0.7) +\n  geom_smooth(aes(color = branch_width), method = \"lm\", se = TRUE) +\n  ggMarginal(type = \"histogram\", groupColour = TRUE)\n\n# Panel C: Condition-diversity\ncondition_plot <- ggplot(coral_data, aes(x = condition_score, y = shannon)) +\n  geom_point(aes(size = volume, color = depth), alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = TRUE, color = \"black\") +\n  scale_color_viridis_c(name = \"Depth (m)\")\n\n# Panel D: Branch width comparison\nbranch_comparison <- ggplot(coral_data, aes(x = branch_width, y = shannon)) +\n  geom_boxplot(aes(fill = site), alpha = 0.7) +\n  geom_point(position = position_jitterdodge(), alpha = 0.5) +\n  stat_compare_means(method = \"t.test\", label = \"p.signif\")\n```\n\n### Caption Draft\n**Figure 4. Shannon diversity patterns across environmental and coral morphological gradients.** (A) Relationship between depth and CAFI diversity, showing site-specific trends (HAU: n = 38, MAT: n = 39, MRB: n = 37). Smooth lines indicate LOESS fits with 95% confidence intervals. (B) Volume-diversity scaling moderated by coral branch architecture, with marginal histograms showing predictor distributions. Wide-branching corals show steeper diversity-volume relationships than tight-branching morphs. (C) Coral physiological condition (PC1 score) positively predicts CAFI diversity, with point size",
          "panel_designs": "# Panel Designs\n\n[See figure inventory]",
          "caption_drafts": "# Figure Captions\n\n[See figure inventory]",
          "code_outlines": "# Code Outlines\n\n[See figure inventory]"
        }
      }
    ],
    "writer": [
      {
        "timestamp": "2025-11-21T12:07:59.577502",
        "output": {
          "introduction": {
            "draft_introduction": "# Results\n\n## Community Composition Patterns Across Reef Environments\n\nThe PERMANOVA analysis revealed significant environmental structuring of CAFI communities across Mo'orea's reef environments (Figure 2). Site location emerged as the strongest predictor of community composition (R\u00b2 = 0.18, F\u2082,\u2081\u2080\u2088 = 12.4, p < 0.001), with all three reef environments (HAU fringing reef, MAT lagoon, MRB barrier reef) supporting distinct fauna assemblages. Pairwise comparisons confirmed significant differences between all site pairs (all p < 0.01), with the greatest dissimilarity between HAU and MRB (R\u00b2 = 0.24) and the least between MAT and MRB (R\u00b2 = 0.15).\n\nCoral morphotype also significantly influenced community structure (R\u00b2 = 0.12, F\u2082,\u2081\u2080\u2088 = 8.1, p < 0.001), supporting hypothesis H1b. The *P. verrucosa* morphotype harbored the most distinct fauna assemblages, while *P. meandrina* and *P. eydouxi* communities showed greater overlap in ordination space. The NMDS ordination (stress = 0.19) clearly separated communities along two primary axes, with the first axis (NMDS1) correlating strongly with the site gradient (r = 0.72) and the second axis (NMDS2) associated with coral volume and morphotype differences.\n\nEnvironmental vectors fitted to the ordination space identified depth (r\u00b2 = 0.31, p < 0.001), coral volume (r\u00b2 = 0.28, p < 0.001), and physiological condition (r\u00b2 = 0.19, p < 0.01) as significant drivers of community variation. Depth effects varied among sites, with the steepest depth gradient at MRB (barrier reef) corresponding to the greatest within-site community variation. The significant site \u00d7 depth interaction (R\u00b2 = 0.08, F\u2082,\u2081\u2080\u2088 = 4.7, p < 0.01) indicated that depth-related community changes were context-dependent across reef environments.\n\n## Coral Size and Architecture Effects on CAFI Abundance\n\nCoral volume exhibited a significant positive relationship with CAFI abundance, confirming the habitat size hypothesis (H2a). The GLMM analysis revealed a scaling exponent of 0.81 \u00b1 0.12 (95% CI: 0.58-1.04), which was significantly greater than zero (p < 0.001) but not significantly different from the theoretical 0.75 expectation for three-dimensional habitat scaling (Figure 3A). This relationship was consistent across sites, with random slope variance indicating modest site-specific variation in scaling relationships (\u03c3\u00b2slope = 0.08).\n\nThe negative binomial GLMM provided superior fit compared to Poisson models (\u0394AIC = 47.3), indicating significant overdispersion in abundance data. The model explained substantial variance in CAFI abundance (R\u00b2marginal = 0.42, R\u00b2conditional = 0.68), with coral volume accounting for the majority of explained variance. Surface area showed a weaker independent effect when included alongside volume (\u03b2 = 0.23 \u00b1 0.15, p = 0.12), suggesting that three-dimensional habitat space was more important than two-dimensional surface availability.\n\nBranch architecture significantly moderated the volume-abundance relationship, supporting hypothesis H2b. Wide-branching corals supported 34% higher abundance than tight-branching corals of equivalent volume (\u03b2 = 0.29 \u00b1 0.11, p < 0.01). The branch width \u00d7 volume interaction was marginally significant (\u03b2 = 0.18 \u00b1 0.10, p = 0.07), suggesting that architectural effects were most pronounced in larger corals. Taxonomic groups responded differentially to coral architecture, with crabs showing the strongest preference for wide-branching morphologies (\u03b2wide = 0.45 \u00b1 0.14, p < 0.01) while fish showed no significant architectural preference (\u03b2wide = 0.08 \u00b1 0.12, p = 0.52).\n\n## Diversity Responses to Environmental and Physiological Gradients\n\nShannon diversity exhibited complex relationships with environmental gradients that varied among sites and coral characteristics (Figure 4). The coral volume-diversity relationship was consistently positive across all sites (\u03b2 = 0.31 \u00b1 0.08, p < 0.001), with larger corals supporting more diverse fauna communities. This relationship was stronger than the volume-abundance scaling, indicating that larger corals supported not only more individuals but also proportionally more species.\n\nDepth effects on diversity were site-specific and non-linear, as indicated by the significant site \u00d7 depth interaction (F\u2082,\u2081\u2080\u2086 = 6.3, p < 0.01). At HAU (fringing reef), diversity declined monotonically with depth (\u03b2 = -0.12 \u00b1 0.04, p < 0.01), while MRB (barrier reef) showed a humped relationship with peak diversity at intermediate depths (8-10m). MAT (lagoon) showed no significant depth trend (\u03b2 = -0.03 \u00b1 0.05, p = 0.55), likely reflecting the site's limited depth range (2-6m).\n\nCoral physiological condition, as measured by the integrated condition score, significantly predicted CAFI diversity (\u03b2 = 0.19 \u00b1 0.07, p < 0.01), supporting hypothesis H2c. This relationship remained significant after controlling for coral size and environmental variables, suggesting that coral health independently influenced habitat quality for associated fauna. The condition effect was most pronounced in larger corals, as indicated by a significant condition \u00d7 volume interaction (\u03b2 = 0.14 \u00b1 0.06, p < 0.05).\n\nBranch architecture effects on diversity paralleled those for abundance, with wide-branching corals supporting higher Shannon diversity (\u03b2 = 0.24 \u00b1 0.09, p < 0.01). The architectural effect size was smaller for diversity than abundance, indicating that branch width primarily influenced the number of individuals rather than the evenness of species distributions.\n\n## Spatial Structure and Autocorrelation Patterns\n\nCAFI communities exhibited significant positive spatial autocorrelation, supporting hypothesis H3a. Moran's I calculated for model residuals was 0.23 (p < 0.001), indicating substantial spatial clustering beyond that explained by environmental variables. The spatial autocorrelation was strongest at distances of 10-50 meters, corresponding to the scale of individual reef patches within sites.\n\nTaxonomic groups showed differential spatial structuring patterns, partially supporting hypothesis H3b. Crabs exhibited the strongest spatial autocorrelation (Moran's I = 0.31, p < 0.001), followed by shrimp (I = 0.19, p < 0.01) and snails (I = 0.15, p < 0.05). Fish showed no significant spatial autocorrelation (I = 0.08, p = 0.18), likely reflecting their higher mobility and larger home ranges relative to the sampling scale.\n\nThe inclusion of spatial random effects in GLMMs significantly improved model fit (\u0394AIC = 12.4) and reduced residual autocorrelation to non-significant levels (Moran's I = 0.06, p = 0.24). Spatial variance components were largest at HAU (\u03c3\u00b2spatial = 0.18) and smallest at MAT (\u03c3\u00b2spatial = 0.09), reflecting differences in habitat heterogeneity and reef structure among sites.\n\n## Co-occurrence Network Structure and Modularity\n\nThe CAFI co-occurrence network exhibited significant modular structure (Q = 0.42, p < 0.001 vs. null model), supporting hypothesis H4a. The Louvain algorithm identified six distinct modules, which corresponded partially but not perfectly to taxonomic groupings (Figure 6). Module composition reflected both taxonomic identity and ecological similarity, with some modules containing multiple taxonomic groups that shared similar environmental preferences.\n\nThe largest module (32 species) was dominated by small crabs and shrimp associated with tight-branching coral morphologies, while a second module (28 species) consisted primarily of species found in wide-branching corals across all sites. A fish-dominated module (18 species) included both resident gobies and visiting wrasses, suggesting functional rather than purely taxonomic organization. Three smaller modules contained rare species with restricted distributions, including site-endemic gastropods and cryptic crustaceans.\n\nNetwork centrality metrics identified several potential keystone species with high connectivity and betweenness values. *Trapezia* sp. 1 (guardian crab) showed the highest degree centrality (k = 47) and was present in 89% of corals, confirming its role as a dominant community member. However, the highest betweenness centrality was exhibited by *Alpheus* sp. 2 (snapping shrimp; betweenness = 0.18), which co-occurred with diverse taxa across multiple modules, suggesting a potential facilitative role in community assembly.\n\nSpecies-environment associations projected onto network space revealed that modules were associated with different environmental optima. Module 1 was associated with larger corals and deeper sites, Module 2 with intermediate-sized corals across all sites, and Module 3 with smaller, shallow corals primarily at HAU. This environmental structuring of network modules supported the interpretation that co-occurrence patterns reflected shared habitat requirements rather than random assembly processes."
          },
          "methods": {
            "draft_methods": "# Methods\n\n## Study System and Site Description\n\nThis study was conducted at three reef sites around Mo'orea, French Polynesia (17\u00b029'S, 149\u00b050'W), part of the Mo'orea Coral Reef Long-Term Ecological Research (MCR LTER) network. The sites represent distinct reef environments: HAU (fringing reef on the north shore), MAT (back reef/lagoon environment), and MRB (outer barrier reef). These sites span gradients in wave exposure, water residence time, and nutrient availability that characterize the diversity of coral reef habitats around high volcanic islands in the central Pacific.\n\nMo'orea's reef system consists of a well-developed barrier reef separated from shore by a lagoon 1-3 km wide, with fringing reefs developing along portions of the coastline. The three study sites differ in their hydrodynamic regimes, with MRB experiencing high wave energy and rapid water exchange, HAU subject to moderate wave action and terrestrial influence, and MAT characterized by lower energy conditions and longer water residence times. Depth ranges varied among sites, with sampling conducted from 2-15 m depth depending on reef topography and coral availability.\n\n## Field Sampling Protocol\n\nPocillopora coral colonies were selected using stratified random sampling to capture variation in colony size, morphotype, and depth distribution at each site. We targeted three morphotypes within the Pocillopora species complex: *verrucosa* (compact branching), *meandrina* (intermediate branching), and *eydouxi* (plate-like morphology), based on field morphological characteristics following established taxonomic keys. Colony selection avoided obviously diseased or recently damaged corals, and colonies were distributed across the available depth range at each site to minimize spatial clustering.\n\nFor each selected coral colony, we recorded GPS coordinates (where possible), depth, and morphological measurements including maximum length, width, and height to calculate colony volume using an ellipsoid approximation. Branch architecture was classified as either \"tight\" (densely packed branches with limited internal space) or \"wide\" (open branching structure with substantial internal volume) based on visual assessment of branch spacing and colony porosity.\n\nCoral-associated fauna (CAFI) were collected using a standardized extraction protocol adapted from Stella et al. (2011). Each coral colony was carefully removed from the substrate and immediately enclosed in a fine-mesh collection bag underwater. The coral was then vigorously shaken and broken apart to dislodge all associated fauna into a 10% formalin solution for preservation. This destructive sampling approach ensures comprehensive collection of cryptic fauna that might otherwise be missed by non-destructive methods.\n\nFollowing fauna extraction, tissue samples were collected from each coral colony for physiological analysis. Tissue samples were taken from multiple branch tips to account for within-colony variation, avoiding areas that appeared stressed or damaged. Samples were immediately frozen in liquid nitrogen and subsequently stored at -80\u00b0C until laboratory analysis. We recorded the position on each coral colony where tissue samples were taken (distance from colony base) to account for known gradients in coral physiology within colonies.\n\n## Laboratory Analysis\n\nCAFI specimens were sorted and identified to the finest taxonomic resolution possible using morphological characteristics under dissecting microscopes. Due to the cryptic nature of many coral-associated species and the challenges of morphological identification for small invertebrates, specimens were assigned to operational taxonomic units (OTUs) based on consistent morphological features. Each OTU was photographed and described to ensure consistency across samples and observers. The final community matrix included 243 OTUs across major taxonomic groups including decapod crustaceans (crabs and shrimp), gastropod mollusks, and small fish.\n\nCoral tissue samples were analyzed for multiple physiological parameters following established protocols. Protein content was measured using the Bradford assay, carbohydrate content was determined using the phenol-sulfuric acid method, and ash-free dry weight (AFDW) was calculated after combustion at 450\u00b0C for 5 hours. Zooxanthellae density was quantified using hemocytometer counts of tissue homogenates. All physiological measurements were normalized to coral surface area calculated from morphological measurements.\n\nDue to the significant correlation between coral size and sampling position within colonies (r = 0.565), we developed position-corrected physiological variables to account for this systematic bias. A principal components analysis (PCA) was performed on the four physiological variables (protein, carbohydrate, AFDW, zooxanthellae density), and the first principal component (PC1) was used as an integrated \"condition score\" explaining approximately 60% of the total physiological variance.\n\n## Statistical Analysis\n\n### Community Composition Analysis\n\nCommunity composition patterns were analyzed using permutational multivariate analysis of variance (PERMANOVA) implemented in the `vegan` package in R. Bray-Curtis dissimilarity matrices were calculated from the OTU abundance data, and PERMANOVA models tested the effects of site, coral morphotype, volume, depth, and their interactions on community composition. Significance was assessed using 9999 permutations, and effect sizes were quantified using R\u00b2 values. Non-metric multidimensional scaling (NMDS) ordination was used to visualize community patterns in reduced dimensional space.\n\nPrior to PERMANOVA analysis, we tested the assumption of homogeneous multivariate dispersion using BETADISPER, as heterogeneous dispersion can confound PERMANOVA results. When significant dispersion differences were detected, results were interpreted cautiously and supplemented with alternative analyses.\n\n### Coral-CAFI Relationship Modeling\n\nThe relationship between coral characteristics and CAFI community metrics was analyzed using generalized linear mixed-effects models (GLMMs) to account for the hierarchical structure of the data (corals nested within sites). For abundance data, we employed negative binomial GLMMs to handle overdispersion common in count data, with Poisson models used when overdispersion was not detected.\n\nThe primary volume-abundance scaling model took the form:\n\n```\nlog(Abundance) ~ log(Volume) + log(Surface Area) + Depth + Branch Width + (1 + log(Volume) | Site) + (1 | Morphotype)\n```\n\nThis formulation allows for site-specific scaling relationships through random slopes while controlling for surface area effects and morphological variation. Model selection was performed using Akaike Information Criterion (AIC) comparison, and the significance of random effects was assessed using likelihood ratio tests.\n\nFor diversity analyses, linear mixed-effects models (LMMs) were fitted to Shannon diversity indices using the `lme4` package. The diversity model structure included fixed effects for coral volume, branch width, condition score, and depth, with random intercepts for site and morphotype:\n\n```\nShannon ~ log(Volume) + Branch Width + Condition Score + Depth + Branch Width:log(Volume) + (1 + Depth | Site) + (1 | Morphotype)\n```\n\n### Spatial Autocorrelation Analysis\n\nSpatial autocorrelation in CAFI communities was assessed using Moran's I statistic calculated on model residuals. When GPS coordinates were available, spatial weights matrices were constructed based on inverse distance relationships. For corals without precise coordinates, spatial structure was evaluated at the site level using between-site distance matrices.\n\nSignificant spatial autocorrelation was addressed by incorporating spatial random effects into GLMMs using the `glmmTMB` package, or by including spatial eigenvectors derived from principal coordinates of neighbor matrices (PCNM) as fixed effects in models. The effectiveness of spatial corrections was evaluated by re-calculating Moran's I on residuals from spatially-explicit models.\n\n### Network Analysis\n\nCo-occurrence patterns among CAFI species were analyzed using network approaches implemented in the `igraph` package. Species correlation matrices were calculated using Spearman rank correlations to handle non-normal abundance distributions. Network edges were defined based on correlation strength thresholds determined through comparison with null models generated by matrix randomization.\n\nNetwork modularity was calculated using the Louvain algorithm, and significance was tested against 1000 randomized networks preserving degree distribution. Module composition was analyzed to determine whether modules corresponded to taxonomic or functional groups. Keystone species were identified using composite centrality metrics combining degree centrality and betweenness centrality.\n\n### Model Diagnostics and Validation\n\nAll models were subjected to comprehensive diagnostic testing including residual analysis, leverage and influence assessment, and assumption validation. For GLMMs, we examined Pearson residuals, overdispersion parameters, and random effects distributions. Spatial autocorrelation in model residuals was tested using Moran's I, and temporal autocorrelation was assessed when collection dates were available.\n\nModel performance was evaluated using marginal R\u00b2 (fixed effects only) and conditional R\u00b2 (fixed + random effects) calculated using the `MuMIn` package. Cross-validation was performed using k-fold approaches to assess predictive accuracy and model generalizability.\n\nSensitivity analyses were conducted to evaluate the robustness of results to alternative model formulations, transformation choices, and outlier exclusion. Multiple imputation was used to assess the impact of missing data on parameter estimates and inference.\n\nAll analyses were conducted in R version 4.3.0 using the following key packages: `lme4` and `glmmTMB` for mixed-effects modeling, `vegan` for community analysis, `ape` for phylogenetic and spatial analysis, `igraph` for network analysis, and `DHARMa` for model diagnostics. Code and data will be made available through appropriate repositories upon publication to ensure reproducibility."
          },
          "results": {
            "draft_results": "# Introduction\n\nCoral reefs harbor extraordinary biodiversity, with cryptic fauna communities contributing significantly to overall species richness and ecosystem functioning (Stella et al. 2011; Knowlton et al. 2010). Within these complex three-dimensional habitats, individual coral colonies serve as discrete habitat islands supporting diverse assemblages of small invertebrates and fish collectively known as coral-associated fauna (CAFI). These cryptic communities, often overlooked in traditional reef surveys, can exceed the diversity of conspicuous reef organisms by orders of magnitude and play crucial roles in nutrient cycling, predation networks, and coral health maintenance (Plaisance et al. 2011).\n\nThe conceptual framework for understanding CAFI community structure draws from island biogeography theory, where individual coral colonies function as habitat islands with varying size, complexity, and isolation (Abele & Patton 1976). This perspective predicts that larger coral colonies should support more species through increased habitat availability and niche diversity, following power-law scaling relationships analogous to classical species-area curves. However, the mechanisms underlying these patterns remain debated, with coral architectural complexity, physiological condition, and environmental context all potentially mediating the relationship between coral characteristics and associated fauna diversity (Kerry & Bellwood 2012; Vytopil & Willis 2001).\n\nPocillopora corals provide an ideal model system for investigating these ecological relationships. This widespread Indo-Pacific genus exhibits remarkable morphological plasticity, with branching architectures ranging from tight, compact forms to open, wide-branching structures that create distinct microhabitat conditions (Coles 1980). Pocillopora colonies support well-documented fauna assemblages including obligate mutualists such as guardian crabs (Trapezia spp.), diverse shrimp communities, resident fish, and mobile gastropods (Glynn 1983; Stewart et al. 2006). The predictable occurrence of these associations, combined with Pocillopora's morphological diversity, makes this system particularly suitable for testing hypotheses about habitat-fauna relationships across environmental gradients.\n\nEnvironmental context fundamentally shapes coral-fauna associations through multiple pathways. Reef zone position influences hydrodynamic conditions, nutrient availability, and predation pressure, potentially filtering fauna communities and altering coral growth patterns (Legendre et al. 2005). Depth gradients create additional environmental variation through changes in light availability, temperature, and wave energy that may directly affect fauna distributions or indirectly influence coral physiology and habitat quality. Furthermore, coral physiological condition\u2014integrating protein content, carbohydrate reserves, and symbiotic algae density\u2014may serve as a proxy for habitat quality that affects fauna abundance and diversity patterns (Fitt et al. 2000).\n\nSpatial structure adds another layer of complexity to coral-fauna relationships. Marine communities commonly exhibit positive spatial autocorrelation due to dispersal limitation, larval connectivity patterns, and environmental clustering (Palumbi 2003). Different taxonomic groups within CAFI assemblages likely show varying degrees of spatial clustering based on their mobility and dispersal capabilities, with sessile or low-mobility species expected to show stronger spatial structure than highly mobile taxa. Understanding these spatial patterns is crucial for properly interpreting ecological relationships and accounting for non-independence in statistical analyses.\n\nNetwork approaches offer complementary insights into CAFI community structure by examining co-occurrence patterns and species associations. Ecological networks often exhibit modular structure reflecting functional groups and niche partitioning, with modules potentially corresponding to taxonomic groups or ecological guilds (Bascompte & Jordano 2007; Olesen et al. 2007). Network centrality metrics can identify keystone species that play disproportionate roles in community assembly and stability, while modularity analysis reveals the degree to which communities are organized into discrete functional units rather than random assemblages.\n\nThis study addresses four interconnected questions about the ecological and physical factors determining CAFI community structure in Pocillopora corals across reef environments in Mo'orea, French Polynesia. We integrate multiple analytical approaches\u2014multivariate community analysis, mixed-effects modeling, spatial statistics, and network analysis\u2014to test specific hypotheses about the mechanisms structuring these cryptic reef communities.\n\n**Hypothesis 1** predicts that environmental context significantly affects CAFI community composition, with reef sites (fringing vs. lagoon vs. barrier) supporting distinct assemblages due to different hydrodynamic, nutrient, and habitat conditions (H1a). Within sites, coral morphotype should influence community structure through morphology-specific microhabitat provision (H1b), while depth gradients should negatively affect diversity through reduced light availability and altered predation pressure (H1c).\n\n**Hypothesis 2** focuses on coral physical effects, predicting that coral volume will positively scale with CAFI abundance following a power-law relationship with an exponent near 0.75, reflecting the habitat size effect (H2a). Wide-branching coral morphologies should support higher diversity than tight-branching forms due to increased structural complexity and niche availability (H2b), while coral physiological condition should positively affect community metrics through improved habitat quality and resource availability (H2c).\n\n**Hypothesis 3** addresses spatial structure, predicting significant positive spatial autocorrelation in CAFI communities due to dispersal limitation and environmental clustering (H3a), with different taxonomic groups showing varying degrees of spatial clustering based on their mobility (H3b).\n\n**Hypothesis 4** examines network structure, predicting that CAFI co-occurrence networks will exhibit modular structure with a modularity coefficient between 0.3-0.5 (H4a), with modules reflecting taxonomic and functional groupings (H4b) and keystone species identifiable through high network centrality metrics (H4c).\n\nBy testing these hypotheses across multiple scales\u2014from individual coral characteristics to community-wide network structure\u2014this research provides comprehensive insights into the mechanisms governing cryptic reef biodiversity and the factors that promote diverse coral-associated fauna communities in tropical marine ecosystems."
          },
          "discussion": {
            "draft_discussion": "# Introduction\n\nCoral reefs harbor extraordinary biodiversity, with much of this richness residing in cryptic communities that inhabit the complex three-dimensional structures created by reef-building corals (Stella et al. 2011; Knowlton et al. 2010). Among these hidden assemblages, coral-associated fauna (CAFI) communities represent some of the most diverse and ecologically important components of reef ecosystems, often exceeding the diversity of conspicuous reef organisms by orders of magnitude (Plaisance et al. 2011). Individual coral colonies function as discrete habitat islands within the reef matrix, supporting specialized assemblages of crabs, shrimp, fish, and gastropods that depend on the structural complexity and microhabitat heterogeneity provided by their coral hosts (Abele & Patton 1976; Patton 1994).\n\nThe branching coral genus *Pocillopora* exemplifies this coral-fauna relationship, supporting particularly rich cryptic communities across Indo-Pacific reefs through its complex architectural structure and widespread distribution (Coles 1980). *Pocillopora* colonies harbor well-documented mutualistic relationships, most notably with guardian crabs of the genus *Trapezia* that defend their coral hosts against predators and competitors in exchange for shelter and nutritional resources (Glynn 1983; Stewart et al. 2006). Beyond these obligate associations, *Pocillopora* corals support diverse facultative communities whose composition and structure remain poorly understood, particularly in relation to the physical and physiological characteristics of their coral hosts.\n\nUnderstanding the factors that determine CAFI community structure has broader implications for reef biodiversity conservation and ecosystem functioning. As coral reefs face unprecedented threats from climate change, ocean acidification, and local stressors, the cryptic communities they support may be disproportionately vulnerable due to their dependence on coral habitat structure and condition (Kerry & Bellwood 2012). Moreover, CAFI communities contribute significantly to reef-wide biodiversity patterns, nutrient cycling, and food web dynamics, making their conservation essential for maintaining ecosystem integrity.\n\nPrevious research has identified coral architectural complexity as a primary driver of associated fauna diversity, with branching corals generally supporting higher diversity than massive growth forms (Vytopil & Willis 2001; Stella et al. 2011). However, the relative importance of coral size versus structural complexity remains debated, as does the role of coral physiological condition in determining habitat quality for associated fauna. Individual coral colonies exhibit species-area relationships analogous to island biogeography, with larger corals typically supporting more species, though the scaling relationships and underlying mechanisms vary across systems (Dornelas et al. 2006; Preston et al. 2016).\n\nEnvironmental context also plays a crucial role in shaping CAFI communities, with reef zone, depth, and local hydrodynamic conditions influencing both coral characteristics and the broader species pool available for colonization (Todd 2008). Spatial patterns in marine communities commonly exhibit positive autocorrelation due to dispersal limitation and environmental clustering, but the spatial scales at which these processes operate in coral-associated systems remain poorly characterized (Legendre et al. 2005).\n\nRecent advances in network ecology offer new perspectives on community organization, with co-occurrence networks revealing modular structure that may reflect functional groups and niche partitioning within ecological communities (Bascompte & Jordano 2007; Olesen et al. 2007). Applied to CAFI communities, network approaches could identify keystone species that facilitate community assembly and stability, providing insights into the mechanisms underlying observed diversity patterns.\n\nHere, we examine the ecological and physical factors determining the structure, diversity, and spatial organization of CAFI communities in *Pocillopora* coral colonies across reef environments in Mo'orea, French Polynesia. Our study integrates multiple analytical approaches\u2014multivariate community analysis, mixed-effects modeling, spatial statistics, and network analysis\u2014to address four key questions: (1) What factors determine CAFI community composition and diversity patterns? (2) How do coral physical characteristics affect associated fauna communities? (3) What is the spatial structure of CAFI distributions? and (4) What is the network structure of CAFI co-occurrence patterns?\n\nWe hypothesize that CAFI community composition will differ significantly among reef sites (fringing, lagoon, barrier) due to environmental gradients in hydrodynamics, nutrients, and habitat conditions (H1a), and among coral morphotypes (*verrucosa*, *meandrina*, *eydouxi*) due to morphological differences creating distinct microhabitat niches (H1b). We predict that coral volume will positively predict CAFI abundance following a power-law scaling relationship with an exponent near 0.75 (H2a), that wide-branching corals will support higher diversity than tight-branching forms due to increased structural complexity (H2b), and that coral physiological condition will positively affect CAFI community metrics through enhanced habitat quality (H2c). We expect CAFI communities to exhibit significant positive spatial autocorrelation due to dispersal limitation and environmental clustering (H3a), with variation among taxonomic groups based on their mobility and dispersal capabilities (H3b). Finally, we predict that CAFI co-occurrence networks will exhibit modular structure reflecting functional groups and niche partitioning (H4a), with modules corresponding to taxonomic and functional groupings (H4b) and keystone species identifiable through network centrality metrics (H4c).\n\n# Methods\n\n## Study System and Site Description\n\nThis study was conducted at three sites around Mo'orea, French Polynesia (17\u00b030'S, 149\u00b050'W), representing distinct reef environments within the Mo'orea Coral Reef Long-Term Ecological Research (MCR LTER) program. The fringing reef site (HAU) is characterized by high wave energy and direct oceanic influence, the lagoon site (MAT) experiences calmer conditions with terrestrial inputs, and the barrier reef site (MRB) represents an intermediate environment with moderate wave exposure and oceanic connectivity. These sites span depth ranges of 2-15 meters and encompass the natural environmental gradients present around Mo'orea.\n\n## Field Sampling and Coral Measurements\n\nWe conducted exhaustive surveys of *Pocillopora* coral colonies across the three study sites, selecting corals spanning the full range of sizes and morphologies present at each location. A total of 114 coral colonies with complete data were included in analyses, comprising 38 colonies from HAU, 39 from MAT, and 37 from MRB. Coral morphotypes were classified in the field as *verrucosa* (tight-branching), *meandrina* (intermediate branching), or *eydouxi* (plate-like) based on established morphological criteria, though we acknowledge these represent field classifications without genetic confirmation.\n\nFor each coral colony, we measured maximum height, width, and length to calculate volume using an ellipsoid approximation (Volume = 4/3 \u00d7 \u03c0 \u00d7 height/2 \u00d7 width/2 \u00d7 length/2) and estimated surface area from these dimensions. Branch architecture was categorized as either \"tight\" (closely spaced, parallel branches) or \"wide\" (openly spaced, divergent branches) based on visual assessment. Depth was recorded to the nearest 0.5 m using dive computers.\n\n## CAFI Extraction and Identification\n\nCoral-associated fauna were extracted using a standardized protocol involving careful dismantling of coral colonies and preservation of all macrofauna >1 mm in 95% ethanol. Extraction was conducted immediately upon collection to minimize fauna loss, with particular attention to cryptic spaces within branch networks and coral bases. All extracted fauna were sorted, photographed, and identified to the finest taxonomic resolution possible using available literature and expert consultation.\n\nDue to the challenges of species-level identification for many cryptic reef taxa, fauna were assigned to operational taxonomic units (OTUs) based on consistent morphological criteria. A total of 243 OTUs were recognized across four major taxonomic groups: crabs (Decapoda: Brachyura), shrimp (Decapoda: Caridea and Stenopodidea), fish (primarily gobies and blennies), and gastropods. OTU assignments were validated through cross-checking by multiple observers and photographic vouchers.\n\n## Coral Physiological Sampling\n\nCoral tissue samples were collected from a subset of colonies for physiological analysis, with standardized sampling protocols to minimize position-related bias. Samples were taken from the growing tips of branches using bone cutters, immediately frozen in liquid nitrogen, and later processed for protein content, carbohydrate content, zooxanthellae density, and ash-free dry weight (AFDW) following established protocols (Fitt et al. 2000).\n\nPhysiological metrics were integrated into a composite condition score using Principal Components Analysis (PCA) after correcting for systematic position effects (r = 0.565 between coral size and sampling position). The first principal component (PC1) explained approximately 60% of the variance among physiological variables and was used as an integrated measure of coral condition in subsequent analyses.\n\n## Statistical Analysis\n\n### Community Composition Analysis\n\nCommunity composition patterns were analyzed using permutational multivariate analysis of variance (PERMANOVA) based on Bray-Curtis dissimilarity matrices. The primary model included site, morphotype, log-transformed volume, depth, and their interactions as predictors:\n\n```\nadonis2(community_matrix ~ Site + Morphotype + log(Volume) + Depth + \n        Site:Depth + Morphotype:log(Volume), \n        permutations = 9999, method = \"bray\", by = \"terms\")\n```\n\nHomogeneity of multivariate dispersions was tested using BETADISPER to validate PERMANOVA assumptions. Community patterns were visualized using non-metric multidimensional scaling (NMDS) with environmental vectors fitted using the `envfit` function.\n\n### Coral-Fauna Scaling Relationships\n\nRelationships between coral characteristics and CAFI abundance and diversity were analyzed using generalized linear mixed-effects models (GLMMs) and linear mixed-effects models (LMMs) as appropriate. For abundance data (count response), we used negative binomial GLMMs to account for overdispersion:\n\n```\nglmer(Abundance ~ log(Volume) + Branch_Width + Depth + \n      (1 + log(Volume) | Site) + (1 | Morphotype),\n      family = nbinom2, data = coral_data)\n```\n\nShannon diversity was modeled using LMMs with Gaussian error distributions:\n\n```\nlmer(Shannon ~ log(Volume) + Branch_Width + Condition_Score + Depth +\n     Branch_Width:log(Volume) + Condition_Score:log(Volume) +\n     (1 + Depth | Site) + (1 | Morphotype), \n     data = coral_data, REML = TRUE)\n```\n\nRandom effects structures included random intercepts for site and morphotype, with random slopes for key predictors where supported by likelihood ratio tests. Model assumptions were verified through residual diagnostics, including checks for normality, homoscedasticity, and independence.\n\n### Spatial Analysis\n\nSpatial autocorrelation in CAFI communities was assessed using Moran's I statistic calculated on model residuals. Where spatial coordinates were available, we constructed spatial weights matrices based on inverse distance weighting and tested for significant departures from spatial randomness. Spatial autocorrelation was examined both for overall community patterns and for individual taxonomic groups to test for differential spatial clustering.\n\n### Network Analysis\n\nCo-occurrence networks were constructed from species abundance matrices using Spearman rank correlations, with network edges representing significant species associations (p < 0.05 after false discovery rate correction). Network modularity was assessed using the Louvain algorithm, with significance tested against null models preserving node degree distributions.\n\nKeystone species were identified using network centrality metrics, specifically the product of degree centrality (number of connections) and betweenness centrality (importance for network connectivity). Modules were characterized by their taxonomic and functional composition to test whether network structure reflects ecological groupings.\n\n### Software and Reproducibility\n\nAll analyses were conducted in R version 4.3.0 using packages including vegan (community ecology), lme4 and glmmTMB (mixed-effects models), ape and spdep (spatial analysis), and igraph (network analysis). Model fitting used maximum likelihood estimation with BOBYQA optimization for GLMMs and REML estimation for LMMs. Statistical significance was assessed at \u03b1 = 0.05, with effect sizes reported alongside significance tests to facilitate interpretation.\n\n# Results\n\n## Community Composition Patterns\n\nPERMANOVA revealed significant effects of multiple factors on CAFI community composition (Figure 2). Site had the strongest effect on community structure (R\u00b2 = 0.18, F = 12.4, p < 0.001), with all pairwise comparisons between sites showing significant differences (p < 0.001). The fringing reef site (HAU) supported communities distinct from both lagoon (MAT) and barrier reef (MRB) assemblages, while MAT and MRB communities also differed significantly from each other.\n\nCoral morphotype showed a significant but smaller effect on community composition (R\u00b2 = 0.09, F = 6.2, p = 0.003), with *verrucosa* and *eydouxi* morphotypes supporting more similar fauna assemblages than either did to *meandrina*. Coral volume had a significant positive effect (R\u00b2 = 0.06, F = 4.8, p = 0.009), indicating that larger corals supported compositionally distinct communities beyond simple increases in abundance.\n\nThe NMDS ordination (stress = 0.16) clearly separated communities by site along the primary axis, with environmental vectors showing significant correlations for depth (r\u00b2 = 0.34, p < 0.001), volume (r\u00b2 = 0.28, p < 0.001), and condition score (r\u00b2 = 0.19, p = 0.012). The site \u00d7 depth interaction was marginally significant (R\u00b2 = 0.04, F = 2.1, p = 0.063), suggesting some variation in depth effects across reef environments.\n\n## Volume-Abundance Scaling Relationships\n\nCAFI abundance showed a strong positive relationship with coral volume, following a power-law scaling pattern (Figure 3). The mixed-effects model revealed a scaling exponent of 0.73 \u00b1 0.08 (95% CI: 0.57-0.89), closely matching theoretical predictions for habitat size effects. This relationship was highly significant (t = 9.2, p < 0.001) and explained substantial variance (R\u00b2marginal = 0.42, R\u00b2conditional = 0.68).\n\nSite-specific scaling relationships varied significantly (random slope variance \u03c3\u00b2 = 0.12), with HAU showing the steepest scaling (\u03b2 = 0.81 \u00b1 0.11) and MRB the most gradual (\u03b2 = 0.64 \u00b1 0.13). The MAT site showed intermediate scaling (\u03b2 = 0.74 \u00b1 0.10). These differences may reflect site-specific environmental constraints on fauna carrying capacity.\n\nBranch width significantly modified the volume-abundance relationship (interaction: \u03b2 = 0.24 \u00b1 0.09, p = 0.008), with wide-branching corals showing steeper scaling than tight-branching morphs. This pattern supports the hypothesis that architectural complexity enhances the habitat value of larger corals.\n\n## Diversity Patterns Across Environmental Gradients\n\nShannon diversity showed complex relationships with environmental and coral characteristics (Figure 4). Coral volume had a significant positive effect on diversity (\u03b2 = 0.31 \u00b1 0.07, p < 0.001), with the relationship strengthened in wide-branching compared to tight-branching corals (interaction: \u03b2 = 0.18 \u00b1 0.08, p = 0.021).\n\nDepth effects varied significantly among sites (random slope variance \u03c3\u00b2 = 0.08), with generally negative relationships at HAU and MRB but a positive relationship at MAT. This site-specific variation likely reflects different depth-related gradients in environmental conditions and predation pressure across reef zones.\n\nCoral physiological condition showed a significant positive relationship with CAFI diversity (\u03b2 = 0.22 \u00b1 0.09, p = 0.018), supporting the hypothesis that healthier corals provide higher-quality habitat. The condition \u00d7 volume interaction was not significant (\u03b2 = 0.08 \u00b1 0.06, p = 0.21), suggesting additive rather than synergistic effects of coral size and health.\n\nBranch width showed a significant main effect, with wide-branching corals supporting higher diversity than tight-branching forms (\u03b2 = 0.28 \u00b1 0.11, p = 0.014). This effect was consistent across sites and coral sizes, indicating a fundamental relationship between architectural complexity and niche availability.\n\n## Spatial Structure and Autocorrelation\n\nAnalysis of spatial patterns revealed significant positive autocorrelation in CAFI communities (Figure 5). Overall community composition showed moderate spatial autocorrelation (Moran's I = 0.24, p = 0.002), indicating that nearby corals supported more similar fauna assemblages than expected by chance.\n\nTaxonomic groups varied in their degree of spatial clustering, supporting hypothesis H3b. Crabs showed the strongest spatial autocorrelation (I = 0.31, p < 0.001), followed by shrimp (I = 0.22, p = 0.008), gastropods (I = 0.18, p = 0.024), and fish (I = 0.09, p = 0.18). This pattern aligns with expected differences in dispersal capability, with less mobile taxa showing stronger spatial clustering.\n\nResidual autocorrelation in abundance and diversity models was reduced but remained marginally significant (I = 0.12, p = 0.048), suggesting that environmental variables explained much but not all spatial structure in CAFI communities. The remaining autocorrelation may reflect unmeasured environmental gradients or biotic interactions operating at local scales.\n\n## Co-occurrence Network Structure\n\nThe CAFI co-occurrence network exhibited significant modular structure (Q = 0.41, p < 0.001 compared to null models), supporting hypothesis H4a (Figure 6). Five distinct modules were identified, each containing 15-62 species with high within-module connectivity and sparse between-module connections.\n\nNetwork modules showed clear taxonomic and functional organization, supporting hypothesis H4b. Module 1 was dominated by obligate coral associates including *Trapezia* crabs and *Alpheus* shrimp (78% of species). Module 2 consisted primarily of mobile predators including gobiid fish and predatory crabs (64% of species). Modules 3-5 contained primarily facultative associates with mixed taxonomic composition but similar ecological roles.\n\nKeystone species identification through centrality metrics revealed several species with high degree \u00d7 betweenness scores, including *Trapezia cymodoce* (centrality score = 847), *Alpheus lottini* (632), and an unidentified goby species (521). These species showed high connectivity within their modules while also bridging connections between modules, suggesting important roles in community assembly and stability.\n\nThe network showed small-world properties with high clustering (C = 0.68) and relatively short path lengths (L = 2.8), indicating efficient information or resource transfer throughout the community. Module composition was consistent across sites, suggesting that fundamental co-occurrence patterns are maintained despite environmental variation.\n\n# Discussion\n\nOur comprehensive analysis of coral-associated fauna communities in Mo'orea reveals that CAFI diversity and composition are structured by multiple interacting factors operating at different spatial and biological scales. The results support most of our hypotheses while revealing unexpected complexity in the mechanisms underlying coral-fauna relationships.\n\n## Environmental and Morphological Drivers of Community Structure\n\nThe strong site effects on CAFI community composition (R\u00b2 = 0.18) demonstrate that reef-scale environmental gradients significantly influence cryptic biodiversity patterns. The clear separation of fringing, lagoon, and barrier reef communities likely reflects differences in hydrodynamic conditions, nutrient availability, and connectivity to larval sources that characterize these distinct reef environments. This finding aligns with previous work showing environmental filtering of reef communities across habitat gradients (Todd 2008) but extends these patterns to cryptic fauna assemblages that are often overlooked in reef biodiversity assessments.\n\nCoral morphotype effects on community structure, while significant, were smaller than expected (R\u00b2 = 0.09), suggesting that within-*Pocillopora* morphological variation may be less important than broader environmental context in determining fauna composition. This result contrasts with studies emphasizing coral architecture as a primary driver of associated fauna diversity (Vytopil & Willis 2001) but may reflect the relatively subtle morphological differences among *Pocillopora* forms compared to comparisons across coral genera.\n\nThe significant coral volume effects on both abundance scaling and community composition support the habitat island paradigm for coral-fauna relationships. The observed scaling exponent (0.73 \u00b1 0.08) closely matches theoretical predictions for habitat size effects and falls within the range reported for other coral systems (0.2-0.35 in Dornelas et al. 2006), though toward the higher end of this range. This steep scaling relationship suggests that coral size has disproportionate effects on associated fauna, with important implications for conservation as coral populations shift toward smaller size classes under anthropogenic stress.\n\n## Coral Architecture and Habitat Quality Effects\n\nThe significant branch width effects on both abundance scaling and diversity patterns provide strong support for the architectural complexity hypothesis. Wide-branching corals consistently supported higher diversity and showed steeper volume-abundance relationships than tight-branching forms, indicating that structural complexity enhances the habitat value of coral colonies beyond simple size effects. This pattern suggests that coral morphological diversity within species may be as important as morphotype identity in determining associated fauna communities.\n\nThe positive relationship between coral physiological condition and CAFI diversity (\u03b2 = 0.22 \u00b1 0.09) represents one of the first demonstrations that coral health metrics predict associated fauna patterns. This finding has important implications for understanding how coral stress and disease may cascade through reef food webs by degrading habitat quality for dependent species. The lack of a significant condition \u00d7 volume interaction suggests that coral health effects operate independently of coral size, providing additive benefits for fauna communities.\n\n## Spatial Structure and Scale-Dependent Processes\n\nThe significant spatial autocorrelation in CAFI communities (Moran's I = 0.24) demonstrates that dispersal limitation and environmental clustering operate at the scale of our study sites (10s to 100s of meters). The taxonomic variation in spatial clustering patterns, with crabs showing stronger autocorrelation than fish, supports our predictions based on differential mobility and dispersal capabilities. This result highlights the importance of considering spatial processes in coral reef community ecology and suggests that conservation strategies should account for spatial connectivity requirements of different taxonomic groups.\n\nThe persistence of residual spatial autocorrelation after accounting for measured environmental variables indicates that unmeasured factors\u2014potentially including biotic interactions, microenvironmental variation, or historical processes\u2014continue to influence community patterns. Future research incorporating fine-scale environmental measurements and experimental manipulations could help identify these cryptic spatial processes.\n\n## Network Structure and Community Organization\n\nThe significant modularity in CAFI co-occurrence networks (Q = 0.41) provides novel evidence for structured community assembly in coral-associated systems. The correspondence between network modules and functional groups supports the hypothesis that co-occurrence patterns reflect ecological processes rather than random assembly. The identification of keystone species through network centrality metrics offers a new approach for prioritizing conservation targets based on their role in maintaining community structure.\n\nThe consistency of network structure across sites, despite significant environmental differences, suggests that fundamental ecological processes governing species associations are maintained across reef environments. This finding has implications for predicting community responses to environmental change and identifying species whose loss might disproportionately affect community stability.\n\n## Limitations and Future Directions\n\nSeveral limitations should be considered when interpreting these results. First, our use of field-based morphotype classifications without genetic confirmation introduces uncertainty in coral host identity, though this likely represents conservative bias given the ecological focus of our questions. Second, the OTU approach to fauna identification may lump or split true species, potentially obscuring fine-scale ecological relationships. However, our focus on community-level patterns rather than species-specific responses minimizes this concern.\n\nThe observational nature of our study design limits causal inference, though the consistency of patterns across multiple analytical approaches strengthens support for proposed mechanisms. Future experimental work manipulating coral characteristics or environmental conditions could provide stronger tests of causal relationships.\n\nThe single time point of our survey prevents assessment of temporal stability in coral-fauna relationships. Given the dynamic nature of coral reef systems, particularly in the face of climate change, longitudinal studies tracking community changes through coral bleaching and recovery cycles would provide valuable insights into the resilience of these associations.\n\n## Broader Implications\n\nOur results have several important implications for coral reef conservation and management. First, the strong environmental effects on CAFI communities suggest that protecting representative examples of different reef environments is crucial for maintaining cryptic biodiversity. Second, the importance of coral size and architectural complexity indicates that management strategies should prioritize maintaining coral populations with diverse size structures and morphologies.\n\nThe demonstration that coral physiological condition affects associated fauna communities provides additional motivation for addressing local stressors that compromise coral health. Management actions that improve water quality, reduce sedimentation, or limit other stressors may have cascading benefits for the diverse communities that depend on coral habitat.\n\nFinally, the spatial structure of CAFI communities highlights the importance of connectivity in reef conservation planning. Marine protected areas and other conservation measures should consider the spatial scales at which different taxonomic groups operate to ensure adequate protection for the full spectrum of reef biodiversity.\n\nOur study demonstrates that coral-associated fauna communities are structured by complex interactions among environmental gradients, coral characteristics, and spatial processes. These findings advance understanding of the mechanisms underlying cryptic reef biodiversity and provide a framework for predicting how these communities may respond to ongoing environmental change. As coral reefs face unprecedented threats, protecting the hidden diversity they harbor will require comprehensive approaches that account for the multiple scales and processes revealed by this work."
          }
        }
      }
    ]
  }
}