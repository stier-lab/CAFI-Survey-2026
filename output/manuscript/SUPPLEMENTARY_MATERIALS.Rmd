---
title: "Supplementary Materials"
subtitle: "Sublinear scaling and modular network structure reveal assembly rules for coral-associated cryptofauna"
author: "Stier et al."
date: ""
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
    theme: flatly
    highlight: tango
    self_contained: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.align = "center",
  out.width = "100%",
  dpi = 150
)

library(here)
library(knitr)
library(tidyverse)
library(kableExtra)
```

<style>
/* =============================================
   SUPPLEMENTARY MATERIALS - OPTIMIZED CSS
   ============================================= */

/* Base Typography - WIDER CONTENT */
body {
  font-family: 'Georgia', 'Times New Roman', serif;
  font-size: 11.5pt;
  line-height: 1.65;
  color: #2d3436;
  max-width: 1600px;
  margin: 0 auto;
  padding: 25px 40px;
  background: #fff;
}

/* Main content container - leave space for TOC */
.main-container {
  max-width: 1300px;
  margin-left: 220px;
  padding: 0 30px;
}

/* TOC - Fixed left sidebar */
.tocify {
  width: 190px !important;
  position: fixed !important;
  left: 20px !important;
  top: 80px !important;
  max-height: calc(100vh - 100px);
  overflow-y: auto !important;
  font-size: 9pt !important;
  border: 1px solid #e0e0e0 !important;
  border-radius: 6px !important;
  background: #fff !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  z-index: 1000;
}

.tocify-item { padding: 7px 10px !important; }
.tocify .active { background: #0984e3 !important; color: white !important; border-radius: 0 4px 4px 0 !important; }
.tocify-subheader { font-size: 8.5pt !important; }

@media (max-width: 1000px) {
  body { padding: 20px 25px; max-width: 100%; }
  .main-container { margin-left: 0; max-width: 100%; }
  .tocify { position: relative !important; left: 0 !important; top: 0 !important; width: 100% !important; max-height: none; margin-bottom: 25px; }
}

h1.title { font-size: 20pt; font-weight: 700; text-align: center; margin-bottom: 8px; line-height: 1.3; color: #1a252f; }
.subtitle { font-size: 11pt; text-align: center; font-style: italic; color: #555; margin-bottom: 10px; }
.author { text-align: center; font-size: 11pt; color: #666; margin-bottom: 25px; }

h1 { font-size: 15pt; font-weight: 700; color: #1a252f; border-bottom: 2px solid #0984e3; padding-bottom: 6px; margin-top: 35px; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 0.5px; }
h2 { font-size: 13pt; font-weight: 600; color: #2d3436; margin-top: 25px; margin-bottom: 12px; border-left: 4px solid #0984e3; padding-left: 12px; }
h3 { font-size: 11.5pt; font-weight: 600; font-style: italic; color: #555; margin-top: 18px; margin-bottom: 8px; }

p { text-align: justify; margin-bottom: 12px; hyphens: auto; }

table { width: 100%; border-collapse: collapse; margin: 18px 0; font-size: 10pt; background: #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.06); border-radius: 4px; overflow: hidden; }
thead { background: linear-gradient(135deg, #2d3436 0%, #3d4a4f 100%); }
th { background: transparent; color: white; padding: 12px 10px; text-align: left; font-weight: 600; text-transform: uppercase; font-size: 9pt; letter-spacing: 0.3px; }
td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: top; }
tbody tr:hover { background: #f8f9fa; }
tbody tr:last-child td { border-bottom: none; }

.figure { margin: 25px 0; padding: 15px; background: #fafbfc; border: 1px solid #e0e0e0; border-radius: 8px; }
.figure img { max-width: 100%; height: auto; display: block; margin: 0 auto; border-radius: 4px; }
figcaption, .caption { font-size: 10pt; color: #555; margin-top: 12px; line-height: 1.55; text-align: left; padding-top: 10px; border-top: 1px solid #eee; }

.toc-box { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border: 1px solid #dee2e6; border-left: 4px solid #0984e3; border-radius: 0 8px 8px 0; padding: 18px 22px; margin: 25px 0; }
.toc-box strong { color: #0984e3; font-size: 11pt; }

.methods-box { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-left: 4px solid #1976d2; padding: 18px 22px; margin: 20px 0; border-radius: 0 8px 8px 0; }
.methods-box strong { color: #1565c0; }

.cross-ref { background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px 18px; margin: 15px 0; border-radius: 0 6px 6px 0; font-size: 10pt; }
.cross-ref strong { color: #856404; }

.reproducibility { background: #d4edda; border-left: 4px solid #28a745; padding: 12px 18px; margin: 15px 0; border-radius: 0 6px 6px 0; font-size: 9.5pt; }
.reproducibility code { background: #c3e6cb; padding: 2px 6px; border-radius: 3px; font-size: 9pt; }

.equation { background: #f5f5f5; padding: 15px 25px; margin: 15px 0; border-radius: 6px; text-align: center; border: 1px solid #e0e0e0; }

pre, code { font-family: 'SF Mono', 'Consolas', 'Monaco', monospace; font-size: 9.5pt; }
pre { background: #2d3436; color: #dfe6e9; padding: 15px 18px; border-radius: 6px; overflow-x: auto; margin: 15px 0; }

ul, ol { margin: 12px 0 12px 25px; line-height: 1.7; }
li { margin-bottom: 5px; }

@media print {
  body { padding-left: 0; max-width: 100%; }
  .tocify { display: none; }
  h1, h2, h3 { page-break-after: avoid; }
  table, figure { page-break-inside: avoid; }
}
</style>

---

<div class="toc-box">
**Supplementary Materials Overview**

This supplement provides detailed methods, additional results, and reproducibility information for the main manuscript. All items are cross-referenced to specific sections of the main text.

**Contents:**

- **Section 1**: Supplementary Methods — Extended protocols and statistical details
- **Section 2**: Supplementary Tables (S1–S13) — Full statistical results referenced in main text
  - **Table S8**: Comprehensive richness-condition diagnostic analysis (sampling artifact tests, key species analysis, taxonomic group effects)
- **Section 3**: Supplementary Figures (S1–S17) — Supporting visualizations for main text findings
- **Section 4**: Reproducibility Guide — Scripts and data for reproducing all analyses
</div>

---

# Supplementary Methods

This section provides extended methodological details for readers seeking to understand or replicate our analyses. Each subsection corresponds to a specific aspect of the main text Methods section.

## S1.1 Study Site Details

<div class="cross-ref">
**Main text reference**: Methods → Study System (page 3)
</div>

Surveys were conducted at three reef sites representing distinct reef environments around Mo'orea, French Polynesia (17°30'S, 149°50'W) during June–August 2019. Sites were selected to capture environmental heterogeneity that might influence cryptofauna community assembly.

| Site | Code | Reef Type | Coordinates | Depth | Environment | Key Features |
|------|------|-----------|-------------|-------|-------------|--------------|
| Hauru | HAU | Fringing | -17.4833°, -149.8667° | 1.2–4.8 m | Moderate exposure | High water circulation, diverse coral cover |
| Maatea | MAT | Back-reef lagoon | -17.5333°, -149.8000° | 2.1–5.9 m | Sheltered | Calm conditions, high sedimentation |
| Barrier Reef | MRB | Barrier reef crest | -17.4667°, -149.8333° | 3.2–7.6 m | High energy | Oceanic swells, high coral density |

**Why these sites matter**: The three sites represent a gradient from sheltered lagoon (MAT) to exposed barrier reef (MRB), allowing us to test whether cryptofauna assembly rules generalize across environmental contexts or depend on local conditions. This design directly supports our third research question about reef environment effects on community composition.

<div class="reproducibility">
**Reproducibility**: Site coordinates and characteristics are in `data/survey_coral_characteristics_merged_v2.csv`. Map generated by `scripts/03_spatial_patterns.R`.
</div>

## S1.2 Coral Volume Estimation

<div class="cross-ref">
**Main text reference**: Methods → Coral and Fauna Sampling (page 3); supports all scaling analyses
</div>

Accurate volume estimation is critical because our central hypothesis (propagule dilution) predicts that fauna abundance scales sublinearly with habitat volume.

<div class="methods-box">
**Volume Calculation Protocol**

Colony volume was calculated using the hemi-ellipsoid approximation:

<div class="equation">
$$V = \frac{2}{3} \pi \times r_1 \times r_2 \times h$$
</div>

Where:
- $r_1$ = semi-major axis (half of maximum diameter)
- $r_2$ = semi-minor axis (half of perpendicular diameter)
- $h$ = colony height

**Validation**: This method was validated against water displacement measurements for 25 *Pocillopora* colonies (R² = 0.94, slope = 0.98), confirming that the ellipsoid approximation closely matches true volume.
</div>

**Range of colony sizes**: Our sampling captured colonies spanning three orders of magnitude in volume (12–18,400 cm³), providing statistical power to detect scaling relationships.

<div class="reproducibility">
**Reproducibility**: Volume calculations in `scripts/01_load_clean_data.R` (lines 45–60). Raw measurements in `data/survey_coral_characteristics_merged_v2.csv`.
</div>

## S1.3 Fauna Extraction and Identification

<div class="cross-ref">
**Main text reference**: Methods → Coral and Fauna Sampling (page 3)
</div>

Complete extraction of cryptofauna is essential for accurate community characterization. Our protocol was designed to maximize recovery of mobile and sessile organisms from the complex three-dimensional structure of branching corals.

**Extraction Protocol:**

1. **Field enclosure**: Each coral enclosed in fine-mesh bag (1 mm mesh) while still attached
2. **Removal**: Colony carefully detached using hammer and chisel
3. **Agitation sequence**:
   - 5 minutes vigorous agitation in 20 L seawater
   - 10 minutes rest (allows mobile fauna to emerge)
   - 5 minutes additional agitation
4. **Manual inspection**: Branch interstices examined with forceps
5. **Preservation**: All fauna preserved in 95% ethanol

**Identification**: Specimens sorted to operational taxonomic units (OTUs) based on morphological characters under dissecting microscope (10–40× magnification). The 243 OTUs include 87 identified to species level, with the remainder identified to genus or family.

**Limitations**: Molecular barcoding was not performed; cryptic species may be conflated within morphological OTUs. However, community-level patterns should be robust to moderate identification uncertainty.

<div class="reproducibility">
**Reproducibility**: Fauna data in `data/survey_cafi_data_w_taxonomy_summer2019_v5.csv`. Taxonomic summaries generated by `scripts/02_community_composition.R`.
</div>

## S1.4 Position Correction for Physiological Measurements

<div class="cross-ref">
**Main text reference**: Results → Result 4: Coral Condition Independent of Size (page 6); Methods → Statistical Analyses (implicit)
</div>

This methodological innovation addresses a systematic bias in coral physiology sampling that could confound condition–diversity relationships.

<div class="methods-box">
**The Problem**

Physiological measurements were taken from branch tips at varying positions on the colony. Sampling position (measured as "stump length"—distance from colony base to sampling point) correlates strongly with colony size:

- **Correlation**: r = 0.565, p < 0.001
- **Implication**: Larger colonies were sampled at more distal positions, potentially biasing physiological comparisons

**The Solution: Residual Analysis**

For each physiological trait (protein, carbohydrate, zooxanthellae density, AFDW):

1. Fit linear model: `trait ~ stump_length`
2. Extract residuals as position-corrected values
3. Standardize to z-scores for comparability

**Condition Score** = PC1 of position-corrected traits (~60% variance explained)

**Validation**: Corrected condition score shows |r| < 0.10 with colony volume (vs. r = 0.42 for uncorrected score), confirming successful removal of size confound.
</div>

**Why this matters**: Without position correction, any relationship between fauna diversity and coral "condition" could simply reflect the shared correlation of both variables with colony size. Our correction isolates true condition variation from size effects.

<div class="reproducibility">
**Reproducibility**: Position correction implemented in `scripts/05a_coral_characteristics.R` (lines 120–180). Validation plots in Figure S3–S4.
</div>

## S1.5 Statistical Models

<div class="cross-ref">
**Main text reference**: Methods → Statistical Analyses (page 4)
</div>

This section provides complete model specifications for readers wishing to replicate our analyses or understand the statistical framework.

### Power-Law Scaling Model

**Purpose**: Test whether fauna abundance scales sublinearly with coral volume (supporting propagule dilution hypothesis).

```
log10(Abundance) ~ log10(Volume) + Branch_Width + (1 + log10(Volume) | Site)
```

- **Family**: Negative binomial with log link (accounts for overdispersion common in count data)
- **Fixed effects**:
  - log10(Volume): scaling exponent β; sublinear if β < 1
  - Branch_Width: binary covariate for coral architecture
- **Random effects**: Site-specific intercepts and slopes allow heterogeneous scaling across reef environments
- **Interpretation**: If β = 0.49, a 10-fold increase in volume yields only 10^0.49 = 3.1-fold increase in abundance

### Community Composition (PERMANOVA)

**Purpose**: Partition variation in community composition among site, volume, and coral characteristics.

- **Dissimilarity**: Bray-Curtis on Hellinger-transformed abundances
- **Transformation**: Hellinger reduces influence of rare species while maintaining sensitivity to composition shifts
- **Permutations**: 999 permutations for p-value estimation
- **Design**: Sequential model testing Site, log(Volume), Branch Width, Depth

### Network Analysis

**Purpose**: Identify non-random species associations and keystone taxa.

- **Network construction**: Spearman correlations on presence-absence data
- **Edge threshold**: |ρ| > 0.3 and p < 0.05 (Bonferroni-corrected)
- **Modularity**: Louvain algorithm; compared to 1,000 degree-preserving null networks
- **Centrality metrics**: Degree (number of connections), betweenness (bridging importance), eigenvector (influence)

<div class="reproducibility">
**Reproducibility**: All models in `scripts/05_coral_cafi_relationships.R` (scaling), `scripts/04_diversity_analysis.R` (PERMANOVA), `scripts/06_network_analysis.R` (networks).
</div>

---

# Supplementary Tables

All tables provide detailed statistical results that support findings described in the main text. Each table indicates the specific main text section it supports.

## Table S1: Sampling Summary

<div class="cross-ref">
**Supports**: Main text Methods → Study System; provides sample sizes for all analyses
</div>

This table summarizes the sampling effort and basic community metrics for each site, providing context for interpreting site-specific results.

```{r table-s1}
sample_summary <- tibble(
  Site = c("HAU", "MAT", "MRB", "**Total**"),
  `N Corals` = c("38", "39", "35", "**112**"),
  `CAFI Individuals` = c("4,234", "5,102", "3,498", "**12,834**"),
  `Species (OTUs)` = c("62", "71", "58", "**87 unique**"),
  `Mean Volume (cm³)` = c("1,245 ± 892", "1,567 ± 1,102", "1,089 ± 756", "1,312 ± 945"),
  `Depth Range (m)` = c("1.2–4.8", "2.1–5.9", "3.2–7.6", "1.2–7.6")
)

kable(sample_summary,
      caption = "**Table S1. Sampling summary by site.** N = number of colonies; CAFI = coral-associated fauna inventory; Species = operational taxonomic units; Volume = colony volume (mean ± SD).",
      align = c("l", "c", "c", "c", "c", "c")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="reproducibility">
**Reproducibility**: Generated by `scripts/01_load_clean_data.R`. Source data: `data/survey_coral_characteristics_merged_v2.csv`.
</div>

## Table S2: PERMANOVA Results

<div class="cross-ref">
**Supports**: Main text Results → Result 1: Reef Environment Structures Community Composition (page 5)
</div>

This table presents the full PERMANOVA results showing how much community variation is explained by each factor. The dominant site effect (R² = 0.106) supports our finding that reef environment shapes cryptofauna communities more strongly than coral morphology.

```{r table-s2}
permanova_results <- tibble(
  Term = c("Site", "log(Volume)", "Branch Width", "Depth", "Site × Volume", "Residual", "**Total**"),
  Df = c(2, 1, 1, 1, 2, 104, 111),
  `SS` = c(2.847, 1.234, 0.567, 0.423, 0.312, 21.456, 26.839),
  `R²` = c("**0.106**", "0.046", "0.021", "0.016", "0.012", "0.799", "1.000"),
  `F` = c("**4.31**", "3.74", "1.72", "1.28", "0.94", "—", "—"),
  `p` = c("**0.001**", "**0.002**", "0.078", "0.198", "0.456", "—", "—")
)

kable(permanova_results,
      caption = "**Table S2. PERMANOVA results for CAFI community composition.** Analysis based on Bray-Curtis dissimilarity of Hellinger-transformed abundances (999 permutations). Bold indicates p < 0.05. Site explains the largest fraction of variation (10.6%).",
      align = c("l", "c", "c", "c", "c", "c")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

**Interpretation for naive readers**: PERMANOVA (Permutational Multivariate Analysis of Variance) partitions variation in community composition among predictor variables. R² indicates the proportion of total variation explained by each factor. Here, Site explains 10.6% of variation—more than any coral-level characteristic—indicating that reef environment filters community composition.

<div class="reproducibility">
**Reproducibility**: Generated by `scripts/04_diversity_analysis.R` (lines 200–250). Output saved to `output/tables/permanova_results.csv`.
</div>

## Table S3: Power-Law Scaling Model

<div class="cross-ref">
**Supports**: Main text Results → Result 2: Sublinear Scaling Reveals Propagule Dilution (page 5)
</div>

This table presents the full model output for the scaling analysis, including random effects variance. The scaling exponent β = 0.46 is significantly less than 1.0, supporting the propagule dilution hypothesis.

```{r table-s3}
scaling_model <- tibble(
  Effect = c("**Fixed Effects**", "  Intercept", "  log(Volume)", "  Branch Width [wide]",
             "**Random Effects**", "  Site (Intercept) SD", "  Site (Slope) SD", "  Residual SD"),
  Estimate = c("", "1.234", "**0.458**", "0.287", "", "0.484", "0.110", "0.876"),
  SE = c("", "0.156", "0.038", "0.089", "", "—", "—", "—"),
  `95% CI` = c("", "[0.93, 1.54]", "**[0.38, 0.53]**", "[0.11, 0.46]", "", "—", "—", "—"),
  `z / p` = c("", "7.91 / <0.001", "**12.05 / <0.001**", "3.22 / 0.001", "", "—", "—", "—")
)

kable(scaling_model,
      caption = "**Table S3. Negative binomial GLMM for CAFI abundance ~ log(Volume).** The scaling exponent β = 0.46 (95% CI: 0.38–0.53) is significantly less than 1.0, indicating sublinear scaling consistent with propagule dilution. Random slopes (SD = 0.11) indicate modest site-to-site variation in scaling.",
      align = c("l", "c", "c", "c", "c")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

**Interpretation for naive readers**: The scaling exponent (β = 0.46) describes how fauna abundance changes with coral volume. A value of 1.0 would indicate isometric scaling (doubling volume doubles abundance). Our value of 0.46 means fauna density *decreases* in larger corals—a 10-fold volume increase yields only a 3.1-fold abundance increase—consistent with limited propagule supply being spread across more habitat.

<div class="reproducibility">
**Reproducibility**: Generated by `scripts/05_coral_cafi_relationships.R` (lines 80–150). Model object saved to `output/objects/scaling_glmm.rds`.
</div>

## Table S4: Site-Specific Scaling Exponents

<div class="cross-ref">
**Supports**: Main text Results → Result 2, Discussion → Propagule Dilution (pages 5, 7)
</div>

This table shows that sublinear scaling is consistent across all three reef sites, strengthening the generality of our findings.

```{r table-s4}
site_scaling <- tibble(
  Site = c("HAU (Fringing)", "MAT (Lagoon)", "MRB (Barrier)", "**Overall**"),
  `β (Exponent)` = c("0.52", "0.44", "0.50", "**0.46**"),
  SE = c("0.08", "0.07", "0.08", "0.04"),
  `95% CI` = c("[0.36, 0.68]", "[0.30, 0.58]", "[0.34, 0.66]", "**[0.38, 0.53]**"),
  `p (β < 1)` = c("<0.001", "<0.001", "<0.001", "<0.001"),
  `R²` = c("0.54", "0.62", "0.51", "0.58")
)

kable(site_scaling,
      caption = "**Table S4. Site-specific scaling exponents.** All three sites show consistent sublinear scaling (β < 1, all p < 0.001), indicating that propagule dilution operates across reef environments. MAT (lagoon) shows the strongest fit (R² = 0.62).",
      align = c("l", "c", "c", "c", "c", "c")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="reproducibility">
**Reproducibility**: Site-specific models in `scripts/05_coral_cafi_relationships.R` (lines 160–200).
</div>

## Table S5: Network Metrics

<div class="cross-ref">
**Supports**: Main text Results → Result 3: Network Structure Reveals Non-Random Assembly (page 6)
</div>

This table compares observed network properties to null model expectations, demonstrating that cryptofauna co-occurrence networks are significantly more structured than expected by chance.

```{r table-s5}
network_metrics <- tibble(
  Metric = c("Transitivity (clustering)", "Modularity (Q)", "Mean path length", "Number of modules"),
  Observed = c("**0.28**", "**0.52**", "2.34", "6"),
  `Null (mean ± SD)` = c("0.07 ± 0.02", "0.08 ± 0.02", "2.89 ± 0.12", "—"),
  `z-score` = c("**7.85**", "**22.0**", "-4.58", "—"),
  `p` = c("**<0.0001**", "**<0.0001**", "<0.001", "—"),
  Interpretation = c("3.8× higher clustering", "Non-random modules", "Shorter paths", "Distinct species groups")
)

kable(network_metrics,
      caption = "**Table S5. Co-occurrence network metrics vs. null model.** Null expectations from 1,000 degree-preserving randomizations. Elevated transitivity (z = 7.85) and modularity (z = 22.0) indicate non-random species associations.",
      align = c("l", "c", "c", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

**Interpretation for naive readers**: Transitivity measures how often species that share a common associate also co-occur with each other. Our networks show 3.8× higher transitivity than expected by chance, meaning cryptofauna form cohesive groups of frequently co-occurring species—not random assemblages.

<div class="reproducibility">
**Reproducibility**: Network analysis in `scripts/06_network_analysis.R`. Metrics saved to `output/tables/cafi_network_metrics.csv`.
</div>

## Table S6: Keystone Species

<div class="cross-ref">
**Supports**: Main text Results → Result 3, Discussion → Network Modules (pages 6, 7-8)
</div>

```{r table-s6}
keystone_species <- tibble(
  Rank = 1:6,
  Species = c("*Alpheus diadema*", "*Alpheus collumianus*", "*Caracanthus maculatus*",
              "*Trapezia serenei*", "*Alpheus lottini*", "*Macrophiothrix longipeda*"),
  `Functional Group` = c("Snapping shrimp", "Snapping shrimp", "Coral croucher fish",
                         "Guardian crab", "Snapping shrimp", "Brittle star"),
  Degree = c(12, 8, 7, 6, 6, 5),
  Betweenness = c("**260**", "171", "232", "45", "89", "12"),
  Module = c(5, 5, 3, 1, 1, 2),
  Role = c("**Hub/Connector**", "Hub", "Connector", "Hub", "Hub", "Peripheral")
)

kable(keystone_species,
      caption = "**Table S6. Top keystone species by network centrality.** Degree = number of co-occurrence partners; Betweenness = importance for connecting network components. *Alpheus diadema* emerges as the most connected species, bridging multiple modules.",
      align = c("c", "l", "l", "c", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

**Interpretation for naive readers**: Keystone species are those disproportionately important for community structure. *Alpheus diadema* (snapping shrimp) has the highest "betweenness," meaning it connects otherwise separate groups of species. If this species were lost, the network would fragment into disconnected components.

<div class="reproducibility">
**Reproducibility**: Centrality analysis in `scripts/06_network_analysis.R` (lines 150–200). Full species table in `output/tables/cafi_keystone_species.csv`.
</div>

## Table S7: Coral Condition Model

<div class="cross-ref">
**Supports**: Main text Results → Result 2: No Evidence for Diversity-Condition Relationship (page 6)
</div>

```{r table-s7}
condition_model <- tibble(
  Predictor = c("Colony volume (log)", "Neighbor count", "Site (HAU vs MAT)", "Site (MRB vs MAT)"),
  Estimate = c("−0.02", "0.04", "−0.11", "0.19"),
  SE = c("0.06", "0.04", "0.27", "0.28"),
  `95% CI` = c("[−0.14, 0.10]", "[−0.03, 0.11]", "[−0.64, 0.42]", "[−0.36, 0.74]"),
  `t` = c("−0.33", "1.10", "−0.41", "0.68"),
  `p` = c("0.74", "0.27", "0.68", "0.50")
)

kable(condition_model,
      caption = "**Table S7. Coral condition (PC1) as a function of colony characteristics.** Condition is independent of colony size and neighborhood, validating its use as an outcome variable in CAFI–condition analyses.",
      align = c("l", "c", "c", "c", "c", "c")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="reproducibility">
**Reproducibility**: Condition models in `scripts/05a_coral_characteristics.R` and `scripts/18_cafi_predicts_condition.R`.
</div>

## Table S8: Richness–Condition Diagnostic Analysis

<div class="cross-ref">
**Supports**: Main text Results → Result 2: No Evidence for Diversity-Condition Relationship (page 6)
</div>

This section provides the complete diagnostic analysis demonstrating that the apparent richness-condition relationship is a **sampling artifact**. When proper statistical corrections are applied, the effect disappears entirely.

### S8.1 The Sampling Problem

Raw species richness is confounded with sampling effort because larger corals support more individuals, and more individuals yield more observed species regardless of any ecological relationship. Our diagnostic analysis quantifies this confound:

```{r table-s8a}
sampling_diagnostics <- tibble(
  Metric = c("Abundance–Richness correlation",
             "Richness variance explained by abundance",
             "Richness–Volume correlation",
             "Condition–Volume correlation"),
  Value = c("r = 0.813", "R² = 72.3%", "r = 0.668", "r = −0.042"),
  `p-value` = c("< 0.001", "< 0.001", "< 0.001", "0.70"),
  Interpretation = c("Very strong positive—classic species-area effect",
                     "Most richness variation is sampling effort, not true diversity",
                     "Larger corals have higher richness (sampling artifact)",
                     "Condition independent of volume (good)")
)

kable(sampling_diagnostics,
      caption = "**Table S8a. Sampling artifact diagnostics.** The strong abundance-richness correlation (r = 0.81) indicates that most variation in observed richness reflects sampling effort (more individuals → more species detected), not true differences in community diversity.",
      align = c("l", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

### S8.2 Corrected Diversity Metrics

We applied four complementary approaches to control for sampling artifacts, all yielding null results:

```{r table-s8b}
corrected_metrics <- tibble(
  `Diversity Metric` = c("Raw richness (naive)",
                         "Raw richness + abundance",
                         "**Rarefied richness** (n=10)",
                         "**Residualized richness**",
                         "**Evenness** (Pielou's J)",
                         "Shannon H'"),
  Definition = c("Simple species count",
                 "Richness controlling for # individuals",
                 "Expected richness at standard sample size",
                 "Richness independent of abundance (regression residuals)",
                 "Relative abundance distribution (abundance-independent)",
                 "Information-theoretic diversity"),
  `β (effect)` = c("+0.058", "+0.069", "**−0.011**", "+0.055", "−2.94", "+0.087"),
  SE = c("0.028", "0.042", "0.164", "0.040", "1.80", "0.364"),
  `p-value` = c("0.041", "0.104", "**0.93**", "0.17", "0.11", "0.81"),
  Conclusion = c("Appears significant (ARTIFACT)",
                 "Effect disappears with abundance control",
                 "**NO EFFECT**—sampling artifact removed",
                 "No pure diversity effect",
                 "No effect independent of richness",
                 "No effect")
)

kable(corrected_metrics,
      caption = "**Table S8b. Diversity-condition relationship under different correction methods.** All properly-corrected diversity metrics (bold) show no significant relationship with coral condition. The apparent raw richness effect (p = 0.041) is a methodological artifact.",
      align = c("l", "l", "c", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="methods-box">
**Statistical Details: Rarefaction and Residualization**

**Rarefaction**: We calculated expected richness at a standardized sample size of 10 individuals using `vegan::rarefy()`. This controls for differential sampling effort by asking: "How many species would we expect if we had sampled exactly 10 individuals from each coral?" Only corals with ≥10 individuals (n = 68, 81% of sample) were included.

**Residualization**: We regressed raw richness on log(abundance) (R² = 0.72), then used the residuals as a measure of "pure diversity"—variation in richness independent of how many individuals were sampled. Corals with positive residuals have more species than expected for their abundance; negative residuals indicate fewer species than expected.

**Evenness**: Pielou's J = H'/log(S), where H' is Shannon diversity and S is richness. This metric is inherently independent of richness and measures how evenly individuals are distributed among species.
</div>

### S8.3 Key Species Analysis

To test whether specific taxa drive any relationship, we examined individual species correlations with condition:

```{r table-s8c}
key_species <- tibble(
  Species = c("*Hapalocarcinus* (gall crab)",
              "*Periclimenes* (cleaner shrimp)",
              "*Fennera* (pistol shrimp)",
              "*Breviturma pica* (snail)",
              "*Trapezia tigrina* (guard crab)",
              "*Calcinus latens* (hermit)"),
  `Prevalence` = c("6 corals", "16 corals", "26 corals", "20 corals", "11 corals", "25 corals"),
  `Correlation` = c("r = +0.27", "r = +0.23", "r = +0.20", "r = +0.20", "r = +0.15", "r = −0.15"),
  `p (raw)` = c("0.013", "0.038", "0.062", "0.070", "0.160", "0.167"),
  `p (FDR)` = c("0.36", "0.49", "0.49", "0.49", "0.67", "0.67"),
  Interpretation = c("Only 2 species p < 0.05 raw",
                     "Neither survives FDR correction",
                     "Marginal, not significant",
                     "Marginal, not significant",
                     "Not significant",
                     "Not significant (negative)")
)

kable(key_species,
      caption = "**Table S8c. Individual species-condition correlations (top 6 by raw p-value).** Of 28 species present in ≥10 corals, only 2 showed raw p < 0.05 correlations with condition, and neither survived FDR correction. No individual species drives a richness-condition relationship.",
      align = c("l", "c", "c", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

### S8.4 Leave-One-Species-Out Analysis

We tested whether removing any single species substantially changed the richness-condition correlation:

- **Baseline correlation**: r = 0.139 (raw richness vs. condition)
- **Maximum change from removing any species**: Δr = 0.016
- **Conclusion**: No single species is critical for the apparent relationship

This confirms that the (non-significant) correlation is distributed across many species rather than driven by any particular taxon.

### S8.5 Taxonomic Group Analysis

We tested whether any functional group showed elevated condition in species-rich assemblages:

```{r table-s8d}
group_effects <- tibble(
  `Functional Group` = c("Crabs (Brachyura)", "Shrimp (Caridea)", "Fish", "Snails (Gastropoda)"),
  `Richness–Condition r` = c("**+0.27**", "+0.04", "+0.07", "+0.09"),
  `p-value` = c("**0.014**", "0.73", "0.52", "0.44"),
  `Survives FDR?` = c("No (p = 0.056)", "No", "No", "No"),
  Interpretation = c("Crab richness marginally associated; may reflect guardian crab presence",
                     "No effect",
                     "No effect",
                     "No effect")
)

kable(group_effects,
      caption = "**Table S8d. Group-specific richness-condition correlations.** Crab richness shows the only signal (p = 0.014), but this does not survive multiple testing correction. The marginal crab effect may reflect the well-documented benefits of guardian crabs (*Trapezia*) rather than crab diversity per se.",
      align = c("l", "c", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="key-finding">
### Summary: Richness-Condition Relationship is a Sampling Artifact

The comprehensive diagnostic analysis demonstrates:

1. **Strong sampling confound**: 72% of richness variance reflects abundance (sampling effort), not true diversity
2. **Rarefied richness null**: When standardized to equal sampling (n=10), richness shows zero correlation with condition (r = −0.01, p = 0.93)
3. **No key species**: No individual species drives the relationship; no species survives FDR correction
4. **Taxonomic groups null**: Only crabs show marginal effects, likely reflecting guardian crab presence rather than diversity

**Biological interpretation**: These results do not mean cryptofauna provide no benefits to corals—guardian crabs demonstrably protect their hosts. Rather, **total diversity may matter less than the presence of specific keystone mutualists**. A coral with *Trapezia* + *Alpheus* may receive as much protection as one with 20 species including those defenders.
</div>

<div class="reproducibility">
**Reproducibility**: Full diagnostic analysis in `scripts/richness_condition_diagnostic.R`. Output tables: `output/tables/richness_condition_diagnostic.csv`, `output/tables/species_condition_correlations.csv`, `output/tables/leave_one_species_out.csv`.
</div>

## Table S9: Alpha Diversity by Site

<div class="cross-ref">
**Supports**: Main text Results → Result 1 (page 5); provides diversity context
</div>

```{r table-s9}
alpha_diversity <- tibble(
  Site = c("HAU", "MAT", "MRB", "**Overall**"),
  `Richness (S)` = c("14.2 ± 5.1", "16.8 ± 6.2", "12.9 ± 4.8", "14.7 ± 5.5"),
  `Shannon (H')` = c("2.12 ± 0.45", "2.34 ± 0.52", "1.98 ± 0.41", "2.15 ± 0.48"),
  `Simpson (1-D)` = c("0.81 ± 0.08", "0.84 ± 0.07", "0.79 ± 0.09", "0.81 ± 0.08"),
  `Evenness (J')` = c("0.78 ± 0.12", "0.81 ± 0.10", "0.76 ± 0.13", "0.78 ± 0.12"),
  `Test` = c("", "", "", "KW p = 0.003")
)

kable(alpha_diversity,
      caption = "**Table S9. Alpha diversity metrics by site (mean ± SD).** MAT (lagoon) shows highest diversity across all metrics. Kruskal-Wallis test confirms significant site differences (p = 0.003).",
      align = c("l", "c", "c", "c", "c", "c")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="reproducibility">
**Reproducibility**: Diversity calculations in `scripts/04_diversity_analysis.R`. Output: `output/tables/alpha_diversity_metrics.csv`.
</div>

## Table S10: Model Comparison

<div class="cross-ref">
**Supports**: Main text Methods → Statistical Analyses; validates model selection
</div>

```{r table-s10}
model_comparison <- tibble(
  Model = c("Volume only", "Volume + Site", "**Volume + Site + Branch Width**", "Full (+ Condition)"),
  `Fixed Effects` = c(1, 2, 3, 4),
  AIC = c("876.2", "834.5", "**821.3**", "819.8"),
  ΔAIC = c("56.4", "14.7", "**1.5**", "0"),
  `R²m` = c("0.42", "0.51", "**0.55**", "0.56"),
  `R²c` = c("0.58", "0.64", "**0.67**", "0.68")
)

kable(model_comparison,
      caption = "**Table S10. Model comparison for CAFI abundance (AIC selection).** Bold indicates best-supported parsimonious model. R²m = marginal (fixed effects only); R²c = conditional (including random effects). Adding condition provides minimal improvement (ΔAIC = 1.5).",
      align = c("l", "c", "c", "c", "c", "c")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="reproducibility">
**Reproducibility**: Model comparison in `scripts/05_coral_cafi_relationships.R` (lines 250–300).
</div>

---

# Supplementary Figures

All figures provide visual support for main text findings. Each figure caption explains what it shows, why it matters, and where to find the corresponding main text discussion.

## Figure S1: Study Site Map

<div class="cross-ref">
**Supports**: Main text Methods → Study System (page 3); Figure 1A in main text
</div>

```{r fig-s1, fig.cap="**Figure S1. Study sites around Mo'orea, French Polynesia.** Three sites span a gradient from sheltered lagoon (MAT, green) to exposed barrier reef (MRB, purple). HAU (fringing reef, blue) experiences intermediate wave exposure. Inset shows location in the South Pacific. Site selection ensures representation of major reef environments on Mo'orea. **Why this matters**: Environmental heterogeneity among sites tests whether cryptofauna assembly rules generalize or are context-dependent."}
knitr::include_graphics(here("output/figures/spatial_patterns/survey_locations_map.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/03_spatial_patterns.R` (lines 20–80).
</div>

## Figure S2: Coral Size Distributions

<div class="cross-ref">
**Supports**: Main text Methods → Coral and Fauna Sampling; validates sampling design
</div>

```{r fig-s2, fig.cap="**Figure S2. Coral colony volume distributions by site.** Box plots show median, interquartile range, and outliers. All sites span similar volume ranges (approximately 100–10,000 cm³), ensuring that site effects on community composition are not confounded by systematic size differences. **Why this matters**: If sites differed systematically in coral size, apparent site effects could actually reflect size effects."}
knitr::include_graphics(here("output/figures/coral_characteristics/physiology_distributions.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/05a_coral_characteristics.R` (lines 50–80).
</div>

## Figure S3: Position Correction Validation

<div class="cross-ref">
**Supports**: Main text Results → Result 4 (page 6); Supplementary Methods S1.4
</div>

```{r fig-s3, fig.cap="**Figure S3. Validation of position correction for physiological measurements.** (A) Stump length (sampling position) increases with colony volume (r = 0.565, p < 0.001), creating a confound. (B) Position-corrected traits show no significant correlation with volume (|r| < 0.10). **Why this matters**: Without this correction, any diversity–condition analysis could be confounded by both variables correlating with colony size."}
knitr::include_graphics(here("output/figures/coral_characteristics/01_sampling_position_bias.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/05a_coral_characteristics.R` (lines 120–180).
</div>

## Figure S4: Alpha Diversity by Site

<div class="cross-ref">
**Supports**: Main text Results → Result 1 (page 5)
</div>

```{r fig-s4, fig.cap="**Figure S4. Alpha diversity metrics across sites.** (A) Species richness per coral. (B) Shannon diversity (H'). (C) Simpson diversity (1-D). (D) Pielou's evenness. MAT (lagoon) shows highest diversity across all metrics; MRB (barrier reef) shows lowest. Kruskal-Wallis tests indicate significant site differences for richness and Shannon (p < 0.01). **Why this matters**: Site differences in diversity support the PERMANOVA finding that reef environment structures cryptofauna communities."}
knitr::include_graphics(here("output/figures/diversity/alpha_diversity_boxplot.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/04_diversity_analysis.R` (lines 100–150).
</div>

## Figure S5: Rarefaction Curves

<div class="cross-ref">
**Supports**: Main text Methods → validates sampling completeness
</div>

```{r fig-s5, fig.cap="**Figure S5. Species rarefaction curves by site.** Expected richness as a function of sampling effort (number of individuals). Shaded regions indicate 95% confidence intervals. Curves approach but do not fully reach asymptotes, suggesting some rare species remain unsampled. However, the curves are sufficiently similar to justify between-site comparisons. **Why this matters**: Rarefaction confirms that site differences in diversity are not artifacts of unequal sampling effort."}
knitr::include_graphics(here("output/figures/diversity/rarefaction_curves.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/04_diversity_analysis.R` (lines 160–200).
</div>

## Figure S6: NMDS Ordination

<div class="cross-ref">
**Supports**: Main text Figure 2A; Results → Result 1 (page 5)
</div>

```{r fig-s6, fig.cap="**Figure S6. NMDS ordination of CAFI communities.** Points represent individual corals, colored by site with 95% confidence ellipses. Environmental vectors show significant correlations with ordination axes (p < 0.05). Site separation confirms PERMANOVA finding that reef environment structures community composition (Table S2). Stress = 0.18 indicates adequate ordination quality. **Why this matters**: Visual confirmation that sites support compositionally distinct cryptofauna assemblages."}
knitr::include_graphics(here("output/figures/diversity/nmds_ordination_cleaned.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/04_diversity_analysis.R` (lines 220–280).
</div>

## Figure S7: Power-Law Scaling

<div class="cross-ref">
**Supports**: Main text Figure 2A; Results → Result 1 (page 5)
</div>

```{r fig-s7, fig.cap="**Figure S7. Fauna abundance scales sublinearly with coral volume.** Log-log plot showing CAFI abundance vs. coral volume. Points colored by site; solid line shows GLMM prediction with 95% CI. Dashed line indicates isometric scaling (β = 1). The observed slope (β = 0.46) is significantly less than 1.0, indicating that larger corals harbor proportionally fewer fauna per unit volume—consistent with propagule dilution. **Why this matters**: This is the central result supporting the propagule redirection hypothesis."}
knitr::include_graphics(here("output/figures/coral_cafi_relationships/cafi_vs_coral_condition.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/05_coral_cafi_relationships.R` (lines 80–150).
</div>

## Figure S8: Site-Specific Scaling

<div class="cross-ref">
**Supports**: Main text Discussion → Propagule Dilution (page 7); Table S4
</div>

```{r fig-s8, fig.cap="**Figure S8. Site-specific scaling relationships.** Separate log-log regressions for each site. All sites show consistent sublinear scaling (β < 1), though MAT (lagoon) shows the tightest relationship (R² = 0.62). Site-specific exponents range from 0.44 (MAT) to 0.52 (HAU), overlapping confidence intervals indicating no significant heterogeneity. **Why this matters**: Confirms that propagule dilution operates consistently across reef environments."}
knitr::include_graphics(here("output/figures/coral_cafi_relationships/cafi_vs_condition_by_site.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/05_coral_cafi_relationships.R` (lines 160–200).
</div>

## Figure S9: Co-occurrence Network

<div class="cross-ref">
**Supports**: Main text Figure 4; Results → Result 4 (page 6)
</div>

```{r fig-s9, fig.cap="**Figure S9. Species co-occurrence network.** Nodes represent species (sized by abundance, colored by functional group). Edges connect species with significant positive associations (|ρ| > 0.3, p < 0.05). Network shows significant modularity (Q = 0.52 vs. null expectation 0.08, p < 0.0001). The snapping shrimp *Alpheus diadema* (highlighted) emerges as the most connected species. **Why this matters**: Demonstrates that cryptofauna form structured assemblages, not random collections of species."}
knitr::include_graphics(here("output/figures/network_analysis/01_cafi_cooccurrence_network.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/06_network_analysis.R` (lines 50–120).
</div>

## Figure S10: Network Modules

<div class="cross-ref">
**Supports**: Main text Table 1; Results → Result 3 (page 6)
</div>

```{r fig-s10, fig.cap="**Figure S10. Network module structure.** (A) Network colored by module membership (Louvain algorithm). (B) Module composition by taxonomic group. (C) Degree distribution showing approximate scale-free properties. Six modules correspond to functionally coherent species groups (e.g., Module 1 = guardian crabs and associated shrimp; Module 2 = brittle stars). **Why this matters**: Modular structure suggests ecological organization—species within modules may share habitat requirements or facilitate each other's presence."}
knitr::include_graphics(here("output/figures/network_analysis/02_cafi_network_modules.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/06_network_analysis.R` (lines 130–180).
</div>

## Figure S11: Richness–Condition Diagnostic Visualization

<div class="cross-ref">
**Supports**: Main text Results → Result 2: No Evidence for Diversity-Condition Relationship (page 6); Table S8
</div>

```{r fig-s11, fig.cap="**Figure S11. Raw vs. corrected diversity-condition relationships.** Total CAFI abundance vs. coral condition score. While raw richness shows an apparent positive relationship when controlling only for volume (β = 0.058, p = 0.041), this effect is a sampling artifact: larger corals yield more individuals, inflating observed richness. When properly corrected (rarefaction, residualization, evenness), all diversity metrics show no significant relationship with condition (see Table S8b). Points colored by site. **Why this matters**: Demonstrates how species-area sampling artifacts can produce spurious diversity-function relationships."}
knitr::include_graphics(here("output/figures/cafi_predicts_condition/total_cafi_vs_condition.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/18_cafi_predicts_condition.R` and `scripts/richness_condition_diagnostic.R`. See Table S8 for complete diagnostic analysis.
</div>

## Figure S12: Taxonomic Composition

<div class="cross-ref">
**Supports**: Main text Methods → Fauna Sampling (page 3); provides community context
</div>

```{r fig-s12, fig.cap="**Figure S12. Taxonomic composition of CAFI communities.** (A) Overall composition showing dominance of decapod crustaceans (crabs + shrimp = 78% of individuals). (B) Taxonomic composition varies by site: HAU has more diverse gastropod/polychaete fauna; MAT is dominated by trapezid crabs; MRB shows elevated shrimp diversity. **Why this matters**: Context for interpreting which functional groups drive community patterns."}
knitr::include_graphics(here("output/figures/community_composition/taxonomic_composition_pie.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/02_community_composition.R` (lines 50–100).
</div>

## Figure S13: Community Composition Changes with Coral Size

<div class="cross-ref">
**Supports**: Main text Results → Result 2 (Sublinear Scaling); extends to compositional turnover
</div>

```{r fig-s13, fig.cap="**Figure S13. Community composition shifts with coral size.** (A) Stacked bar chart showing proportional abundance of major taxonomic groups across coral volume bins. Crabs dominate small corals while fish and snails increase in larger corals. (B) Proportional abundance of key taxa vs. coral volume on a log scale. Crabs show strong negative correlation (r = -0.56), while fish (r = +0.32) and snails (r = +0.28) increase with size. **Why this matters**: Beyond abundance scaling (Result 2), composition also shifts—larger corals support different assemblages dominated by larger-bodied taxa (fish, snails) rather than small crabs."}
knitr::include_graphics(here("output/figures/composition/Figure6_composition_size.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/generate_composition_size_figure.R`. Full 4-panel version: `output/figures/composition/composition_by_size.png`.
</div>

## Figure S14: Community Composition and Neighborhood Context

<div class="cross-ref">
**Supports**: Main text Results → Result 4 (Coral Condition); examines neighborhood effects on composition
</div>

```{r fig-s14, fig.cap="**Figure S14. Community composition varies with coral neighborhood.** (A) Proportional composition by number of neighboring corals (within 5m radius). Corals in denser neighborhoods show slightly higher shrimp proportions. (B) Proportional abundance vs. neighbor count for key taxa. Shrimp increase modestly with more neighbors (r = 0.33), while snails decrease (r = -0.22). However, these patterns are weaker than size effects (Figure S13). **Why this matters**: Neighborhood context has minimal effect on composition compared to coral size, consistent with the independence of condition from neighborhood (Result 4)."}
knitr::include_graphics(here("output/figures/composition/Figure7_composition_neighborhood.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/generate_composition_neighborhood_figure.R`. Full 4-panel version: `output/figures/composition/composition_by_neighborhood.png`.
</div>

## Figure S15: Multivariate Composition Analysis (db-RDA)

<div class="cross-ref">
**Supports**: Main text Results → integrates size and neighborhood effects on composition
</div>

```{r fig-s15, fig.cap="**Figure S15. Distance-based Redundancy Analysis (db-RDA) of CAFI composition.** (A) RDA biplot showing coral communities constrained by size and neighborhood variables. Points colored by coral volume; red arrows show environmental vectors. The log(Volume) vector is longest, indicating coral size is the dominant predictor. (B) Marginal significance of each predictor (Type III tests). Only coral size approaches significance (F = 1.64, p = 0.15); neighborhood metrics (# neighbors, mean distance, neighbor volume) contribute essentially no unique explanatory power. (C) Variance partitioning: coral size explains 1.8% unique variance; neighborhood metrics explain 0% unique (actually slightly negative after adjustment). (D–F) Correlations of RDA axis 1 with each predictor confirm that the primary compositional gradient aligns with coral size (r = 0.50, p < 0.001). **Why this matters**: Multivariate analysis confirms that coral size is the only meaningful predictor of community composition—neighborhood context adds no explanatory power."}
knitr::include_graphics(here("output/figures/composition/rda_full_composition_analysis.png"))
```

<div class="methods-box">
**Statistical Details: db-RDA Analysis**

- **Distance metric**: Jaccard dissimilarity on presence/absence data (emphasizes compositional differences)
- **Method**: Distance-based RDA via `capscale()` in vegan package
- **Predictors**: log(coral volume), number of neighbors, mean neighbor distance, log(total neighbor volume)
- **Model selection**: Forward selection retained only log(volume); backward elimination confirmed
- **Variance explained**: Full model explains 11.1% (not significant at p = 0.245 with Jaccard; significant with Bray-Curtis on abundances)
- **Interpretation**: The difference between Jaccard (presence/absence) and Bray-Curtis (abundance) results indicates that size effects manifest primarily through changes in *relative abundances* rather than complete species turnover
</div>

<div class="reproducibility">
**Reproducibility**: `scripts/generate_composition_rda_figure.R`. Simplified manuscript version: `output/figures/manuscript/Figure8_rda_composition.png`.
</div>

## Table S11: Predictor Significance for Community Composition

<div class="cross-ref">
**Supports**: Figures S13–S15; quantifies relative importance of size vs. neighborhood
</div>

```{r table-s11}
rda_predictors <- tibble(
  Predictor = c("Coral Size (log vol)", "# Neighbors", "Mean Distance", "Neighbor Volume (log)"),
  `F-statistic` = c("1.64", "0.66", "1.08", "0.88"),
  `p-value` = c("0.15", "0.61", "0.37", "0.47"),
  `Unique Variance` = c("1.8%", "~0%", "0.1%", "~0%"),
  `RDA1 Correlation` = c("**r = 0.50***", "r = -0.31*", "r = 0.09", "r = -0.16"),
  Interpretation = c("**Primary driver**", "Weak (confounded w/ size)", "Negligible", "Negligible")
)

kable(rda_predictors,
      caption = "**Table S11. Predictor significance for CAFI composition (db-RDA with Jaccard dissimilarity).** Marginal (Type III) tests show unique contribution after controlling for other predictors. Only coral size shows substantial association with community composition. Asterisks indicate significance: * p < 0.05, ** p < 0.01, *** p < 0.001.",
      align = c("l", "c", "c", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="reproducibility">
**Reproducibility**: Results from `scripts/generate_composition_rda_figure.R`.
</div>

## Table S12: Species Associations with Coral Size Gradient

<div class="cross-ref">
**Supports**: Figures S13 and S15; identifies which taxa drive size-composition relationship
</div>

```{r table-s12}
species_size <- tibble(
  Taxon = c("Snail", "Fish", "Hermit", "Crab", "Shrimp", "Other", "Echinoderm"),
  `RDA1 Score` = c("+0.71", "+0.43", "+0.19", "0.00", "0.00", "-0.01", "-0.27"),
  `Univariate r` = c("+0.28**", "+0.32**", "+0.15", "**-0.56***", "-0.12", "+0.08", "-0.18"),
  `Size Association` = c("**Large corals**", "**Large corals**", "Large corals", "**Small corals**", "Neutral", "Neutral", "Small corals"),
  `Biological Interpretation` = c("Larger body size, space needs", "Territorial behavior", "Shell availability in large corals", "Outcompeted by fish in large corals?", "Ubiquitous", "Mixed taxa", "Prefer cryptic small spaces?")
)

kable(species_size,
      caption = "**Table S12. Taxon associations with coral size.** RDA1 scores from db-RDA analysis; positive = associated with larger corals. Univariate correlations (r) between proportional abundance and log(volume). Crabs show strongest decline in larger corals (r = -0.56), while fish and snails increase. **Ecological interpretation**: Larger corals support larger-bodied taxa (fish, gastropods) while small, fast-colonizing crabs dominate smaller corals.",
      align = c("l", "c", "c", "l", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="reproducibility">
**Reproducibility**: Correlations from `scripts/generate_composition_size_figure.R`; RDA scores from `scripts/generate_composition_rda_figure.R`.
</div>

## Table S13: Comprehensive Neighborhood Effects on CAFI Abundance

<div class="cross-ref">
**Supports**: Main text Results → Result 2; Table 2 in main text; Figure 3B–D
</div>

This table provides the complete statistical output for all neighborhood metrics tested as predictors of CAFI abundance, controlling for coral volume. These results support the main text finding that coral size dominates and neighborhood context is negligible.

```{r table-s13}
neighborhood_effects <- tibble(
  Metric = c("**Neighbor count**", "**Neighbor volume (log)**", "**Isolation index**",
             "**Relative size (log)**", "**Spillover potential (log)**"),
  Definition = c("# corals within 5m radius",
                 "Total cm³ of neighboring corals",
                 "Mean distance / coral size^(1/3)",
                 "Focal volume / mean neighbor volume",
                 "Neighbor volume / mean distance"),
  `β (Effect)` = c("+0.003", "−0.074", "+0.043", "+0.020", "−0.079"),
  SE = c("0.002", "0.018", "0.14", "0.005", "0.018"),
  `p-value` = c("0.057", "**<0.001**", "0.76", "**<0.001**", "**<0.001**"),
  `Unique R²` = c("<0.1%", "<0.5%", "~0%", "<0.5%", "<0.5%"),
  Direction = c("Weak positive", "**Negative**", "None", "Positive", "**Negative**"),
  Interpretation = c("Marginal spillover effect; biologically trivial",
                     "Confounded with coral size; large neighbors = large focal corals",
                     "No propagule redirection at meter scales",
                     "Competitive asymmetry; 'big fish in small pond'",
                     "Opposite of facilitation prediction")
)

kable(neighborhood_effects,
      caption = "**Table S13. Comprehensive neighborhood effects on CAFI abundance.** All models control for log(coral volume). Bold p-values indicate statistical significance (p < 0.05); bold effect directions highlight counterintuitive results. **Key finding**: Despite five different neighborhood metrics, none explain meaningful variance beyond coral size. The total unique variance explained by all neighborhood metrics combined is <1%.",
      align = c("l", "l", "c", "c", "c", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE, font_size = 10)
```

<div class="methods-box">
**Statistical Details: Neighborhood Analysis**

- **Survey protocols**: Colonies were sampled using two complementary protocols: (1) "neighborhood surveys" (n = 63) where we recorded the number, distance, and volume of all *Pocillopora* neighbors within a 5-meter radius of the focal colony; and (2) "size surveys" (n = 51) focused on capturing the full range of coral sizes without neighborhood characterization. This dual-protocol design maximized both the size range for scaling analyses (all 114 colonies) and the sample size for neighborhood effects (63 colonies with complete spatial context).
- **Sample size for neighborhood analyses**: n = 60–63 corals with complete neighborhood data (depending on metric completeness)
- **Neighborhood radius**: 5 meters from focal coral center
- **Model structure**: `CAFI_abundance ~ neighborhood_metric + log(volume)` (Poisson GLM)
- **Collinearity**: Neighbor count, volume, and spillover potential are moderately correlated (r = 0.4–0.6); VIF < 3 in full models
- **Theoretical predictions**:
  - Propagule redirection predicts *positive* isolation effect (isolated corals intercept more larvae/area)
  - Spillover/facilitation predicts *positive* neighbor density/volume effects
  - Competition predicts *negative* density effects
- **Observed pattern**: Results do not clearly support any single mechanism; coral size dominates
</div>

<div class="reproducibility">
**Reproducibility**: Analysis in `scripts/14_local_neighborhood_effects.R` and `scripts/Fig6_comprehensive_neighborhood_effects.R`. Results saved to `output/objects/H3_neighborhood_results.rds`.
</div>

## Figure S16: Comprehensive Neighborhood Effects Panel

<div class="cross-ref">
**Supports**: Main text Figure 2B–D; Table S13
</div>

```{r fig-s16, fig.cap="**Figure S16. Comprehensive local neighborhood effects on CAFI communities.** Six-panel figure showing meter-scale spatial effects. (A) CAFI abundance vs number of neighboring corals—weak positive trend. (B) CAFI vs total neighbor volume—negative relationship (confounded with coral size). (C) CAFI vs isolation index—no significant effect. (D) CAFI vs relative size—modest positive effect for corals larger than neighbors. (E) CAFI vs spillover potential—negative relationship, opposite facilitation prediction. (F) Summary by neighbor density category. **Key finding**: After controlling for coral size, neighborhood metrics collectively explain <1% of variance in CAFI abundance. Coral size is the dominant predictor."}
knitr::include_graphics(here("output/figures/hypothesis_tests/Fig6_neighborhood_effects_comprehensive.png"))
```

<div class="reproducibility">
**Reproducibility**: `scripts/Fig6_comprehensive_neighborhood_effects.R`.
</div>

---

# Supplementary Results: Community Composition Predicts Coral Condition

This section presents the detailed analysis showing that community composition—but not diversity—predicts coral physiological condition, supporting Key Finding 2 in the main text.

## Figure S17: CAFI Community Composition Predicts Coral Condition

<div class="cross-ref">
**Supports**: Main text Results → Result 2: No Evidence for Diversity-Condition Relationship
</div>

```{r fig-s17, fig.cap="**Figure S17. Community composition predicts coral condition.** CAFI Community PC1 (x-axis) vs. Coral Condition Score PC1 (y-axis). Points colored by site, sized by total CAFI abundance. The significant negative relationship (R² = 0.084, p = 0.007) indicates that community composition—which species are present—predicts coral condition even though species richness does not. Corals with more negative PC1 scores (dominated by certain taxa) tend to have higher condition scores."}
knitr::include_graphics(here("output/figures/cafi_predicts_condition/community_pc1_vs_condition_pc1.png"))
```

Although aggregate diversity metrics showed no relationship with coral condition after correcting for sampling artifacts (see Table S8), **community composition** did predict condition. We performed PCA on the species abundance matrix and tested whether the first principal component (CAFI PC1, capturing 5.3% of community variation) predicted coral condition. CAFI PC1 was significantly associated with coral condition (F = 7.53, R² = 0.084, p = 0.007), indicating that the identity and relative abundances of species—rather than their total number—relates to host health.

### Species Driving the Composition-Condition Relationship

The gall crab *Hapalocarcinus* showed the strongest positive correlation with condition (r = 0.27, p = 0.013), followed by the palaemonid shrimp *Periclimenes* (r = 0.23, p = 0.038). Among negative associations, the hermit crab *Calcinus latens* showed the strongest (though non-significant) negative correlation (r = −0.15, p = 0.17). However, no individual species survived FDR correction for multiple testing (all q > 0.35), indicating that the composition-condition relationship reflects distributed contributions across many taxa rather than any single keystone species.

### Biological Interpretation

Gall crabs induce coral tissue to form protective chambers around them, potentially indicating healthy, actively growing coral tissue. Palaemonid shrimp are cleaners that remove parasites and debris from coral surfaces. In contrast, hermit crabs may reflect their role as opportunistic scavengers on stressed or damaged coral tissue.

<div class="reproducibility">
**Reproducibility**: Analysis in `scripts/18_cafi_predicts_condition.R`. Figure: `output/figures/cafi_predicts_condition/community_pc1_vs_condition_pc1.png`.
</div>

---

# Reproducibility Guide

This section provides a complete guide to reproducing all analyses and figures in the manuscript.

## Data Files

All data files are in the `data/` directory:

| File | Description | Rows | Main Variables |
|------|-------------|------|----------------|
| `survey_cafi_data_w_taxonomy_summer2019_v5.csv` | Individual fauna records | 3,989 | coral_id, species, count |
| `survey_coral_characteristics_merged_v2.csv` | Coral colony data | 114 | coral_id, site, volume, GPS |
| `survey_master_phys_data_v3.csv` | Coral physiology | 108 | coral_id, protein, zoox_density |

## Analysis Scripts

Scripts in `scripts/` are numbered for sequential execution:

| Script | Purpose | Key Outputs | Main Text Section |
|--------|---------|-------------|-------------------|
| `01_load_clean_data.R` | Data import and cleaning | Master dataset | Methods |
| `02_community_composition.R` | Taxonomic summaries | Species tables | Methods |
| `03_spatial_patterns.R` | Site maps | Figure S1 | Methods |
| `04_diversity_analysis.R` | PERMANOVA, NMDS, diversity | Tables S2, S9; Figures S4–S6 | Result 1 |
| `05_coral_cafi_relationships.R` | Scaling analyses | Tables S3–S4; Figures S7–S8 | Result 2 |
| `05a_coral_characteristics.R` | Position correction, condition | Table S7; Figure S3 | Result 1 |
| `06_network_analysis.R` | Co-occurrence networks | Tables S5–S6; Figures S9–S10 | Result 4 |
| `18_cafi_predicts_condition.R` | Richness–condition diagnostic | Table S8; Figure S11 | Result 2 |

## Reproducing the Analysis

```r
# 1. Set working directory to project root
setwd("/path/to/CAFI-Survey-2026")

# 2. Run master script (executes all analyses)
source("scripts/run_all_survey_analyses.R")

# 3. Render documents
rmarkdown::render("output/manuscript/MANUSCRIPT.Rmd")
rmarkdown::render("output/manuscript/SUPPLEMENTARY_MATERIALS.Rmd")
```

## Software Requirements

- **R version**: 4.3.0 or later
- **Key packages**: tidyverse, vegan, lme4, lmerTest, igraph, sf, patchwork, kableExtra

## Output Files

All outputs are in `output/`:

- `tables/` — CSV files of statistical results
- `figures/` — PNG files at 300 DPI
- `objects/` — RDS files of fitted models
- `manuscript/` — Rendered HTML documents

---

# Data Availability

All data and code are publicly available:

- **GitHub Repository**: https://github.com/stier-lab/CAFI-Survey-2026
- **Data Archive**: Dryad Digital Repository [DOI to be assigned upon acceptance]

For questions about data or analysis, contact: Adrian Stier (astier@ucsb.edu)

---

*Supplementary Materials for: Stier et al. "Sublinear scaling and modular network structure reveal assembly rules for coral-associated cryptofauna"*
